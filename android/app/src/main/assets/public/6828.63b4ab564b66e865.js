"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6828],{2214:(Ul,Ti,kt)=>{kt.d(Ti,{Dk:()=>k.Dk,Sx:()=>k.Sx,Wp:()=>k.Wp});var k=kt(8742);(0,k.KO)("firebase","11.6.0","app")},3273:(Ul,Ti,kt)=>{kt.d(Ti,{rJ:()=>O_,H9:()=>Of,x7:()=>W_,aU:()=>L_,aQ:()=>Y_,BN:()=>H_});var Yt,Ii,k=kt(467),te=kt(8742),kn=kt(1362),ce=kt(8041),et=kt(6858),Nn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ve={};(function(){var r;function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function i(v,y,E){E||(E=0);var A=Array(16);if("string"==typeof y)for(var R=0;16>R;++R)A[R]=y.charCodeAt(E++)|y.charCodeAt(E++)<<8|y.charCodeAt(E++)<<16|y.charCodeAt(E++)<<24;else for(R=0;16>R;++R)A[R]=y[E++]|y[E++]<<8|y[E++]<<16|y[E++]<<24;var V=v.g[3],I=(y=v.g[0])+(V^(E=v.g[1])&((R=v.g[2])^V))+A[0]+3614090360&4294967295;I=(E=(R=(V=(y=(E=(R=(V=(y=(E=(R=(V=(y=(E=(R=(V=(y=(E=(R=(V=(y=(E=(R=(V=(y=(E=(R=(V=(y=(E=(R=(V=(y=(E=(R=(V=(y=(E=(R=(V=(y=(E=(R=(V=(y=(E=(R=(V=(y=(E=(R=(V=(y=(E=(R=(V=(y=(E=(R=(V=(y=E+(I<<7&4294967295|I>>>25))+((I=V+(R^y&(E^R))+A[1]+3905402710&4294967295)<<12&4294967295|I>>>20))+((I=R+(E^V&(y^E))+A[2]+606105819&4294967295)<<17&4294967295|I>>>15))+((I=E+(y^R&(V^y))+A[3]+3250441966&4294967295)<<22&4294967295|I>>>10))+((I=y+(V^E&(R^V))+A[4]+4118548399&4294967295)<<7&4294967295|I>>>25))+((I=V+(R^y&(E^R))+A[5]+1200080426&4294967295)<<12&4294967295|I>>>20))+((I=R+(E^V&(y^E))+A[6]+2821735955&4294967295)<<17&4294967295|I>>>15))+((I=E+(y^R&(V^y))+A[7]+4249261313&4294967295)<<22&4294967295|I>>>10))+((I=y+(V^E&(R^V))+A[8]+1770035416&4294967295)<<7&4294967295|I>>>25))+((I=V+(R^y&(E^R))+A[9]+2336552879&4294967295)<<12&4294967295|I>>>20))+((I=R+(E^V&(y^E))+A[10]+4294925233&4294967295)<<17&4294967295|I>>>15))+((I=E+(y^R&(V^y))+A[11]+2304563134&4294967295)<<22&4294967295|I>>>10))+((I=y+(V^E&(R^V))+A[12]+1804603682&4294967295)<<7&4294967295|I>>>25))+((I=V+(R^y&(E^R))+A[13]+4254626195&4294967295)<<12&4294967295|I>>>20))+((I=R+(E^V&(y^E))+A[14]+2792965006&4294967295)<<17&4294967295|I>>>15))+((I=E+(y^R&(V^y))+A[15]+1236535329&4294967295)<<22&4294967295|I>>>10))+((I=y+(R^V&(E^R))+A[1]+4129170786&4294967295)<<5&4294967295|I>>>27))+((I=V+(E^R&(y^E))+A[6]+3225465664&4294967295)<<9&4294967295|I>>>23))+((I=R+(y^E&(V^y))+A[11]+643717713&4294967295)<<14&4294967295|I>>>18))+((I=E+(V^y&(R^V))+A[0]+3921069994&4294967295)<<20&4294967295|I>>>12))+((I=y+(R^V&(E^R))+A[5]+3593408605&4294967295)<<5&4294967295|I>>>27))+((I=V+(E^R&(y^E))+A[10]+38016083&4294967295)<<9&4294967295|I>>>23))+((I=R+(y^E&(V^y))+A[15]+3634488961&4294967295)<<14&4294967295|I>>>18))+((I=E+(V^y&(R^V))+A[4]+3889429448&4294967295)<<20&4294967295|I>>>12))+((I=y+(R^V&(E^R))+A[9]+568446438&4294967295)<<5&4294967295|I>>>27))+((I=V+(E^R&(y^E))+A[14]+3275163606&4294967295)<<9&4294967295|I>>>23))+((I=R+(y^E&(V^y))+A[3]+4107603335&4294967295)<<14&4294967295|I>>>18))+((I=E+(V^y&(R^V))+A[8]+1163531501&4294967295)<<20&4294967295|I>>>12))+((I=y+(R^V&(E^R))+A[13]+2850285829&4294967295)<<5&4294967295|I>>>27))+((I=V+(E^R&(y^E))+A[2]+4243563512&4294967295)<<9&4294967295|I>>>23))+((I=R+(y^E&(V^y))+A[7]+1735328473&4294967295)<<14&4294967295|I>>>18))+((I=E+(V^y&(R^V))+A[12]+2368359562&4294967295)<<20&4294967295|I>>>12))+((I=y+(E^R^V)+A[5]+4294588738&4294967295)<<4&4294967295|I>>>28))+((I=V+(y^E^R)+A[8]+2272392833&4294967295)<<11&4294967295|I>>>21))+((I=R+(V^y^E)+A[11]+1839030562&4294967295)<<16&4294967295|I>>>16))+((I=E+(R^V^y)+A[14]+4259657740&4294967295)<<23&4294967295|I>>>9))+((I=y+(E^R^V)+A[1]+2763975236&4294967295)<<4&4294967295|I>>>28))+((I=V+(y^E^R)+A[4]+1272893353&4294967295)<<11&4294967295|I>>>21))+((I=R+(V^y^E)+A[7]+4139469664&4294967295)<<16&4294967295|I>>>16))+((I=E+(R^V^y)+A[10]+3200236656&4294967295)<<23&4294967295|I>>>9))+((I=y+(E^R^V)+A[13]+681279174&4294967295)<<4&4294967295|I>>>28))+((I=V+(y^E^R)+A[0]+3936430074&4294967295)<<11&4294967295|I>>>21))+((I=R+(V^y^E)+A[3]+3572445317&4294967295)<<16&4294967295|I>>>16))+((I=E+(R^V^y)+A[6]+76029189&4294967295)<<23&4294967295|I>>>9))+((I=y+(E^R^V)+A[9]+3654602809&4294967295)<<4&4294967295|I>>>28))+((I=V+(y^E^R)+A[12]+3873151461&4294967295)<<11&4294967295|I>>>21))+((I=R+(V^y^E)+A[15]+530742520&4294967295)<<16&4294967295|I>>>16))+((I=E+(R^V^y)+A[2]+3299628645&4294967295)<<23&4294967295|I>>>9))+((I=y+(R^(E|~V))+A[0]+4096336452&4294967295)<<6&4294967295|I>>>26))+((I=V+(E^(y|~R))+A[7]+1126891415&4294967295)<<10&4294967295|I>>>22))+((I=R+(y^(V|~E))+A[14]+2878612391&4294967295)<<15&4294967295|I>>>17))+((I=E+(V^(R|~y))+A[5]+4237533241&4294967295)<<21&4294967295|I>>>11))+((I=y+(R^(E|~V))+A[12]+1700485571&4294967295)<<6&4294967295|I>>>26))+((I=V+(E^(y|~R))+A[3]+2399980690&4294967295)<<10&4294967295|I>>>22))+((I=R+(y^(V|~E))+A[10]+4293915773&4294967295)<<15&4294967295|I>>>17))+((I=E+(V^(R|~y))+A[1]+2240044497&4294967295)<<21&4294967295|I>>>11))+((I=y+(R^(E|~V))+A[8]+1873313359&4294967295)<<6&4294967295|I>>>26))+((I=V+(E^(y|~R))+A[15]+4264355552&4294967295)<<10&4294967295|I>>>22))+((I=R+(y^(V|~E))+A[6]+2734768916&4294967295)<<15&4294967295|I>>>17))+((I=E+(V^(R|~y))+A[13]+1309151649&4294967295)<<21&4294967295|I>>>11))+((V=(y=E+((I=y+(R^(E|~V))+A[4]+4149444226&4294967295)<<6&4294967295|I>>>26))+((I=V+(E^(y|~R))+A[11]+3174756917&4294967295)<<10&4294967295|I>>>22))^((R=V+((I=R+(y^(V|~E))+A[2]+718787259&4294967295)<<15&4294967295|I>>>17))|~y))+A[9]+3951481745&4294967295,v.g[0]=v.g[0]+y&4294967295,v.g[1]=v.g[1]+(R+(I<<21&4294967295|I>>>11))&4294967295,v.g[2]=v.g[2]+R&4294967295,v.g[3]=v.g[3]+V&4294967295}function a(v,y){this.h=y;for(var E=[],A=!0,R=v.length-1;0<=R;R--){var V=0|v[R];A&&V==y||(E[R]=V,A=!1)}this.g=E}(function t(v,y){function E(){}E.prototype=y.prototype,v.D=y.prototype,v.prototype=new E,v.prototype.constructor=v,v.C=function(A,R,V){for(var I=Array(arguments.length-2),rn=2;rn<arguments.length;rn++)I[rn-2]=arguments[rn];return y.prototype[R].apply(A,I)}})(n,function e(){this.blockSize=-1}),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},n.prototype.u=function(v,y){void 0===y&&(y=v.length);for(var E=y-this.blockSize,A=this.B,R=this.h,V=0;V<y;){if(0==R)for(;V<=E;)i(this,v,V),V+=this.blockSize;if("string"==typeof v){for(;V<y;)if(A[R++]=v.charCodeAt(V++),R==this.blockSize){i(this,A),R=0;break}}else for(;V<y;)if(A[R++]=v[V++],R==this.blockSize){i(this,A),R=0;break}}this.h=R,this.o+=y},n.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var y=1;y<v.length-8;++y)v[y]=0;var E=8*this.o;for(y=v.length-8;y<v.length;++y)v[y]=255&E,E/=256;for(this.u(v),v=Array(16),y=E=0;4>y;++y)for(var A=0;32>A;A+=8)v[E++]=this.g[y]>>>A&255;return v};var u={};function c(v){return-128<=v&&128>v?function s(v,y){var E=u;return Object.prototype.hasOwnProperty.call(E,v)?E[v]:E[v]=y(v)}(v,function(y){return new a([0|y],0>y?-1:0)}):new a([0|v],0>v?-1:0)}function h(v){if(isNaN(v)||!isFinite(v))return g;if(0>v)return F(h(-v));for(var y=[],E=1,A=0;v>=E;A++)y[A]=v/E|0,E*=4294967296;return new a(y,0)}var g=c(0),T=c(1),S=c(16777216);function N(v){if(0!=v.h)return!1;for(var y=0;y<v.g.length;y++)if(0!=v.g[y])return!1;return!0}function L(v){return-1==v.h}function F(v){for(var y=v.g.length,E=[],A=0;A<y;A++)E[A]=~v.g[A];return new a(E,~v.h).add(T)}function $(v,y){return v.add(F(y))}function Y(v,y){for(;(65535&v[y])!=v[y];)v[y+1]+=v[y]>>>16,v[y]&=65535,y++}function W(v,y){this.g=v,this.h=y}function J(v,y){if(N(y))throw Error("division by zero");if(N(v))return new W(g,g);if(L(v))return y=J(F(v),y),new W(F(y.g),F(y.h));if(L(y))return y=J(v,F(y)),new W(F(y.g),y.h);if(30<v.g.length){if(L(v)||L(y))throw Error("slowDivide_ only works with positive integers.");for(var E=T,A=y;0>=A.l(v);)E=at(E),A=at(A);var R=tt(E,1),V=tt(A,1);for(A=tt(A,2),E=tt(E,2);!N(A);){var I=V.add(A);0>=I.l(v)&&(R=R.add(E),V=I),A=tt(A,1),E=tt(E,1)}return y=$(v,R.j(y)),new W(R,y)}for(R=g;0<=v.l(y);){for(E=Math.max(1,Math.floor(v.m()/y.m())),A=48>=(A=Math.ceil(Math.log(E)/Math.LN2))?1:Math.pow(2,A-48),I=(V=h(E)).j(y);L(I)||0<I.l(v);)I=(V=h(E-=A)).j(y);N(V)&&(V=T),R=R.add(V),v=$(v,I)}return new W(R,v)}function at(v){for(var y=v.g.length+1,E=[],A=0;A<y;A++)E[A]=v.i(A)<<1|v.i(A-1)>>>31;return new a(E,v.h)}function tt(v,y){var E=y>>5;y%=32;for(var A=v.g.length-E,R=[],V=0;V<A;V++)R[V]=0<y?v.i(V+E)>>>y|v.i(V+E+1)<<32-y:v.i(V+E);return new a(R,v.h)}(r=a.prototype).m=function(){if(L(this))return-F(this).m();for(var v=0,y=1,E=0;E<this.g.length;E++){var A=this.i(E);v+=(0<=A?A:4294967296+A)*y,y*=4294967296}return v},r.toString=function(v){if(2>(v=v||10)||36<v)throw Error("radix out of range: "+v);if(N(this))return"0";if(L(this))return"-"+F(this).toString(v);for(var y=h(Math.pow(v,6)),E=this,A="";;){var R=J(E,y).g,V=((0<(E=$(E,R.j(y))).g.length?E.g[0]:E.h)>>>0).toString(v);if(N(E=R))return V+A;for(;6>V.length;)V="0"+V;A=V+A}},r.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h},r.l=function(v){return L(v=$(this,v))?-1:N(v)?0:1},r.abs=function(){return L(this)?F(this):this},r.add=function(v){for(var y=Math.max(this.g.length,v.g.length),E=[],A=0,R=0;R<=y;R++){var V=A+(65535&this.i(R))+(65535&v.i(R)),I=(V>>>16)+(this.i(R)>>>16)+(v.i(R)>>>16);A=I>>>16,E[R]=(I&=65535)<<16|(V&=65535)}return new a(E,-2147483648&E[E.length-1]?-1:0)},r.j=function(v){if(N(this)||N(v))return g;if(L(this))return L(v)?F(this).j(F(v)):F(F(this).j(v));if(L(v))return F(this.j(F(v)));if(0>this.l(S)&&0>v.l(S))return h(this.m()*v.m());for(var y=this.g.length+v.g.length,E=[],A=0;A<2*y;A++)E[A]=0;for(A=0;A<this.g.length;A++)for(var R=0;R<v.g.length;R++){var V=this.i(A)>>>16,I=65535&this.i(A),rn=v.i(R)>>>16,ks=65535&v.i(R);E[2*A+2*R]+=I*ks,Y(E,2*A+2*R),E[2*A+2*R+1]+=V*ks,Y(E,2*A+2*R+1),E[2*A+2*R+1]+=I*rn,Y(E,2*A+2*R+1),E[2*A+2*R+2]+=V*rn,Y(E,2*A+2*R+2)}for(A=0;A<y;A++)E[A]=E[2*A+1]<<16|E[2*A];for(A=y;A<2*y;A++)E[A]=0;return new a(E,0)},r.A=function(v){return J(this,v).h},r.and=function(v){for(var y=Math.max(this.g.length,v.g.length),E=[],A=0;A<y;A++)E[A]=this.i(A)&v.i(A);return new a(E,this.h&v.h)},r.or=function(v){for(var y=Math.max(this.g.length,v.g.length),E=[],A=0;A<y;A++)E[A]=this.i(A)|v.i(A);return new a(E,this.h|v.h)},r.xor=function(v){for(var y=Math.max(this.g.length,v.g.length),E=[],A=0;A<y;A++)E[A]=this.i(A)^v.i(A);return new a(E,this.h^v.h)},n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Ii=ve.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=function p(v,y){if(0==v.length)throw Error("number format error: empty string");if(2>(y=y||10)||36<y)throw Error("radix out of range: "+y);if("-"==v.charAt(0))return F(p(v.substring(1),y));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var E=h(Math.pow(y,8)),A=g,R=0;R<v.length;R+=8){var V=Math.min(8,v.length-R),I=parseInt(v.substring(R,R+V),y);8>V?(V=h(Math.pow(y,V)),A=A.j(V).add(h(I))):A=(A=A.j(E)).add(h(I))}return A},Yt=ve.Integer=a}).apply(typeof Nn<"u"?Nn:typeof self<"u"?self:typeof window<"u"?window:{});var Ei,Mn,Zs,hr,vi,to,he,Ai,an=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},le={};(function(){var r,t="function"==typeof Object.defineProperties?Object.defineProperty:function(o,l,d){return o==Array.prototype||o==Object.prototype||(o[l]=d.value),o},n=function e(o){o=["object"==typeof globalThis&&globalThis,o,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof an&&an];for(var l=0;l<o.length;++l){var d=o[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}(this);!function i(o,l){if(l)t:{var d=n;o=o.split(".");for(var m=0;m<o.length-1;m++){var b=o[m];if(!(b in d))break t;d=d[b]}(l=l(m=d[o=o[o.length-1]]))!=m&&null!=l&&t(d,o,{configurable:!0,writable:!0,value:l})}}("Array.prototype.values",function(o){return o||function(){return function s(o,l){o instanceof String&&(o+="");var d=0,m=!1,b={next:function(){if(!m&&d<o.length){var C=d++;return{value:l(C,o[C]),done:!1}}return m=!0,{done:!0,value:void 0}}};return b[Symbol.iterator]=function(){return b},b}(this,function(l,d){return d})}});var a=a||{},u=this||self;function c(o){var l=typeof o;return"array"==(l="object"!=l?l:o?Array.isArray(o)?"array":l:"null")||"object"==l&&"number"==typeof o.length}function h(o){var l=typeof o;return"object"==l&&null!=o||"function"==l}function p(o,l,d){return o.call.apply(o.bind,arguments)}function g(o,l,d){if(!o)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var b=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(b,m),o.apply(l,b)}}return function(){return o.apply(l,arguments)}}function T(o,l,d){return(T=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?p:g).apply(null,arguments)}function S(o,l){var d=Array.prototype.slice.call(arguments,1);return function(){var m=d.slice();return m.push.apply(m,arguments),o.apply(this,m)}}function N(o,l){function d(){}d.prototype=l.prototype,o.aa=l.prototype,o.prototype=new d,o.prototype.constructor=o,o.Qb=function(m,b,C){for(var B=Array(arguments.length-2),gt=2;gt<arguments.length;gt++)B[gt-2]=arguments[gt];return l.prototype[b].apply(m,B)}}function L(o){const l=o.length;if(0<l){const d=Array(l);for(let m=0;m<l;m++)d[m]=o[m];return d}return[]}function F(o,l){for(let d=1;d<arguments.length;d++){const m=arguments[d];if(c(m)){const b=o.length||0,C=m.length||0;o.length=b+C;for(let B=0;B<C;B++)o[b+B]=m[B]}else o.push(m)}}function Y(o){return/^[\s\xa0]*$/.test(o)}function W(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function J(o){return J[" "](o),o}J[" "]=function(){};var at=!(-1==W().indexOf("Gecko")||-1!=W().toLowerCase().indexOf("webkit")&&-1==W().indexOf("Edge")||-1!=W().indexOf("Trident")||-1!=W().indexOf("MSIE")||-1!=W().indexOf("Edge"));function tt(o,l,d){for(const m in o)l.call(d,o[m],m,o)}function y(o){const l={};for(const d in o)l[d]=o[d];return l}const E="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function A(o,l){let d,m;for(let b=1;b<arguments.length;b++){for(d in m=arguments[b],m)o[d]=m[d];for(let C=0;C<E.length;C++)d=E[C],Object.prototype.hasOwnProperty.call(m,d)&&(o[d]=m[d])}}function R(o){var l=1;o=o.split(":");const d=[];for(;0<l&&o.length;)d.push(o.shift()),l--;return o.length&&d.push(o.join(":")),d}function V(o){u.setTimeout(()=>{throw o},0)}function I(){var o=gl;let l=null;return o.g&&(l=o.g,o.g=o.g.next,o.g||(o.h=null),l.next=null),l}var ks=new class ${constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}(()=>new ly,o=>o.reset());class ly{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let Ns,Ms=!1,gl=new class rn{constructor(){this.h=this.g=null}add(l,d){const m=ks.get();m.set(l,d),this.h?this.h.next=m:this.g=m,this.h=m}},sp=()=>{const o=u.Promise.resolve(void 0);Ns=()=>{o.then(hy)}};var hy=()=>{for(var o;o=I();){try{o.h.call(o.g)}catch(d){V(d)}var l=ks;l.j(o),100>l.h&&(l.h++,o.next=l.g,l.g=o)}Ms=!1};function Vn(){this.s=this.s,this.C=this.C}function $t(o,l){this.type=o,this.g=this.target=l,this.defaultPrevented=!1}Vn.prototype.s=!1,Vn.prototype.ma=function(){this.s||(this.s=!0,this.N())},Vn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},$t.prototype.h=function(){this.defaultPrevented=!0};var dy=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,l=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const d=()=>{};u.addEventListener("test",d,l),u.removeEventListener("test",d,l)}catch{}return o}();function Os(o,l){if($t.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var d=this.type=o.type,m=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=l,l=o.relatedTarget){if(at){t:{try{J(l.nodeName);var b=!0;break t}catch{}b=!1}b||(l=null)}}else"mouseover"==d?l=o.fromElement:"mouseout"==d&&(l=o.toElement);this.relatedTarget=l,m?(this.clientX=void 0!==m.clientX?m.clientX:m.pageX,this.clientY=void 0!==m.clientY?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=void 0!==o.clientX?o.clientX:o.pageX,this.clientY=void 0!==o.clientY?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType="string"==typeof o.pointerType?o.pointerType:fy[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&Os.aa.h.call(this)}}N(Os,$t);var fy={2:"touch",3:"pen",4:"mouse"};Os.prototype.h=function(){Os.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Fs="closure_listenable_"+(1e6*Math.random()|0),py=0;function my(o,l,d,m,b){this.listener=o,this.proxy=null,this.src=l,this.type=d,this.capture=!!m,this.ha=b,this.key=++py,this.da=this.fa=!1}function pa(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function ma(o){this.src=o,this.g={},this.h=0}function _l(o,l){var d=l.type;if(d in o.g){var C,m=o.g[d],b=Array.prototype.indexOf.call(m,l,void 0);(C=0<=b)&&Array.prototype.splice.call(m,b,1),C&&(pa(l),0==o.g[d].length&&(delete o.g[d],o.h--))}}function yl(o,l,d,m){for(var b=0;b<o.length;++b){var C=o[b];if(!C.da&&C.listener==l&&C.capture==!!d&&C.ha==m)return b}return-1}ma.prototype.add=function(o,l,d,m,b){var C=o.toString();(o=this.g[C])||(o=this.g[C]=[],this.h++);var B=yl(o,l,m,b);return-1<B?(l=o[B],d||(l.fa=!1)):((l=new my(l,this.src,C,!!m,b)).fa=d,o.push(l)),l};var Tl="closure_lm_"+(1e6*Math.random()|0),Il={};function op(o,l,d,m,b){if(m&&m.once)return up(o,l,d,m,b);if(Array.isArray(l)){for(var C=0;C<l.length;C++)op(o,l[C],d,m,b);return null}return d=wl(d),o&&o[Fs]?o.K(l,d,h(m)?!!m.capture:!!m,b):ap(o,l,d,!1,m,b)}function ap(o,l,d,m,b,C){if(!l)throw Error("Invalid event type");var B=h(b)?!!b.capture:!!b,gt=vl(o);if(gt||(o[Tl]=gt=new ma(o)),(d=gt.add(l,d,m,B,C)).proxy)return d;if(m=function gy(){const l=_y;return function o(d){return l.call(o.src,o.listener,d)}}(),d.proxy=m,m.src=o,m.listener=d,o.addEventListener)dy||(b=B),void 0===b&&(b=!1),o.addEventListener(l.toString(),m,b);else if(o.attachEvent)o.attachEvent(lp(l.toString()),m);else{if(!o.addListener||!o.removeListener)throw Error("addEventListener and attachEvent are unavailable.");o.addListener(m)}return d}function up(o,l,d,m,b){if(Array.isArray(l)){for(var C=0;C<l.length;C++)up(o,l[C],d,m,b);return null}return d=wl(d),o&&o[Fs]?o.L(l,d,h(m)?!!m.capture:!!m,b):ap(o,l,d,!0,m,b)}function cp(o,l,d,m,b){if(Array.isArray(l))for(var C=0;C<l.length;C++)cp(o,l[C],d,m,b);else m=h(m)?!!m.capture:!!m,d=wl(d),o&&o[Fs]?(o=o.i,(l=String(l).toString())in o.g&&-1<(d=yl(C=o.g[l],d,m,b))&&(pa(C[d]),Array.prototype.splice.call(C,d,1),0==C.length&&(delete o.g[l],o.h--))):o&&(o=vl(o))&&(l=o.g[l.toString()],o=-1,l&&(o=yl(l,d,m,b)),(d=-1<o?l[o]:null)&&El(d))}function El(o){if("number"!=typeof o&&o&&!o.da){var l=o.src;if(l&&l[Fs])_l(l.i,o);else{var d=o.type,m=o.proxy;l.removeEventListener?l.removeEventListener(d,m,o.capture):l.detachEvent?l.detachEvent(lp(d),m):l.addListener&&l.removeListener&&l.removeListener(m),(d=vl(l))?(_l(d,o),0==d.h&&(d.src=null,l[Tl]=null)):pa(o)}}}function lp(o){return o in Il?Il[o]:Il[o]="on"+o}function _y(o,l){if(o.da)o=!0;else{l=new Os(l,this);var d=o.listener,m=o.ha||o.src;o.fa&&El(o),o=d.call(m,l)}return o}function vl(o){return(o=o[Tl])instanceof ma?o:null}var Al="__closure_events_fn_"+(1e9*Math.random()>>>0);function wl(o){return"function"==typeof o?o:(o[Al]||(o[Al]=function(l){return o.handleEvent(l)}),o[Al])}function Qt(){Vn.call(this),this.i=new ma(this),this.M=this,this.F=null}function Xt(o,l){var d,m=o.F;if(m)for(d=[];m;m=m.F)d.push(m);if(o=o.M,m=l.type||l,"string"==typeof l)l=new $t(l,o);else if(l instanceof $t)l.target=l.target||o;else{var b=l;A(l=new $t(m,o),b)}if(b=!0,d)for(var C=d.length-1;0<=C;C--){var B=l.g=d[C];b=ga(B,m,!0,l)&&b}if(b=ga(B=l.g=o,m,!0,l)&&b,b=ga(B,m,!1,l)&&b,d)for(C=0;C<d.length;C++)b=ga(B=l.g=d[C],m,!1,l)&&b}function ga(o,l,d,m){if(!(l=o.i.g[String(l)]))return!0;l=l.concat();for(var b=!0,C=0;C<l.length;++C){var B=l[C];if(B&&!B.da&&B.capture==d){var gt=B.listener,Gt=B.ha||B.src;B.fa&&_l(o.i,B),b=!1!==gt.call(Gt,m)&&b}}return b&&!m.defaultPrevented}function hp(o,l,d){if("function"==typeof o)d&&(o=T(o,d));else{if(!o||"function"!=typeof o.handleEvent)throw Error("Invalid listener argument");o=T(o.handleEvent,o)}return 2147483647<Number(l)?-1:u.setTimeout(o,l||0)}function dp(o){o.g=hp(()=>{o.g=null,o.i&&(o.i=!1,dp(o))},o.l);const l=o.h;o.h=null,o.m.apply(null,l)}N(Qt,Vn),Qt.prototype[Fs]=!0,Qt.prototype.removeEventListener=function(o,l,d,m){cp(this,o,l,d,m)},Qt.prototype.N=function(){if(Qt.aa.N.call(this),this.i){var l,o=this.i;for(l in o.g){for(var d=o.g[l],m=0;m<d.length;m++)pa(d[m]);delete o.g[l],o.h--}}this.F=null},Qt.prototype.K=function(o,l,d,m){return this.i.add(String(o),l,!1,d,m)},Qt.prototype.L=function(o,l,d,m){return this.i.add(String(o),l,!0,d,m)};class yy extends Vn{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:dp(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ls(o){Vn.call(this),this.h=o,this.g={}}N(Ls,Vn);var fp=[];function pp(o){tt(o.g,function(l,d){this.g.hasOwnProperty(d)&&El(l)},o),o.g={}}Ls.prototype.N=function(){Ls.aa.N.call(this),pp(this)},Ls.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Rl=u.JSON.stringify,Ty=u.JSON.parse,Iy=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function Pl(){}function gp(){}Pl.prototype.h=null;var qs={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function bl(){$t.call(this,"d")}function Sl(){$t.call(this,"c")}N(bl,$t),N(Sl,$t);var ar={},_p=null;function _a(){return _p=_p||new Qt}function yp(o){$t.call(this,ar.La,o)}function Bs(o){const l=_a();Xt(l,new yp(l))}function Tp(o,l){$t.call(this,ar.STAT_EVENT,o),this.stat=l}function Zt(o){const l=_a();Xt(l,new Tp(l,o))}function Ip(o,l){$t.call(this,ar.Ma,o),this.size=l}function Us(o,l){if("function"!=typeof o)throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},l)}function Gs(){this.g=!0}function mi(o,l,d,m){o.info(function(){return"XMLHTTP TEXT ("+l+"): "+function wy(o,l){if(!o.g)return l;if(!l)return null;try{var d=JSON.parse(l);if(d)for(o=0;o<d.length;o++)if(Array.isArray(d[o])){var m=d[o];if(!(2>m.length)){var b=m[1];if(Array.isArray(b)&&!(1>b.length)){var C=b[0];if("noop"!=C&&"stop"!=C&&"close"!=C)for(var B=1;B<b.length;B++)b[B]=""}}}return Rl(d)}catch{return l}}(o,d)+(m?" "+m:"")})}ar.La="serverreachability",N(yp,$t),ar.STAT_EVENT="statevent",N(Tp,$t),ar.Ma="timingevent",N(Ip,$t),Gs.prototype.xa=function(){this.g=!1},Gs.prototype.info=function(){};var Vl,ya={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ep={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Ta(){}function xn(o,l,d,m){this.j=o,this.i=l,this.l=d,this.R=m||1,this.U=new Ls(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new vp}function vp(){this.i=null,this.g="",this.h=!1}N(Ta,Pl),Ta.prototype.g=function(){return new XMLHttpRequest},Ta.prototype.i=function(){return{}},Vl=new Ta;var Ap={},xl={};function Cl(o,l,d){o.L=1,o.v=Aa(sn(l)),o.m=d,o.P=!0,wp(o,null)}function wp(o,l){o.F=Date.now(),Ia(o),o.A=sn(o.v);var d=o.A,m=o.R;Array.isArray(m)||(m=[String(m)]),Lp(d.i,"t",m),o.C=0,d=o.j.J,o.h=new vp,o.g=nm(o.j,d?l:null,!o.m),0<o.O&&(o.M=new yy(T(o.Y,o,o.g),o.O)),l=o.U,d=o.g,m=o.ca;var b="readystatechange";Array.isArray(b)||(b&&(fp[0]=b.toString()),b=fp);for(var C=0;C<b.length;C++){var B=op(d,b[C],m||l.handleEvent,!1,l.h||l);if(!B)break;l.g[B.key]=B}l=o.H?y(o.H):{},o.m?(o.u||(o.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,l)):(o.u="GET",o.g.ea(o.A,o.u,null,l)),Bs(),function Ey(o,l,d,m,b,C){o.info(function(){if(o.g)if(C)for(var B="",gt=C.split("&"),Gt=0;Gt<gt.length;Gt++){var ut=gt[Gt].split("=");if(1<ut.length){var Wt=ut[0];ut=ut[1];var Ht=Wt.split("_");B=2<=Ht.length&&"type"==Ht[1]?B+(Wt+"=")+ut+"&":B+(Wt+"=redacted&")}}else B=null;else B=C;return"XMLHTTP REQ ("+m+") [attempt "+b+"]: "+l+"\n"+d+"\n"+B})}(o.i,o.u,o.A,o.l,o.R,o.m)}function Rp(o){return!!o.g&&"GET"==o.u&&2!=o.L&&o.j.Ca}function Ry(o,l){var d=o.C,m=l.indexOf("\n",d);return-1==m?xl:(d=Number(l.substring(d,m)),isNaN(d)?Ap:(m+=1)+d>l.length?xl:(l=l.slice(m,m+d),o.C=m+d,l))}function Ia(o){o.S=Date.now()+o.I,Pp(o,o.I)}function Pp(o,l){if(null!=o.B)throw Error("WatchDog timer not null");o.B=Us(T(o.ba,o),l)}function Dl(o){o.B&&(u.clearTimeout(o.B),o.B=null)}function js(o){0==o.j.G||o.J||Xp(o.j,o)}function ur(o){Dl(o);var l=o.M;l&&"function"==typeof l.ma&&l.ma(),o.M=null,pp(o.U),o.g&&(l=o.g,o.g=null,l.abort(),l.ma())}function kl(o,l){try{var d=o.j;if(0!=d.G&&(d.g==o||Nl(d.h,o)))if(!o.K&&Nl(d.h,o)&&3==d.G){try{var m=d.Da.g.parse(l)}catch{m=null}if(Array.isArray(m)&&3==m.length){var b=m;if(0==b[0]){t:if(!d.u){if(d.g){if(!(d.g.F+3e3<o.F))break t;Sa(d),Pa(d)}Ll(d),Zt(18)}}else d.za=b[1],0<d.za-d.T&&37500>b[2]&&d.F&&0==d.v&&!d.C&&(d.C=Us(T(d.Za,d),6e3));if(1>=Vp(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else lr(d,11)}else if((o.K||d.g==o)&&Sa(d),!Y(l))for(b=d.Da.g.parse(l),l=0;l<b.length;l++){let ut=b[l];if(d.T=ut[0],ut=ut[1],2==d.G)if("c"==ut[0]){d.K=ut[1],d.ia=ut[2];const Wt=ut[3];null!=Wt&&(d.la=Wt,d.j.info("VER="+d.la));const Ht=ut[4];null!=Ht&&(d.Aa=Ht,d.j.info("SVER="+d.Aa));const yi=ut[5];null!=yi&&"number"==typeof yi&&0<yi&&(d.L=m=1.5*yi,d.j.info("backChannelRequestTimeoutMs_="+m)),m=d;const Ee=o.g;if(Ee){const xa=Ee.g?Ee.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(xa){var C=m.h;C.g||-1==xa.indexOf("spdy")&&-1==xa.indexOf("quic")&&-1==xa.indexOf("h2")||(C.j=C.l,C.g=new Set,C.h&&(Ml(C,C.h),C.h=null))}if(m.D){const Bl=Ee.g?Ee.g.getResponseHeader("X-HTTP-Session-Id"):null;Bl&&(m.ya=Bl,Tt(m.I,m.D,Bl))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-o.F,d.j.info("Handshake RTT: "+d.R+"ms"));var B=o;if((m=d).qa=em(m,m.J?m.ia:null,m.W),B.K){xp(m.h,B);var gt=B,Gt=m.L;Gt&&(gt.I=Gt),gt.B&&(Dl(gt),Ia(gt)),m.g=B}else Yp(m);0<d.i.length&&ba(d)}else"stop"!=ut[0]&&"close"!=ut[0]||lr(d,7);else 3==d.G&&("stop"==ut[0]||"close"==ut[0]?"stop"==ut[0]?lr(d,7):Fl(d):"noop"!=ut[0]&&d.l&&d.l.ta(ut),d.v=0)}Bs()}catch{}}xn.prototype.ca=function(o){o=o.target;const l=this.M;l&&3==on(o)?l.j():this.Y(o)},xn.prototype.Y=function(o){try{if(o==this.g)t:{const Ht=on(this.g);var l=this.g.Ba();if(this.g.Z(),!(3>Ht)&&(3!=Ht||this.g&&(this.h.h||this.g.oa()||zp(this.g)))){this.J||4!=Ht||7==l||Bs(),Dl(this);var d=this.g.Z();this.X=d;e:if(Rp(this)){var m=zp(this.g);o="";var b=m.length,C=4==on(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){ur(this),js(this);var B="";break e}this.h.i=new u.TextDecoder}for(l=0;l<b;l++)this.h.h=!0,o+=this.h.i.decode(m[l],{stream:!(C&&l==b-1)});m.length=0,this.h.g+=o,this.C=0,B=this.h.g}else B=this.g.oa();if(this.o=200==d,function vy(o,l,d,m,b,C,B){o.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+b+"]: "+l+"\n"+d+"\n"+C+" "+B})}(this.i,this.u,this.A,this.l,this.R,Ht,d),this.o){if(this.T&&!this.K){e:{if(this.g){var gt,Gt=this.g;if((gt=Gt.g?Gt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Y(gt)){var ut=gt;break e}}ut=null}if(!(d=ut)){this.o=!1,this.s=3,Zt(12),ur(this),js(this);break t}mi(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,kl(this,d)}if(this.P){let Ee;for(d=!0;!this.J&&this.C<B.length;){if(Ee=Ry(this,B),Ee==xl){4==Ht&&(this.s=4,Zt(14),d=!1),mi(this.i,this.l,null,"[Incomplete Response]");break}if(Ee==Ap){this.s=4,Zt(15),mi(this.i,this.l,B,"[Invalid Chunk]"),d=!1;break}mi(this.i,this.l,Ee,null),kl(this,Ee)}if(Rp(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=Ht||0!=B.length||this.h.h||(this.s=1,Zt(16),d=!1),this.o=this.o&&d,d){if(0<B.length&&!this.W){this.W=!0;var Wt=this.j;Wt.g==this&&Wt.ba&&!Wt.M&&(Wt.j.info("Great, no buffering proxy detected. Bytes received: "+B.length),ql(Wt),Wt.M=!0,Zt(11))}}else mi(this.i,this.l,B,"[Invalid Chunked Response]"),ur(this),js(this)}else mi(this.i,this.l,B,null),kl(this,B);4==Ht&&ur(this),this.o&&!this.J&&(4==Ht?Xp(this.j,this):(this.o=!1,Ia(this)))}else(function Gy(o){const l={};o=(o.g&&2<=on(o)&&o.g.getAllResponseHeaders()||"").split("\r\n");for(let m=0;m<o.length;m++){if(Y(o[m]))continue;var d=R(o[m]);const b=d[0];if("string"!=typeof(d=d[1]))continue;d=d.trim();const C=l[b]||[];l[b]=C,C.push(d)}!function v(o,l){for(const d in o)l.call(void 0,o[d],d,o)}(l,function(m){return m.join(", ")})})(this.g),400==d&&0<B.indexOf("Unknown SID")?(this.s=3,Zt(12)):(this.s=0,Zt(13)),ur(this),js(this)}}}catch{}},xn.prototype.cancel=function(){this.J=!0,ur(this)},xn.prototype.ba=function(){this.B=null;const o=Date.now();0<=o-this.S?(function Ay(o,l){o.info(function(){return"TIMEOUT: "+l})}(this.i,this.A),2!=this.L&&(Bs(),Zt(17)),ur(this),this.s=2,js(this)):Pp(this,this.S-o)};var Py=class{constructor(o,l){this.g=o,this.map=l}};function bp(o){this.l=o||10,o=u.PerformanceNavigationTiming?0<(o=u.performance.getEntriesByType("navigation")).length&&("hq"==o[0].nextHopProtocol||"h2"==o[0].nextHopProtocol):!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Sp(o){return!!o.h||!!o.g&&o.g.size>=o.j}function Vp(o){return o.h?1:o.g?o.g.size:0}function Nl(o,l){return o.h?o.h==l:!!o.g&&o.g.has(l)}function Ml(o,l){o.g?o.g.add(l):o.h=l}function xp(o,l){o.h&&o.h==l?o.h=null:o.g&&o.g.has(l)&&o.g.delete(l)}function Cp(o){if(null!=o.h)return o.i.concat(o.h.D);if(null!=o.g&&0!==o.g.size){let l=o.i;for(const d of o.g.values())l=l.concat(d.D);return l}return L(o.i)}function Dp(o,l){if(o.forEach&&"function"==typeof o.forEach)o.forEach(l,void 0);else if(c(o)||"string"==typeof o)Array.prototype.forEach.call(o,l,void 0);else for(var d=function Sy(o){if(o.na&&"function"==typeof o.na)return o.na();if(!o.V||"function"!=typeof o.V){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(c(o)||"string"==typeof o){var l=[];o=o.length;for(var d=0;d<o;d++)l.push(d);return l}l=[],d=0;for(const m in o)l[d++]=m;return l}}}(o),m=function by(o){if(o.V&&"function"==typeof o.V)return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if("string"==typeof o)return o.split("");if(c(o)){for(var l=[],d=o.length,m=0;m<d;m++)l.push(o[m]);return l}for(m in l=[],d=0,o)l[d++]=o[m];return l}(o),b=m.length,C=0;C<b;C++)l.call(void 0,m[C],d&&d[C],o)}bp.prototype.cancel=function(){if(this.i=Cp(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const o of this.g.values())o.cancel();this.g.clear()}};var kp=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function cr(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof cr){this.h=o.h,Ea(this,o.j),this.o=o.o,this.g=o.g,va(this,o.s),this.l=o.l;var l=o.i,d=new $s;d.i=l.i,l.g&&(d.g=new Map(l.g),d.h=l.h),Np(this,d),this.m=o.m}else o&&(l=String(o).match(kp))?(this.h=!1,Ea(this,l[1]||"",!0),this.o=Ks(l[2]||""),this.g=Ks(l[3]||"",!0),va(this,l[4]),this.l=Ks(l[5]||"",!0),Np(this,l[6]||"",!0),this.m=Ks(l[7]||"")):(this.h=!1,this.i=new $s(null,this.h))}function sn(o){return new cr(o)}function Ea(o,l,d){o.j=d?Ks(l,!0):l,o.j&&(o.j=o.j.replace(/:$/,""))}function va(o,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);o.s=l}else o.s=null}function Np(o,l,d){l instanceof $s?(o.i=l,function My(o,l){l&&!o.j&&(Cn(o),o.i=null,o.g.forEach(function(d,m){var b=m.toLowerCase();m!=b&&(Op(this,m),Lp(this,b,d))},o)),o.j=l}(o.i,o.h)):(d||(l=zs(l,ky)),o.i=new $s(l,o.h))}function Tt(o,l,d){o.i.set(l,d)}function Aa(o){return Tt(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function Ks(o,l){return o?l?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function zs(o,l,d){return"string"==typeof o?(o=encodeURI(o).replace(l,xy),d&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function xy(o){return"%"+((o=o.charCodeAt(0))>>4&15).toString(16)+(15&o).toString(16)}cr.prototype.toString=function(){var o=[],l=this.j;l&&o.push(zs(l,Mp,!0),":");var d=this.g;return(d||"file"==l)&&(o.push("//"),(l=this.o)&&o.push(zs(l,Mp,!0),"@"),o.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(d=this.s)&&o.push(":",String(d))),(d=this.l)&&(this.g&&"/"!=d.charAt(0)&&o.push("/"),o.push(zs(d,"/"==d.charAt(0)?Dy:Cy,!0))),(d=this.i.toString())&&o.push("?",d),(d=this.m)&&o.push("#",zs(d,Ny)),o.join("")};var Mp=/[#\/\?@]/g,Cy=/[#\?:]/g,Dy=/[#\?]/g,ky=/[#\?@]/g,Ny=/#/g;function $s(o,l){this.h=this.g=null,this.i=o||null,this.j=!!l}function Cn(o){o.g||(o.g=new Map,o.h=0,o.i&&function Vy(o,l){if(o){o=o.split("&");for(var d=0;d<o.length;d++){var m=o[d].indexOf("="),b=null;if(0<=m){var C=o[d].substring(0,m);b=o[d].substring(m+1)}else C=o[d];l(C,b?decodeURIComponent(b.replace(/\+/g," ")):"")}}}(o.i,function(l,d){o.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}function Op(o,l){Cn(o),l=gi(o,l),o.g.has(l)&&(o.i=null,o.h-=o.g.get(l).length,o.g.delete(l))}function Fp(o,l){return Cn(o),l=gi(o,l),o.g.has(l)}function Lp(o,l,d){Op(o,l),0<d.length&&(o.i=null,o.g.set(gi(o,l),L(d)),o.h+=d.length)}function gi(o,l){return l=String(l),o.j&&(l=l.toLowerCase()),l}function Dn(o,l,d,m,b){try{b&&(b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null),m(d)}catch{}}function Ly(){this.g=new Iy}function qy(o,l,d){const m=d||"";try{Dp(o,function(b,C){let B=b;h(b)&&(B=Rl(b)),l.push(m+C+"="+encodeURIComponent(B))})}catch(b){throw l.push(m+"type="+encodeURIComponent("_badmap")),b}}function Qs(o){this.l=o.Ub||null,this.j=o.eb||!1}function wa(o,l){Qt.call(this),this.D=o,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function qp(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}function Ws(o){o.readyState=4,o.l=null,o.j=null,o.v=null,Hs(o)}function Hs(o){o.onreadystatechange&&o.onreadystatechange.call(o)}function Bp(o){let l="";return tt(o,function(d,m){l+=m,l+=":",l+=d,l+="\r\n"}),l}function Ol(o,l,d){t:{for(m in d){var m=!1;break t}m=!0}m||(d=Bp(d),"string"==typeof o?null!=d&&encodeURIComponent(String(d)):Tt(o,l,d))}function bt(o){Qt.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(r=$s.prototype).add=function(o,l){Cn(this),this.i=null,o=gi(this,o);var d=this.g.get(o);return d||this.g.set(o,d=[]),d.push(l),this.h+=1,this},r.forEach=function(o,l){Cn(this),this.g.forEach(function(d,m){d.forEach(function(b){o.call(l,b,m,this)},this)},this)},r.na=function(){Cn(this);const o=Array.from(this.g.values()),l=Array.from(this.g.keys()),d=[];for(let m=0;m<l.length;m++){const b=o[m];for(let C=0;C<b.length;C++)d.push(l[m])}return d},r.V=function(o){Cn(this);let l=[];if("string"==typeof o)Fp(this,o)&&(l=l.concat(this.g.get(gi(this,o))));else{o=Array.from(this.g.values());for(let d=0;d<o.length;d++)l=l.concat(o[d])}return l},r.set=function(o,l){return Cn(this),this.i=null,Fp(this,o=gi(this,o))&&(this.h-=this.g.get(o).length),this.g.set(o,[l]),this.h+=1,this},r.get=function(o,l){return o&&0<(o=this.V(o)).length?String(o[0]):l},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],l=Array.from(this.g.keys());for(var d=0;d<l.length;d++){var m=l[d];const C=encodeURIComponent(String(m)),B=this.V(m);for(m=0;m<B.length;m++){var b=C;""!==B[m]&&(b+="="+encodeURIComponent(String(B[m]))),o.push(b)}}return this.i=o.join("&")},N(Qs,Pl),Qs.prototype.g=function(){return new wa(this.l,this.j)},Qs.prototype.i=function(o){return function(){return o}}({}),N(wa,Qt),(r=wa.prototype).open=function(o,l){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=l,this.readyState=1,Hs(this)},r.send=function(o){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(l.body=o),(this.D||u).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Ws(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Hs(this)),this.g&&(this.readyState=3,Hs(this),this.g)))if("arraybuffer"===this.responseType)o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;qp(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))},r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var l=o.value?o.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!o.done}))&&(this.response=this.responseText+=l)}o.done?Ws(this):Hs(this),3==this.readyState&&qp(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,Ws(this))},r.Qa=function(o){this.g&&(this.response=o,Ws(this))},r.ga=function(){this.g&&Ws(this)},r.setRequestHeader=function(o,l){this.u.append(o,l)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],l=this.h.entries();for(var d=l.next();!d.done;)o.push((d=d.value)[0]+": "+d[1]),d=l.next();return o.join("\r\n")},Object.defineProperty(wa.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(o){this.m=o?"include":"same-origin"}}),N(bt,Qt);var By=/^https?$/i,Uy=["POST","PUT"];function Up(o,l){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=l,o.m=5,Gp(o),Ra(o)}function Gp(o){o.A||(o.A=!0,Xt(o,"complete"),Xt(o,"error"))}function jp(o){if(o.h&&typeof a<"u"&&(!o.v[1]||4!=on(o)||2!=o.Z()))if(o.u&&4==on(o))hp(o.Ea,0,o);else if(Xt(o,"readystatechange"),4==on(o)){o.h=!1;try{const B=o.Z();t:switch(B){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break t;default:l=!1}var d;if(!(d=l)){var m;if(m=0===B){var b=String(o.D).match(kp)[1]||null;!b&&u.self&&u.self.location&&(b=u.self.location.protocol.slice(0,-1)),m=!By.test(b?b.toLowerCase():"")}d=m}if(d)Xt(o,"complete"),Xt(o,"success");else{o.m=6;try{var C=2<on(o)?o.g.statusText:""}catch{C=""}o.l=C+" ["+o.Z()+"]",Gp(o)}}finally{Ra(o)}}}function Ra(o,l){if(o.g){Kp(o);const d=o.g,m=o.v[0]?()=>{}:null;o.g=null,o.v=null,l||Xt(o,"ready");try{d.onreadystatechange=m}catch{}}}function Kp(o){o.I&&(u.clearTimeout(o.I),o.I=null)}function on(o){return o.g?o.g.readyState:0}function zp(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function Ys(o,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[o]||l}function $p(o){this.Aa=0,this.i=[],this.j=new Gs,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ys("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ys("baseRetryDelayMs",5e3,o),this.cb=Ys("retryDelaySeedMs",1e4,o),this.Wa=Ys("forwardChannelMaxRetries",2,o),this.wa=Ys("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new bp(o&&o.concurrentRequestLimit),this.Da=new Ly,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Fl(o){if(Qp(o),3==o.G){var l=o.U++,d=sn(o.I);if(Tt(d,"SID",o.K),Tt(d,"RID",l),Tt(d,"TYPE","terminate"),Js(o,d),(l=new xn(o,o.j,l)).L=2,l.v=Aa(sn(d)),d=!1,u.navigator&&u.navigator.sendBeacon)try{d=u.navigator.sendBeacon(l.v.toString(),"")}catch{}!d&&u.Image&&((new Image).src=l.v,d=!0),d||(l.g=nm(l.j,null),l.g.ea(l.v)),l.F=Date.now(),Ia(l)}tm(o)}function Pa(o){o.g&&(ql(o),o.g.cancel(),o.g=null)}function Qp(o){Pa(o),o.u&&(u.clearTimeout(o.u),o.u=null),Sa(o),o.h.cancel(),o.s&&("number"==typeof o.s&&u.clearTimeout(o.s),o.s=null)}function ba(o){if(!Sp(o.h)&&!o.s){o.s=!0;var l=o.Ga;Ns||sp(),Ms||(Ns(),Ms=!0),gl.add(l,o),o.B=0}}function Wp(o,l){var d;d=l?l.l:o.U++;const m=sn(o.I);Tt(m,"SID",o.K),Tt(m,"RID",d),Tt(m,"AID",o.T),Js(o,m),o.m&&o.o&&Ol(m,o.m,o.o),d=new xn(o,o.j,d,o.B+1),null===o.m&&(d.H=o.o),l&&(o.i=l.D.concat(o.i)),l=Hp(o,d,1e3),d.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),Ml(o.h,d),Cl(d,m,l)}function Js(o,l){o.H&&tt(o.H,function(d,m){Tt(l,m,d)}),o.l&&Dp({},function(d,m){Tt(l,m,d)})}function Hp(o,l,d){d=Math.min(o.i.length,d);var m=o.l?T(o.l.Na,o.l,o):null;t:{var b=o.i;let C=-1;for(;;){const B=["count="+d];-1==C?0<d?(C=b[0].g,B.push("ofs="+C)):C=0:B.push("ofs="+C);let gt=!0;for(let Gt=0;Gt<d;Gt++){let ut=b[Gt].g;const Wt=b[Gt].map;if(ut-=C,0>ut)C=Math.max(0,b[Gt].g-100),gt=!1;else try{qy(Wt,B,"req"+ut+"_")}catch{m&&m(Wt)}}if(gt){m=B.join("&");break t}}}return o=o.i.splice(0,d),l.D=o,m}function Yp(o){if(!o.g&&!o.u){o.Y=1;var l=o.Fa;Ns||sp(),Ms||(Ns(),Ms=!0),gl.add(l,o),o.v=0}}function Ll(o){return!(o.g||o.u||3<=o.v||(o.Y++,o.u=Us(T(o.Fa,o),Zp(o,o.v)),o.v++,0))}function ql(o){null!=o.A&&(u.clearTimeout(o.A),o.A=null)}function Jp(o){o.g=new xn(o,o.j,"rpc",o.Y),null===o.m&&(o.g.H=o.o),o.g.O=0;var l=sn(o.qa);Tt(l,"RID","rpc"),Tt(l,"SID",o.K),Tt(l,"AID",o.T),Tt(l,"CI",o.F?"0":"1"),!o.F&&o.ja&&Tt(l,"TO",o.ja),Tt(l,"TYPE","xmlhttp"),Js(o,l),o.m&&o.o&&Ol(l,o.m,o.o),o.L&&(o.g.I=o.L);var d=o.g;o=o.ia,d.L=1,d.v=Aa(sn(l)),d.m=null,d.P=!0,wp(d,o)}function Sa(o){null!=o.C&&(u.clearTimeout(o.C),o.C=null)}function Xp(o,l){var d=null;if(o.g==l){Sa(o),ql(o),o.g=null;var m=2}else{if(!Nl(o.h,l))return;d=l.D,xp(o.h,l),m=1}if(0!=o.G)if(l.o)if(1==m){d=l.m?l.m.length:0,l=Date.now()-l.F;var b=o.B;Xt(m=_a(),new Ip(m,d)),ba(o)}else Yp(o);else if(3==(b=l.s)||0==b&&0<l.X||!(1==m&&function jy(o,l){return!(Vp(o.h)>=o.h.j-(o.s?1:0)||(o.s?(o.i=l.D.concat(o.i),0):1==o.G||2==o.G||o.B>=(o.Va?0:o.Wa)||(o.s=Us(T(o.Ga,o,l),Zp(o,o.B)),o.B++,0)))}(o,l)||2==m&&Ll(o)))switch(d&&0<d.length&&(l=o.h,l.i=l.i.concat(d)),b){case 1:lr(o,5);break;case 4:lr(o,10);break;case 3:lr(o,6);break;default:lr(o,2)}}function Zp(o,l){let d=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(d*=2),d*l}function lr(o,l){if(o.j.info("Error code "+l),2==l){var d=T(o.fb,o),m=o.Xa;const b=!m;m=new cr(m||"//www.google.com/images/cleardot.gif"),u.location&&"http"==u.location.protocol||Ea(m,"https"),Aa(m),b?function Oy(o,l){const d=new Gs;if(u.Image){const m=new Image;m.onload=S(Dn,d,"TestLoadImage: loaded",!0,l,m),m.onerror=S(Dn,d,"TestLoadImage: error",!1,l,m),m.onabort=S(Dn,d,"TestLoadImage: abort",!1,l,m),m.ontimeout=S(Dn,d,"TestLoadImage: timeout",!1,l,m),u.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=o}else l(!1)}(m.toString(),d):function Fy(o,l){new Gs;const m=new AbortController,b=setTimeout(()=>{m.abort(),Dn(0,0,!1,l)},1e4);fetch(o,{signal:m.signal}).then(C=>{clearTimeout(b),Dn(0,0,!!C.ok,l)}).catch(()=>{clearTimeout(b),Dn(0,0,!1,l)})}(m.toString(),d)}else Zt(2);o.G=0,o.l&&o.l.sa(l),tm(o),Qp(o)}function tm(o){if(o.G=0,o.ka=[],o.l){const l=Cp(o.h);(0!=l.length||0!=o.i.length)&&(F(o.ka,l),F(o.ka,o.i),o.h.i.length=0,L(o.i),o.i.length=0),o.l.ra()}}function em(o,l,d){var m=d instanceof cr?sn(d):new cr(d);if(""!=m.g)l&&(m.g=l+"."+m.g),va(m,m.s);else{var b=u.location;m=b.protocol,l=l?l+"."+b.hostname:b.hostname,b=+b.port;var C=new cr(null);m&&Ea(C,m),l&&(C.g=l),b&&va(C,b),d&&(C.l=d),m=C}return l=o.ya,(d=o.D)&&l&&Tt(m,d,l),Tt(m,"VER",o.la),Js(o,m),m}function nm(o,l,d){if(l&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return(l=new bt(o.Ca&&!o.pa?new Qs({eb:d}):o.pa)).Ha(o.J),l}function rm(){}function Va(){}function ue(o,l){Qt.call(this),this.g=new $p(l),this.l=o,this.h=l&&l.messageUrlParams||null,o=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(o?o["X-WebChannel-Content-Type"]=l.messageContentType:o={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(o?o["X-WebChannel-Client-Profile"]=l.va:o={"X-WebChannel-Client-Profile":l.va}),this.g.S=o,(o=l&&l.Sb)&&!Y(o)&&(this.g.m=o),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!Y(l)&&(this.g.D=l,null!==(o=this.h)&&l in o&&l in(o=this.h)&&delete o[l]),this.j=new _i(this)}function im(o){bl.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var l=o.__sm__;if(l){t:{for(const d in l){o=d;break t}o=void 0}(this.i=o)&&(o=this.i,l=null!==l&&o in l?l[o]:void 0),this.data=l}else this.data=o}function sm(){Sl.call(this),this.status=1}function _i(o){this.g=o}(r=bt.prototype).Ha=function(o){this.J=o},r.ea=function(o,l,d,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);l=l?l.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Vl.g(),this.v=function mp(o){return o.h||(o.h=o.i())}(this.o?this.o:Vl),this.g.onreadystatechange=T(this.Ea,this);try{this.B=!0,this.g.open(l,String(o),!0),this.B=!1}catch(C){return void Up(this,C)}if(o=d||"",d=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var b in m)d.set(b,m[b]);else{if("function"!=typeof m.keys||"function"!=typeof m.get)throw Error("Unknown input type for opt_headers: "+String(m));for(const C of m.keys())d.set(C,m.get(C))}m=Array.from(d.keys()).find(C=>"content-type"==C.toLowerCase()),b=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(Uy,l,void 0))||m||b||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[C,B]of d)this.g.setRequestHeader(C,B);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Kp(this),this.u=!0,this.g.send(o),this.u=!1}catch(C){Up(this,C)}},r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Xt(this,"complete"),Xt(this,"abort"),Ra(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ra(this,!0)),bt.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?jp(this):this.bb())},r.bb=function(){jp(this)},r.isActive=function(){return!!this.g},r.Z=function(){try{return 2<on(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var l=this.g.responseText;return o&&0==l.indexOf(o)&&(l=l.substring(o.length)),Ty(l)}},r.Ba=function(){return this.m},r.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(r=$p.prototype).la=8,r.G=1,r.connect=function(o,l,d,m){Zt(0),this.W=o,this.H=l||{},d&&void 0!==m&&(this.H.OSID=d,this.H.OAID=m),this.F=this.X,this.I=em(this,null,this.W),ba(this)},r.Ga=function(o){if(this.s)if(this.s=null,1==this.G){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;const b=new xn(this,this.j,o);let C=this.o;if(this.S&&(C?(C=y(C),A(C,this.S)):C=this.S),null!==this.m||this.O||(b.H=C,C=null),this.P)t:{for(var l=0,d=0;d<this.i.length;d++){var m=this.i[d];if(void 0===(m="__data__"in m.map&&"string"==typeof(m=m.map.__data__)?m.length:void 0))break;if(4096<(l+=m)){l=d;break t}if(4096===l||d===this.i.length-1){l=d+1;break t}}l=1e3}else l=1e3;l=Hp(this,b,l),Tt(d=sn(this.I),"RID",o),Tt(d,"CVER",22),this.D&&Tt(d,"X-HTTP-Session-Id",this.D),Js(this,d),C&&(this.O?l="headers="+encodeURIComponent(String(Bp(C)))+"&"+l:this.m&&Ol(d,this.m,C)),Ml(this.h,b),this.Ua&&Tt(d,"TYPE","init"),this.P?(Tt(d,"$req",l),Tt(d,"SID","null"),b.T=!0,Cl(b,d,null)):Cl(b,d,l),this.G=2}}else 3==this.G&&(o?Wp(this,o):0==this.i.length||Sp(this.h)||Wp(this))},r.Fa=function(){if(this.u=null,Jp(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=Us(T(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Zt(10),Pa(this),Jp(this))},r.Za=function(){null!=this.C&&(this.C=null,Pa(this),Ll(this),Zt(19))},r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Zt(2)):(this.j.info("Failed to ping google.com"),Zt(1))},r.isActive=function(){return!!this.l&&this.l.isActive(this)},(r=rm.prototype).ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){},Va.prototype.g=function(o,l){return new ue(o,l)},N(ue,Qt),ue.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},ue.prototype.close=function(){Fl(this.g)},ue.prototype.o=function(o){var l=this.g;if("string"==typeof o){var d={};d.__data__=o,o=d}else this.u&&((d={}).__data__=Rl(o),o=d);l.i.push(new Py(l.Ya++,o)),3==l.G&&ba(l)},ue.prototype.N=function(){this.g.l=null,delete this.j,Fl(this.g),delete this.g,ue.aa.N.call(this)},N(im,bl),N(sm,Sl),N(_i,rm),_i.prototype.ua=function(){Xt(this.g,"a")},_i.prototype.ta=function(o){Xt(this.g,new im(o))},_i.prototype.sa=function(o){Xt(this.g,new sm)},_i.prototype.ra=function(){Xt(this.g,"b")},Va.prototype.createWebChannel=Va.prototype.g,ue.prototype.send=ue.prototype.o,ue.prototype.open=ue.prototype.m,ue.prototype.close=ue.prototype.close,Ai=le.createWebChannelTransport=function(){return new Va},he=le.getStatEventTarget=function(){return _a()},to=le.Event=ar,vi=le.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ya.NO_ERROR=0,ya.TIMEOUT=8,ya.HTTP_ERROR=6,hr=le.ErrorCode=ya,Ep.COMPLETE="complete",Zs=le.EventType=Ep,gp.EventType=qs,qs.OPEN="a",qs.CLOSE="b",qs.ERROR="c",qs.MESSAGE="d",Qt.prototype.listen=Qt.prototype.K,Mn=le.WebChannel=gp,le.FetchXmlHttpFactory=Qs,bt.prototype.listenOnce=bt.prototype.L,bt.prototype.getLastError=bt.prototype.Ka,bt.prototype.getLastErrorCode=bt.prototype.Ba,bt.prototype.getStatus=bt.prototype.Z,bt.prototype.getResponseJson=bt.prototype.Oa,bt.prototype.getResponseText=bt.prototype.oa,bt.prototype.send=bt.prototype.ea,bt.prototype.setWithCredentials=bt.prototype.Ha,Ei=le.XhrIo=bt}).apply(typeof an<"u"?an:typeof self<"u"?self:typeof window<"u"?window:{});const dr="@firebase/firestore";class Pt{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Pt.UNAUTHENTICATED=new Pt(null),Pt.GOOGLE_CREDENTIALS=new Pt("google-credentials-uid"),Pt.FIRST_PARTY=new Pt("first-party-uid"),Pt.MOCK_USER=new Pt("mock-user");let Ae="11.5.0";const ge=new ce.Vy("@firebase/firestore");function Be(){return ge.logLevel}function M(r,...t){if(ge.logLevel<=ce.$b.DEBUG){const e=t.map(Ri);ge.debug(`Firestore (${Ae}): ${r}`,...e)}}function At(r,...t){if(ge.logLevel<=ce.$b.ERROR){const e=t.map(Ri);ge.error(`Firestore (${Ae}): ${r}`,...e)}}function ee(r,...t){if(ge.logLevel<=ce.$b.WARN){const e=t.map(Ri);ge.warn(`Firestore (${Ae}): ${r}`,...e)}}function Ri(r){if("string"==typeof r)return r;try{return JSON.stringify(r)}catch{return r}}function j(r="Unexpected state"){const t=`FIRESTORE (${Ae}) INTERNAL ASSERTION FAILED: `+r;throw At(t),new Error(t)}function z(r,t){r||j()}function q(r,t){return r}const x={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class O extends et.g{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Nt{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}class Ue{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class un{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(Pt.UNAUTHENTICATED))}shutdown(){}}class no{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}}class Ca{constructor(t){this.t=t,this.currentUser=Pt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){var n=this;z(void 0===this.o);let i=this.i;const s=h=>this.i!==i?(i=this.i,e(h)):Promise.resolve();let a=new Nt;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new Nt,t.enqueueRetryable(()=>s(this.currentUser))};const u=()=>{const h=a;t.enqueueRetryable((0,k.A)(function*(){yield h.promise,yield s(n.currentUser)}))},c=h=>{M("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),u())};this.t.onInit(h=>c(h)),setTimeout(()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?c(h):(M("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new Nt)}},0),u()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(n=>this.i!==t?(M("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(z("string"==typeof n.accessToken),new Ue(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return z(null===t||"string"==typeof t),new Pt(t)}}class Da{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=Pt.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const t=this.I();return t&&this.T.set("Authorization",t),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class ro{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new Da(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable(()=>e(Pt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Pi{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ge{constructor(t,e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,(0,te.xZ)(t)&&t.settings.appCheckToken&&(this.V=t.settings.appCheckToken)}start(t,e){z(void 0===this.o);const n=s=>{null!=s.error&&M("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.R;return this.R=s.token,M("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(s.token):Promise.resolve()};this.o=s=>{t.enqueueRetryable(()=>n(s))};const i=s=>{M("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):M("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new Pi(this.V));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(z("string"==typeof e.token),this.R=e.token,new Pi(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function io(r){const t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(r);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(e);else for(let n=0;n<r;n++)e[n]=Math.floor(256*Math.random());return e}function bi(){return new TextEncoder}class so{static newId(){const e=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const i=io(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<e&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return n}}function H(r,t){return r<t?-1:r>t?1:0}function On(r,t){let e=0;for(;e<r.length&&e<t.length;){const n=r.codePointAt(e),i=t.codePointAt(e);if(n!==i){if(n<128&&i<128)return H(n,i);{const s=bi(),a=pr(s.encode(fr(r,e)),s.encode(fr(t,e)));return 0!==a?a:H(n,i)}}e+=n>65535?2:1}return H(r.length,t.length)}function fr(r,t){return r.codePointAt(t)>65535?r.substring(t,t+2):r.substring(t,t+1)}function pr(r,t){for(let e=0;e<r.length&&e<t.length;++e)if(r[e]!==t[e])return H(r[e],t[e]);return H(r.length,t.length)}function we(r,t,e){return r.length===t.length&&r.every((n,i)=>e(n,t[i]))}const gr=-62135596800;class pt{static now(){return pt.fromMillis(Date.now())}static fromDate(t){return pt.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new pt(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new O(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new O(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<gr)throw new O(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new O(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?H(this.nanoseconds,t.nanoseconds):H(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds-gr).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Q{static fromTimestamp(t){return new Q(t)}static min(){return new Q(new pt(0,0))}static max(){return new Q(new pt(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Fn="__name__";class de{constructor(t,e,n){void 0===e?e=0:e>t.length&&j(),void 0===n?n=t.length-e:n>t.length-e&&j(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===de.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof de?t.forEach(n=>{e.push(n)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let i=0;i<n;i++){const s=de.compareSegments(t.get(i),e.get(i));if(0!==s)return s}return H(t.length,e.length)}static compareSegments(t,e){const n=de.isNumericId(t),i=de.isNumericId(e);return n&&!i?-1:!n&&i?1:n&&i?de.extractNumericId(t).compare(de.extractNumericId(e)):On(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return Yt.fromString(t.substring(4,t.length-2))}}class nt extends de{construct(t,e,n){return new nt(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new O(x.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(i=>i.length>0))}return new nt(e)}static emptyPath(){return new nt([])}}const Na=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class dt extends de{construct(t,e,n){return new dt(t,e,n)}static isValidIdentifier(t){return Na.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),dt.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Fn}static keyField(){return new dt([Fn])}static fromServerFormat(t){const e=[];let n="",i=0;const s=()=>{if(0===n.length)throw new O(x.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let a=!1;for(;i<t.length;){const u=t[i];if("\\"===u){if(i+1===t.length)throw new O(x.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const c=t[i+1];if("\\"!==c&&"."!==c&&"`"!==c)throw new O(x.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=c,i+=2}else"`"===u?(a=!a,i++):"."!==u||a?(n+=u,i++):(s(),i++)}if(s(),a)throw new O(x.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new dt(e)}static emptyPath(){return new dt([])}}class U{constructor(t){this.path=t}static fromPath(t){return new U(nt.fromString(t))}static fromName(t){return new U(nt.fromString(t).popFirst(5))}static empty(){return new U(nt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===nt.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return nt.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new U(new nt(t.slice()))}}class Lt{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Lt(Q.min(),U.empty(),-1)}static max(){return new Lt(Q.max(),U.empty(),-1)}}function Tr(r,t){let e=r.readTime.compareTo(t.readTime);return 0!==e?e:(e=U.comparator(r.documentKey,t.documentKey),0!==e?e:H(r.largestBatchId,t.largestBatchId))}class Ir{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}function ye(r){return Si.apply(this,arguments)}function Si(){return(Si=(0,k.A)(function*(r){if(r.code!==x.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==r.message)throw r;M("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class P{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&j(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new P((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(t,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(e,s).next(n,i)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{const e=t();return e instanceof P?e:P.resolve(e)}catch(e){return P.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):P.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):P.reject(e)}static resolve(t){return new P((e,n)=>{e(t)})}static reject(t){return new P((e,n)=>{n(t)})}static waitFor(t){return new P((e,n)=>{let i=0,s=0,a=!1;t.forEach(u=>{++i,u.next(()=>{++s,a&&s===i&&e()},c=>n(c))}),a=!0,s===i&&e()})}static or(t){let e=P.resolve(!1);for(const n of t)e=e.next(i=>i?P.resolve(i):n());return e}static forEach(t,e){const n=[];return t.forEach((i,s)=>{n.push(e.call(this,i,s))}),this.waitFor(n)}static mapArray(t,e){return new P((n,i)=>{const s=t.length,a=new Array(s);let u=0;for(let c=0;c<s;c++){const h=c;e(t[h]).next(p=>{a[h]=p,++u,u===s&&n(a)},p=>i(p))}})}static doWhile(t,e){return new P((n,i)=>{const s=()=>{!0===t()?e().next(()=>{s()},i):n()};s()})}}function be(r){return"IndexedDbTransactionError"===r.name}let ne=(()=>{class r{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=i=>this.oe(i),this._e=i=>n.writeSequenceNumber(i))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}return r.ae=-1,r})();function Qe(r){return null==r}function ln(r){return 0===r&&1/r==-1/0}function La(r,t){let e=t;const n=r.length;for(let i=0;i<n;i++){const s=r.charAt(i);switch(s){case"\0":e+="\x01\x10";break;case"\x01":e+="\x01\x11";break;default:e+=s}}return e}function co(r){return r+"\x01\x01"}const qn="mutationQueues",se="mutations",hn="documentMutations",oe="remoteDocumentGlobal",xe="targets",Ce="targetDocuments",Ye="targetGlobal",wt="collectionParents",De="clientMetadata",pn="bundles",mn="namedQueries";function Dr(r){let t=0;for(const e in r)Object.prototype.hasOwnProperty.call(r,e)&&t++;return t}function ke(r,t){for(const e in r)Object.prototype.hasOwnProperty.call(r,e)&&t(e,r[e])}function Yi(r){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}class lt{constructor(t,e){this.comparator=t,this.root=e||Vt.EMPTY}insert(t,e){return new lt(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Vt.BLACK,null,null))}remove(t){return new lt(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Vt.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(t,n.key);if(0===i)return e+n.left.size;i<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){const t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Nr(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Nr(this.root,t,this.comparator,!1)}getReverseIterator(){return new Nr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Nr(this.root,t,this.comparator,!0)}}class Nr{constructor(t,e,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Vt{constructor(t,e,n,i,s){this.key=t,this.value=e,this.color=null!=n?n:Vt.RED,this.left=null!=i?i:Vt.EMPTY,this.right=null!=s?s:Vt.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,i,s){return new Vt(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this;const s=n(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===s?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Vt.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===e(t,i.key)){if(i.right.isEmpty())return Vt.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Vt.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Vt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw j();const t=this.left.check();if(t!==this.right.check())throw j();return t+(this.isRed()?0:1)}}Vt.EMPTY=null,Vt.RED=!0,Vt.BLACK=!1,Vt.EMPTY=new class{constructor(){this.size=0}get key(){throw j()}get value(){throw j()}get color(){throw j()}get left(){throw j()}get right(){throw j()}copy(t,e,n,i,s){return this}insert(t,e,n){return new Vt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ct{constructor(t){this.comparator=t,this.data=new lt(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new To(this.data.getIterator())}getIteratorFrom(t){return new To(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(n=>{e=e.add(n)}),e}isEqual(t){if(!(t instanceof ct)||this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const i=e.getNext().key,s=n.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new ct(this.comparator);return e.data=t,e}}class To{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class qt{constructor(t){this.fields=t,t.sort(dt.comparator)}static empty(){return new qt([])}unionWith(t){let e=new ct(dt.comparator);for(const n of this.fields)e=e.add(n);for(const n of t)e=e.add(n);return new qt(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return we(this.fields,t.fields,(e,n)=>e.isEqual(n))}}class Ji extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class It{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Ji("Invalid base64 string: "+s):s}}(t);return new It(e)}static fromUint8Array(t){const e=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(t);return new It(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const n=new Uint8Array(e.length);for(let i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return H(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}It.EMPTY_BYTE_STRING=new It("");const Ya=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Te(r){if(z(!!r),"string"==typeof r){let t=0;const e=Ya.exec(r);if(z(!!e),e[1]){let i=e[1];i=(i+"000000000").substr(0,9),t=Number(i)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:ft(r.seconds),nanos:ft(r.nanos)}}function ft(r){return"number"==typeof r?r:"string"==typeof r?Number(r):0}function Ie(r){return"string"==typeof r?It.fromBase64String(r):It.fromUint8Array(r)}const Mr="server_timestamp",Io="__type__",Eo="__previous_value__",Ja="__local_write_time__";function gn(r){var t,e;return(null===(e=((null===(t=null==r?void 0:r.mapValue)||void 0===t?void 0:t.fields)||{})[Io])||void 0===e?void 0:e.stringValue)===Mr}function Xi(r){const t=r.mapValue.fields[Eo];return gn(t)?Xi(t):t}function Or(r){const t=Te(r.mapValue.fields[Ja].timestampValue);return new pt(t.seconds,t.nanos)}class Xa{constructor(t,e,n,i,s,a,u,c,h){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=h}}const Je="(default)";class me{constructor(t,e){this.projectId=t,this.database=e||Je}static empty(){return new me("","")}get isDefaultDatabase(){return this.database===Je}isEqual(t){return t instanceof me&&t.projectId===this.projectId&&t.database===this.database}}const Zi="__type__",Za="__max__",Me_mapValue={fields:{__type__:{stringValue:Za}}},ts="__vector__",f="value";function w(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?gn(r)?4:Ql(r)?9007199254740991:Ao(r)?10:11:j()}function D(r,t){if(r===t)return!0;const e=w(r);if(e!==w(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return Or(r).isEqual(Or(t));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const a=Te(i.timestampValue),u=Te(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(r,t);case 5:return r.stringValue===t.stringValue;case 6:return s=t,Ie(r.bytesValue).isEqual(Ie(s.bytesValue));case 7:return r.referenceValue===t.referenceValue;case 8:return function(i,s){return ft(i.geoPointValue.latitude)===ft(s.geoPointValue.latitude)&&ft(i.geoPointValue.longitude)===ft(s.geoPointValue.longitude)}(r,t);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ft(i.integerValue)===ft(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const a=ft(i.doubleValue),u=ft(s.doubleValue);return a===u?ln(a)===ln(u):isNaN(a)&&isNaN(u)}return!1}(r,t);case 9:return we(r.arrayValue.values||[],t.arrayValue.values||[],D);case 10:case 11:return function(i,s){const a=i.mapValue.fields||{},u=s.mapValue.fields||{};if(Dr(a)!==Dr(u))return!1;for(const c in a)if(a.hasOwnProperty(c)&&(void 0===u[c]||!D(a[c],u[c])))return!1;return!0}(r,t);default:return j()}var s}function G(r,t){return void 0!==(r.values||[]).find(e=>D(e,t))}function K(r,t){if(r===t)return 0;const e=w(r),n=w(t);if(e!==n)return H(e,n);switch(e){case 0:case 9007199254740991:return 0;case 1:return H(r.booleanValue,t.booleanValue);case 2:return function(s,a){const u=ft(s.integerValue||s.doubleValue),c=ft(a.integerValue||a.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1}(r,t);case 3:return X(r.timestampValue,t.timestampValue);case 4:return X(Or(r),Or(t));case 5:return On(r.stringValue,t.stringValue);case 6:return function(s,a){const u=Ie(s),c=Ie(a);return u.compareTo(c)}(r.bytesValue,t.bytesValue);case 7:return function(s,a){const u=s.split("/"),c=a.split("/");for(let h=0;h<u.length&&h<c.length;h++){const p=H(u[h],c[h]);if(0!==p)return p}return H(u.length,c.length)}(r.referenceValue,t.referenceValue);case 8:return function(s,a){const u=H(ft(s.latitude),ft(a.latitude));return 0!==u?u:H(ft(s.longitude),ft(a.longitude))}(r.geoPointValue,t.geoPointValue);case 9:return Et(r.arrayValue,t.arrayValue);case 10:return function(s,a){var u,c,h,p;const S=null===(u=(s.fields||{})[f])||void 0===u?void 0:u.arrayValue,N=null===(c=(a.fields||{})[f])||void 0===c?void 0:c.arrayValue,L=H((null===(h=null==S?void 0:S.values)||void 0===h?void 0:h.length)||0,(null===(p=null==N?void 0:N.values)||void 0===p?void 0:p.length)||0);return 0!==L?L:Et(S,N)}(r.mapValue,t.mapValue);case 11:return function(s,a){if(s===Me_mapValue&&a===Me_mapValue)return 0;if(s===Me_mapValue)return 1;if(a===Me_mapValue)return-1;const u=s.fields||{},c=Object.keys(u),h=a.fields||{},p=Object.keys(h);c.sort(),p.sort();for(let g=0;g<c.length&&g<p.length;++g){const T=On(c[g],p[g]);if(0!==T)return T;const S=K(u[c[g]],h[p[g]]);if(0!==S)return S}return H(c.length,p.length)}(r.mapValue,t.mapValue);default:throw j()}}function X(r,t){if("string"==typeof r&&"string"==typeof t&&r.length===t.length)return H(r,t);const e=Te(r),n=Te(t),i=H(e.seconds,n.seconds);return 0!==i?i:H(e.nanos,n.nanos)}function Et(r,t){const e=r.values||[],n=t.values||[];for(let i=0;i<e.length&&i<n.length;++i){const s=K(e[i],n[i]);if(s)return s}return H(e.length,n.length)}function _t(r){return xt(r)}function xt(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(e){const n=Te(e);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?Ie(r.bytesValue).toBase64():"referenceValue"in r?U.fromName(r.referenceValue).toString():"geoPointValue"in r?function(e){return`geo(${e.latitude},${e.longitude})`}(r.geoPointValue):"arrayValue"in r?function(e){let n="[",i=!0;for(const s of e.values||[])i?i=!1:n+=",",n+=xt(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(e){const n=Object.keys(e.fields||{}).sort();let i="{",s=!0;for(const a of n)s?s=!1:i+=",",i+=`${a}:${xt(e.fields[a])}`;return i+"}"}(r.mapValue):j()}function ae(r){switch(w(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=Xi(r);return t?16+ae(t):16;case 5:return 2*r.stringValue.length;case 6:return Ie(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return(r.arrayValue.values||[]).reduce((i,s)=>i+ae(s),0);case 10:case 11:return function(n){let i=0;return ke(n.fields,(s,a)=>{i+=s.length+ae(a)}),i}(r.mapValue);default:throw j()}}function tu(r){return!!r&&"integerValue"in r}function es(r){return!!r&&"arrayValue"in r}function zl(r){return!!r&&"nullValue"in r}function $l(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function vo(r){return!!r&&"mapValue"in r}function Ao(r){var t,e;return(null===(e=((null===(t=null==r?void 0:r.mapValue)||void 0===t?void 0:t.fields)||{})[Zi])||void 0===e?void 0:e.stringValue)===ts}function ns(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&"object"==typeof r.timestampValue)return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const t={mapValue:{fields:{}}};return ke(r.mapValue.fields,(e,n)=>t.mapValue.fields[e]=ns(n)),t}if(r.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(r.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=ns(r.arrayValue.values[e]);return t}return Object.assign({},r)}function Ql(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===Za}class Bt{constructor(t){this.value=t}static empty(){return new Bt({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!vo(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=ns(e)}setAll(t){let e=dt.emptyPath(),n={},i=[];t.forEach((a,u)=>{if(!e.isImmediateParentOf(u)){const c=this.getFieldsMap(e);this.applyChanges(c,n,i),n={},i=[],e=u.popLast()}a?n[u.lastSegment()]=ns(a):i.push(u.lastSegment())});const s=this.getFieldsMap(e);this.applyChanges(s,n,i)}delete(t){const e=this.field(t.popLast());vo(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return D(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let i=e.mapValue.fields[t.get(n)];vo(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,n){ke(e,(i,s)=>t[i]=s);for(const i of n)delete t[i]}clone(){return new Bt(ns(this.value))}}function Jl(r){const t=[];return ke(r.fields,(e,n)=>{const i=new dt([e]);if(vo(n)){const s=Jl(n.mapValue).fields;if(0===s.length)t.push(i);else for(const a of s)t.push(i.child(a))}else t.push(i)}),new qt(t)}class yt{constructor(t,e,n,i,s,a,u){this.key=t,this.documentType=e,this.version=n,this.readTime=i,this.createTime=s,this.data=a,this.documentState=u}static newInvalidDocument(t){return new yt(t,0,Q.min(),Q.min(),Q.min(),Bt.empty(),0)}static newFoundDocument(t,e,n,i){return new yt(t,1,e,Q.min(),n,i,0)}static newNoDocument(t,e){return new yt(t,2,e,Q.min(),Q.min(),Bt.empty(),0)}static newUnknownDocument(t,e){return new yt(t,3,e,Q.min(),Q.min(),Bt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(Q.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Bt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Bt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Q.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof yt&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new yt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class _n{constructor(t,e){this.position=t,this.inclusive=e}}function Xl(r,t,e){let n=0;for(let i=0;i<r.position.length;i++){const s=t[i],a=r.position[i];if(n=s.field.isKeyField()?U.comparator(U.fromName(a.referenceValue),e.key):K(a,e.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function Zl(r,t){if(null===r)return null===t;if(null===t||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let e=0;e<r.position.length;e++)if(!D(r.position[e],t.position[e]))return!1;return!0}class rs{constructor(t,e="asc"){this.field=t,this.dir=e}}function um(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}class th{}class st extends th{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new cm(t,e,n):"array-contains"===e?new dm(t,n):"in"===e?new oh(t,n):"not-in"===e?new fm(t,n):"array-contains-any"===e?new pm(t,n):new st(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new lm(t,n):new hm(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(K(e,this.value)):null!==e&&w(this.value)===w(e)&&this.matchesComparison(K(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return j()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ht extends th{constructor(t,e){super(),this.filters=t,this.op=e,this.ce=null}static create(t,e){return new ht(t,e)}matches(t){return Fr(this)?void 0===this.filters.find(e=>!e.matches(t)):void 0!==this.filters.find(e=>e.matches(t))}getFlattenedFilters(){return null!==this.ce||(this.ce=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function Fr(r){return"and"===r.op}function nu(r){return function eh(r){for(const t of r.filters)if(t instanceof ht)return!1;return!0}(r)&&Fr(r)}function ru(r){if(r instanceof st)return r.field.canonicalString()+r.op.toString()+_t(r.value);if(nu(r))return r.filters.map(t=>ru(t)).join(",");{const t=r.filters.map(e=>ru(e)).join(",");return`${r.op}(${t})`}}function nh(r,t){return r instanceof st?(n=r,(i=t)instanceof st&&n.op===i.op&&n.field.isEqual(i.field)&&D(n.value,i.value)):r instanceof ht?function(n,i){return i instanceof ht&&n.op===i.op&&n.filters.length===i.filters.length&&n.filters.reduce((s,a,u)=>s&&nh(a,i.filters[u]),!0)}(r,t):void j();var n,i}function ih(r){return r instanceof st?`${(e=r).field.canonicalString()} ${e.op} ${_t(e.value)}`:r instanceof ht?function(e){return e.op.toString()+" {"+e.getFilters().map(ih).join(" ,")+"}"}(r):"Filter";var e}class cm extends st{constructor(t,e,n){super(t,e,n),this.key=U.fromName(n.referenceValue)}matches(t){const e=U.comparator(t.key,this.key);return this.matchesComparison(e)}}class lm extends st{constructor(t,e){super(t,"in",e),this.keys=sh(0,e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class hm extends st{constructor(t,e){super(t,"not-in",e),this.keys=sh(0,e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function sh(r,t){var e;return((null===(e=t.arrayValue)||void 0===e?void 0:e.values)||[]).map(n=>U.fromName(n.referenceValue))}class dm extends st{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return es(e)&&G(e.arrayValue,this.value)}}class oh extends st{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&G(this.value.arrayValue,e)}}class fm extends st{constructor(t,e){super(t,"not-in",e)}matches(t){if(G(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!G(this.value.arrayValue,e)}}class pm extends st{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!es(e)||!e.arrayValue.values)&&e.arrayValue.values.some(n=>G(this.value.arrayValue,n))}}class mm{constructor(t,e=null,n=[],i=[],s=null,a=null,u=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=a,this.endAt=u,this.le=null}}function iu(r,t=null,e=[],n=[],i=null,s=null,a=null){return new mm(r,t,e,n,i,s,a)}function zn(r){const t=q(r);if(null===t.le){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(n=>ru(n)).join(","),e+="|ob:",e+=t.orderBy.map(n=>{return(s=n).field.canonicalString()+s.dir;var s}).join(","),Qe(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(n=>_t(n)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(n=>_t(n)).join(",")),t.le=e}return t.le}function is(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<r.orderBy.length;e++)if(!um(r.orderBy[e],t.orderBy[e]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let e=0;e<r.filters.length;e++)if(!nh(r.filters[e],t.filters[e]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!Zl(r.startAt,t.startAt)&&Zl(r.endAt,t.endAt)}function wo(r){return U.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length}class Xe{constructor(t,e=null,n=[],i=[],s=null,a="F",u=null,c=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=c,this.he=null,this.Pe=null,this.Te=null}}function Lr(r){return new Xe(r)}function lh(r){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())}function qr(r){const t=q(r);if(null===t.he){t.he=[];const e=new Set;for(const s of t.explicitOrderBy)t.he.push(s),e.add(s.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new ct(dt.comparator);return a.filters.forEach(c=>{c.getFlattenedFilters().forEach(h=>{h.isInequality()&&(u=u.add(h.field))})}),u})(t).forEach(s=>{e.has(s.canonicalString())||s.isKeyField()||t.he.push(new rs(s,n))}),e.has(dt.keyField().canonicalString())||t.he.push(new rs(dt.keyField(),n))}return t.he}function jt(r){const t=q(r);return t.Pe||(t.Pe=function dh(r,t){if("F"===r.limitType)return iu(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(i=>new rs(i.field,"desc"===i.dir?"asc":"desc"));const e=r.endAt?new _n(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new _n(r.startAt.position,r.startAt.inclusive):null;return iu(r.path,r.collectionGroup,t,r.filters,r.limit,e,n)}}(t,qr(r))),t.Pe}function Po(r,t,e){return new Xe(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,e,r.startAt,r.endAt)}function ss(r,t){return is(jt(r),jt(t))&&r.limitType===t.limitType}function fh(r){return`${zn(jt(r))}|lt:${r.limitType}`}function Br(r){return`Query(target=${function(e){let n=e.path.canonicalString();return null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map(i=>ih(i)).join(", ")}]`),Qe(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map(i=>{return`${(a=i).field.canonicalString()} (${a.dir})`;var a}).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(i=>_t(i)).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(i=>_t(i)).join(",")),`Target(${n})`}(jt(r))}; limitType=${r.limitType})`}function os(r,t){return t.isFoundDocument()&&function(n,i){const s=i.key.path;return null!==n.collectionGroup?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):U.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,t)&&function(n,i){for(const s of qr(n))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(r,t)&&function(n,i){for(const s of n.filters)if(!s.matches(i))return!1;return!0}(r,t)&&(i=t,!((n=r).startAt&&!function(a,u,c){const h=Xl(a,u,c);return a.inclusive?h<=0:h<0}(n.startAt,qr(n),i)||n.endAt&&!function(a,u,c){const h=Xl(a,u,c);return a.inclusive?h>=0:h>0}(n.endAt,qr(n),i)));var n,i}function mh(r){return(t,e)=>{let n=!1;for(const i of qr(r)){const s=gm(i,t,e);if(0!==s)return s;n=n||i.field.isKeyField()}return 0}}function gm(r,t,e){const n=r.field.isKeyField()?U.comparator(t.key,e.key):function(s,a,u){const c=a.data.field(s),h=u.data.field(s);return null!==c&&null!==h?K(c,h):j()}(r.field,t,e);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return j()}}class Ze{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[i,s]of n)if(this.equalsFn(i,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),i=this.inner[n];if(void 0===i)return this.inner[n]=[[t,e]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],t))return void(i[s]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],t))return 1===n.length?delete this.inner[e]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(t){ke(this.inner,(e,n)=>{for(const[i,s]of n)t(i,s)})}isEmpty(){return Yi(this.inner)}size(){return this.innerSize}}const _m=new lt(U.comparator);function ie(){return _m}const gh=new lt(U.comparator);function as(...r){let t=gh;for(const e of r)t=t.insert(e.key,e);return t}function _h(r){let t=gh;return r.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function Oe(){return us()}function yh(){return us()}function us(){return new Ze(r=>r.toString(),(r,t)=>r.isEqual(t))}const ym=new lt(U.comparator),Tm=new ct(U.comparator);function Z(...r){let t=Tm;for(const e of r)t=t.add(e);return t}const Im=new ct(H);function uu(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ln(t)?"-0":t}}function Th(r){return{integerValue:""+r}}function Ih(r,t){return function uo(r){return"number"==typeof r&&Number.isInteger(r)&&!ln(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}(t)?Th(t):uu(r,t)}class bo{constructor(){this._=void 0}}function Em(r,t,e){return r instanceof Ur?function(i,s){const a={fields:{[Io]:{stringValue:Mr},[Ja]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&gn(s)&&(s=Xi(s)),s&&(a.fields[Eo]=s),{mapValue:a}}(e,t):r instanceof $n?vh(r,t):r instanceof Qn?Ah(r,t):function(i,s){const a=Eh(i,s),u=wh(a)+wh(i.Ie);return tu(a)&&tu(i.Ie)?Th(u):uu(i.serializer,u)}(r,t)}function vm(r,t,e){return r instanceof $n?vh(r,t):r instanceof Qn?Ah(r,t):e}function Eh(r,t){return r instanceof Gr?tu(n=t)||(s=n)&&"doubleValue"in s?t:{integerValue:0}:null;var n,s}class Ur extends bo{}class $n extends bo{constructor(t){super(),this.elements=t}}function vh(r,t){const e=Rh(t);for(const n of r.elements)e.some(i=>D(i,n))||e.push(n);return{arrayValue:{values:e}}}class Qn extends bo{constructor(t){super(),this.elements=t}}function Ah(r,t){let e=Rh(t);for(const n of r.elements)e=e.filter(i=>!D(i,n));return{arrayValue:{values:e}}}class Gr extends bo{constructor(t,e){super(),this.serializer=t,this.Ie=e}}function wh(r){return ft(r.integerValue||r.doubleValue)}function Rh(r){return es(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class wm{constructor(t,e){this.version=t,this.transformResults=e}}class vt{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new vt}static exists(t){return new vt(void 0,t)}static updateTime(t){return new vt(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function So(r,t){return void 0!==r.updateTime?t.isFoundDocument()&&t.version.isEqual(r.updateTime):void 0===r.exists||r.exists===t.isFoundDocument()}class Vo{}function Ph(r,t){if(!r.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return r.isNoDocument()?new Kr(r.key,vt.none()):new jr(r.key,r.data,vt.none());{const e=r.data,n=Bt.empty();let i=new ct(dt.comparator);for(let s of t.fields)if(!i.has(s)){let a=e.field(s);null===a&&s.length>1&&(s=s.popLast(),a=e.field(s)),null===a?n.delete(s):n.set(s,a),i=i.add(s)}return new tn(r.key,n,new qt(i.toArray()),vt.none())}}function Rm(r,t,e){r instanceof jr?function(i,s,a){const u=i.value.clone(),c=Vh(i.fieldTransforms,s,a.transformResults);u.setAll(c),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,t,e):r instanceof tn?function(i,s,a){if(!So(i.precondition,s))return void s.convertToUnknownDocument(a.version);const u=Vh(i.fieldTransforms,s,a.transformResults),c=s.data;c.setAll(Sh(i)),c.setAll(u),s.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(r,t,e):t.convertToNoDocument(e.version).setHasCommittedMutations()}function ls(r,t,e,n){return r instanceof jr?function(s,a,u,c){if(!So(s.precondition,a))return u;const h=s.value.clone(),p=xh(s.fieldTransforms,c,a);return h.setAll(p),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),null}(r,t,e,n):r instanceof tn?function(s,a,u,c){if(!So(s.precondition,a))return u;const h=xh(s.fieldTransforms,c,a),p=a.data;return p.setAll(Sh(s)),p.setAll(h),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),null===u?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(g=>g.field))}(r,t,e,n):(u=e,So(r.precondition,a=t)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u);var a,u}function Pm(r,t){let e=null;for(const n of r.fieldTransforms){const i=t.data.field(n.field),s=Eh(n.transform,i||null);null!=s&&(null===e&&(e=Bt.empty()),e.set(n.field,s))}return e||null}function bh(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&(i=t.fieldTransforms,!!(void 0===(n=r.fieldTransforms)&&void 0===i||n&&i&&we(n,i,(s,a)=>function Am(r,t){return r.field.isEqual(t.field)&&(i=t.transform,(n=r.transform)instanceof $n&&i instanceof $n||n instanceof Qn&&i instanceof Qn?we(n.elements,i.elements,D):n instanceof Gr&&i instanceof Gr?D(n.Ie,i.Ie):n instanceof Ur&&i instanceof Ur);var n,i}(s,a))))&&(0===r.type?r.value.isEqual(t.value):1!==r.type||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask));var n,i}class jr extends Vo{constructor(t,e,n,i=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class tn extends Vo{constructor(t,e,n,i,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Sh(r){const t=new Map;return r.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){const n=r.data.field(e);t.set(e,n)}}),t}function Vh(r,t,e){const n=new Map;z(r.length===e.length);for(let i=0;i<e.length;i++){const s=r[i],a=s.transform,u=t.data.field(s.field);n.set(s.field,vm(a,u,e[i]))}return n}function xh(r,t,e){const n=new Map;for(const i of r){const s=i.transform,a=e.data.field(i.field);n.set(i.field,Em(s,a,t))}return n}class Kr extends Vo{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class cu extends Vo{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class lu{constructor(t,e,n,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(t.key)&&Rm(s,t,n[i])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=ls(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=ls(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=yh();return this.mutations.forEach(i=>{const s=t.get(i.key),a=s.overlayedDocument;let u=this.applyToLocalView(a,s.mutatedFields);u=e.has(i.key)?null:u;const c=Ph(a,u);null!==c&&n.set(i.key,c),a.isValidDocument()||a.convertToNoDocument(Q.min())}),n}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),Z())}isEqual(t){return this.batchId===t.batchId&&we(this.mutations,t.mutations,(e,n)=>bh(e,n))&&we(this.baseMutations,t.baseMutations,(e,n)=>bh(e,n))}}class hu{constructor(t,e,n,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=i}static from(t,e,n){z(t.mutations.length===n.length);let i=function(){return ym}();const s=t.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,n[a].version);return new hu(t,e,n,i)}}class du{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class bm{constructor(t,e){this.count=t,this.unchangedNames=e}}var Mt,ot;function kh(r){if(void 0===r)return At("GRPC error has no .code"),x.UNKNOWN;switch(r){case Mt.OK:return x.OK;case Mt.CANCELLED:return x.CANCELLED;case Mt.UNKNOWN:return x.UNKNOWN;case Mt.DEADLINE_EXCEEDED:return x.DEADLINE_EXCEEDED;case Mt.RESOURCE_EXHAUSTED:return x.RESOURCE_EXHAUSTED;case Mt.INTERNAL:return x.INTERNAL;case Mt.UNAVAILABLE:return x.UNAVAILABLE;case Mt.UNAUTHENTICATED:return x.UNAUTHENTICATED;case Mt.INVALID_ARGUMENT:return x.INVALID_ARGUMENT;case Mt.NOT_FOUND:return x.NOT_FOUND;case Mt.ALREADY_EXISTS:return x.ALREADY_EXISTS;case Mt.PERMISSION_DENIED:return x.PERMISSION_DENIED;case Mt.FAILED_PRECONDITION:return x.FAILED_PRECONDITION;case Mt.ABORTED:return x.ABORTED;case Mt.OUT_OF_RANGE:return x.OUT_OF_RANGE;case Mt.UNIMPLEMENTED:return x.UNIMPLEMENTED;case Mt.DATA_LOSS:return x.DATA_LOSS;default:return j()}}(ot=Mt||(Mt={}))[ot.OK=0]="OK",ot[ot.CANCELLED=1]="CANCELLED",ot[ot.UNKNOWN=2]="UNKNOWN",ot[ot.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ot[ot.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ot[ot.NOT_FOUND=5]="NOT_FOUND",ot[ot.ALREADY_EXISTS=6]="ALREADY_EXISTS",ot[ot.PERMISSION_DENIED=7]="PERMISSION_DENIED",ot[ot.UNAUTHENTICATED=16]="UNAUTHENTICATED",ot[ot.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ot[ot.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ot[ot.ABORTED=10]="ABORTED",ot[ot.OUT_OF_RANGE=11]="OUT_OF_RANGE",ot[ot.UNIMPLEMENTED=12]="UNIMPLEMENTED",ot[ot.INTERNAL=13]="INTERNAL",ot[ot.UNAVAILABLE=14]="UNAVAILABLE",ot[ot.DATA_LOSS=15]="DATA_LOSS";const Sm=new Yt([4294967295,4294967295],0);function Nh(r){const t=bi().encode(r),e=new Ii;return e.update(t),new Uint8Array(e.digest())}function Mh(r){const t=new DataView(r.buffer),e=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new Yt([e,n],0),new Yt([i,s],0)]}class fu{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new hs(`Invalid padding: ${e}`);if(n<0)throw new hs(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new hs(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new hs(`Invalid padding when bitmap length is 0: ${e}`);this.Ee=8*t.length-e,this.de=Yt.fromNumber(this.Ee)}Ae(t,e,n){let i=t.add(e.multiply(Yt.fromNumber(n)));return 1===i.compare(Sm)&&(i=new Yt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.de).toNumber()}Re(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.Ee)return!1;const e=Nh(t),[n,i]=Mh(e);for(let s=0;s<this.hashCount;s++){const a=this.Ae(n,i,s);if(!this.Re(a))return!1}return!0}static create(t,e,n){const i=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),a=new fu(s,i,e);return n.forEach(u=>a.insert(u)),a}insert(t){if(0===this.Ee)return;const e=Nh(t),[n,i]=Mh(e);for(let s=0;s<this.hashCount;s++){const a=this.Ae(n,i,s);this.Ve(a)}}Ve(t){const e=Math.floor(t/8);this.bitmap[e]|=1<<t%8}}class hs extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ds{constructor(t,e,n,i,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const i=new Map;return i.set(t,fs.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new ds(Q.min(),i,new lt(H),ie(),Z())}}class fs{constructor(t,e,n,i,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new fs(n,e,Z(),Z(),Z())}}class Co{constructor(t,e,n,i){this.me=t,this.removedTargetIds=e,this.key=n,this.fe=i}}class Oh{constructor(t,e){this.targetId=t,this.ge=e}}class Fh{constructor(t,e,n=It.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=i}}class Lh{constructor(){this.pe=0,this.ye=qh(),this.we=It.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return 0!==this.pe}get ve(){return this.be}Ce(t){t.approximateByteSize()>0&&(this.be=!0,this.we=t)}Fe(){let t=Z(),e=Z(),n=Z();return this.ye.forEach((i,s)=>{switch(s){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:n=n.add(i);break;default:j()}}),new fs(this.we,this.Se,t,e,n)}Me(){this.be=!1,this.ye=qh()}xe(t,e){this.be=!0,this.ye=this.ye.insert(t,e)}Oe(t){this.be=!0,this.ye=this.ye.remove(t)}Ne(){this.pe+=1}Be(){this.pe-=1,z(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class Vm{constructor(t){this.ke=t,this.qe=new Map,this.Qe=ie(),this.$e=Do(),this.Ue=Do(),this.Ke=new lt(H)}We(t){for(const e of t.me)t.fe&&t.fe.isFoundDocument()?this.Ge(e,t.fe):this.ze(e,t.key,t.fe);for(const e of t.removedTargetIds)this.ze(e,t.key,t.fe)}je(t){this.forEachTarget(t,e=>{const n=this.He(e);switch(t.state){case 0:this.Je(e)&&n.Ce(t.resumeToken);break;case 1:n.Be(),n.De||n.Me(),n.Ce(t.resumeToken);break;case 2:n.Be(),n.De||this.removeTarget(e);break;case 3:this.Je(e)&&(n.Le(),n.Ce(t.resumeToken));break;case 4:this.Je(e)&&(this.Ye(e),n.Ce(t.resumeToken));break;default:j()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.qe.forEach((n,i)=>{this.Je(i)&&e(i)})}Ze(t){const e=t.targetId,n=t.ge.count,i=this.Xe(e);if(i){const s=i.target;if(wo(s))if(0===n){const a=new U(s.path);this.ze(e,a,yt.newNoDocument(a,Q.min()))}else z(1===n);else{const a=this.et(e);if(a!==n){const u=this.tt(t),c=u?this.nt(u,t,a):1;0!==c&&(this.Ye(e),this.Ke=this.Ke.insert(e,2===c?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}tt(t){const e=t.ge.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=e;let a,u;try{a=Ie(n).toUint8Array()}catch(c){if(c instanceof Ji)return ee("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new fu(a,i,s)}catch(c){return ee(c instanceof hs?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return 0===u.Ee?null:u}nt(t,e,n){return e.ge.count===n-this.st(t,e.targetId)?0:2}st(t,e){const n=this.ke.getRemoteKeysForTarget(e);let i=0;return n.forEach(s=>{const a=this.ke.it(),u=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;t.mightContain(u)||(this.ze(e,s,null),i++)}),i}ot(t){const e=new Map;this.qe.forEach((s,a)=>{const u=this.Xe(a);if(u){if(s.current&&wo(u.target)){const c=new U(u.target.path);this._t(c).has(a)||this.ut(a,c)||this.ze(a,c,yt.newNoDocument(c,t))}s.ve&&(e.set(a,s.Fe()),s.Me())}});let n=Z();this.Ue.forEach((s,a)=>{let u=!0;a.forEachWhile(c=>{const h=this.Xe(c);return!h||"TargetPurposeLimboResolution"===h.purpose||(u=!1,!1)}),u&&(n=n.add(s))}),this.Qe.forEach((s,a)=>a.setReadTime(t));const i=new ds(t,e,this.Ke,this.Qe,n);return this.Qe=ie(),this.$e=Do(),this.Ue=Do(),this.Ke=new lt(H),i}Ge(t,e){if(!this.Je(t))return;const n=this.ut(t,e.key)?2:0;this.He(t).xe(e.key,n),this.Qe=this.Qe.insert(e.key,e),this.$e=this.$e.insert(e.key,this._t(e.key).add(t)),this.Ue=this.Ue.insert(e.key,this.ct(e.key).add(t))}ze(t,e,n){if(!this.Je(t))return;const i=this.He(t);this.ut(t,e)?i.xe(e,1):i.Oe(e),this.Ue=this.Ue.insert(e,this.ct(e).delete(t)),this.Ue=this.Ue.insert(e,this.ct(e).add(t)),n&&(this.Qe=this.Qe.insert(e,n))}removeTarget(t){this.qe.delete(t)}et(t){const e=this.He(t).Fe();return this.ke.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ne(t){this.He(t).Ne()}He(t){let e=this.qe.get(t);return e||(e=new Lh,this.qe.set(t,e)),e}ct(t){let e=this.Ue.get(t);return e||(e=new ct(H),this.Ue=this.Ue.insert(t,e)),e}_t(t){let e=this.$e.get(t);return e||(e=new ct(H),this.$e=this.$e.insert(t,e)),e}Je(t){const e=null!==this.Xe(t);return e||M("WatchChangeAggregator","Detected inactive target",t),e}Xe(t){const e=this.qe.get(t);return e&&e.De?null:this.ke.lt(t)}Ye(t){this.qe.set(t,new Lh),this.ke.getRemoteKeysForTarget(t).forEach(e=>{this.ze(t,e,null)})}ut(t,e){return this.ke.getRemoteKeysForTarget(t).has(e)}}function Do(){return new lt(U.comparator)}function qh(){return new lt(U.comparator)}const xm={asc:"ASCENDING",desc:"DESCENDING"},Cm={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Dm={and:"AND",or:"OR"};class km{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function pu(r,t){return r.useProto3Json||Qe(t)?t:{value:t}}function zr(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Bh(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function Nm(r,t){return zr(r,t.toTimestamp())}function Ct(r){return z(!!r),Q.fromTimestamp(function(e){const n=Te(e);return new pt(n.seconds,n.nanos)}(r))}function mu(r,t){return gu(r,t).canonicalString()}function gu(r,t){const e=(i=r,new nt(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===t?e:e.child(t)}function Uh(r){const t=nt.fromString(r);return z(Xh(t)),t}function ps(r,t){return mu(r.databaseId,t.path)}function Fe(r,t){const e=Uh(t);if(e.get(1)!==r.databaseId.projectId)throw new O(x.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+r.databaseId.projectId);if(e.get(3)!==r.databaseId.database)throw new O(x.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+r.databaseId.database);return new U(Kh(e))}function Gh(r,t){return mu(r.databaseId,t)}function _u(r){return new nt(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function Kh(r){return z(r.length>4&&"documents"===r.get(4)),r.popFirst(5)}function zh(r,t,e){return{name:ps(r,t),fields:e.value.mapValue.fields}}function Qh(r,t){return{documents:[Gh(r,t.path)]}}function ko(r,t){const e={structuredQuery:{}},n=t.path;let i;null!==t.collectionGroup?(i=n,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=n.popLast(),e.structuredQuery.from=[{collectionId:n.lastSegment()}]),e.parent=Gh(r,i);const s=function(h){if(0!==h.length)return Jh(ht.create(h,"and"))}(t.filters);s&&(e.structuredQuery.where=s);const a=function(h){if(0!==h.length)return h.map(p=>{return{field:yn((T=p).field),direction:qm(T.dir)};var T})}(t.orderBy);a&&(e.structuredQuery.orderBy=a);const u=pu(r,t.limit);return null!==u&&(e.structuredQuery.limit=u),t.startAt&&(e.structuredQuery.startAt={before:(h=t.startAt).inclusive,values:h.position}),t.endAt&&(e.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(t.endAt)),{ht:e,parent:i};var h}function Hh(r){let t=function jh(r){const t=Uh(r);return 4===t.length?nt.emptyPath():Kh(t)}(r.parent);const e=r.structuredQuery,n=e.from?e.from.length:0;let i=null;if(n>0){z(1===n);const p=e.from[0];p.allDescendants?i=p.collectionId:t=t.child(p.collectionId)}let s=[];e.where&&(s=function(g){const T=Yh(g);return T instanceof ht&&nu(T)?T.getFilters():[T]}(e.where));let a=[];e.orderBy&&(a=e.orderBy.map(T=>{return new rs($r((N=T).field),function(F){switch(F){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(N.direction));var N}));let u=null;e.limit&&(u=function(g){let T;return T="object"==typeof g?g.value:g,Qe(T)?null:T}(e.limit));let c=null;var g;e.startAt&&(c=new _n((g=e.startAt).values||[],!!g.before));let h=null;return e.endAt&&(h=function(g){return new _n(g.values||[],!g.before)}(e.endAt)),function ch(r,t,e,n,i,s,a,u){return new Xe(r,t,e,n,i,s,a,u)}(t,i,a,s,u,"F",c,h)}function Yh(r){return void 0!==r.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const n=$r(e.unaryFilter.field);return st.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=$r(e.unaryFilter.field);return st.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=$r(e.unaryFilter.field);return st.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=$r(e.unaryFilter.field);return st.create(a,"!=",{nullValue:"NULL_VALUE"});default:return j()}}(r):void 0!==r.fieldFilter?st.create($r((e=r).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return j()}}(e.fieldFilter.op),e.fieldFilter.value):void 0!==r.compositeFilter?function(e){return ht.create(e.compositeFilter.filters.map(n=>Yh(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return j()}}(e.compositeFilter.op))}(r):j();var e}function qm(r){return xm[r]}function Bm(r){return Cm[r]}function Um(r){return Dm[r]}function yn(r){return{fieldPath:r.canonicalString()}}function $r(r){return dt.fromServerFormat(r.fieldPath)}function Jh(r){return r instanceof st?function(e){if("=="===e.op){if($l(e.value))return{unaryFilter:{field:yn(e.field),op:"IS_NAN"}};if(zl(e.value))return{unaryFilter:{field:yn(e.field),op:"IS_NULL"}}}else if("!="===e.op){if($l(e.value))return{unaryFilter:{field:yn(e.field),op:"IS_NOT_NAN"}};if(zl(e.value))return{unaryFilter:{field:yn(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:yn(e.field),op:Bm(e.op),value:e.value}}}(r):r instanceof ht?function(e){const n=e.getFilters().map(i=>Jh(i));return 1===n.length?n[0]:{compositeFilter:{op:Um(e.op),filters:n}}}(r):j()}function Gm(r){const t=[];return r.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Xh(r){return r.length>=4&&"projects"===r.get(0)&&"databases"===r.get(2)}class en{constructor(t,e,n,i,s=Q.min(),a=Q.min(),u=It.EMPTY_BYTE_STRING,c=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(t){return new en(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new en(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new en(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new en(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Zh{constructor(t){this.Tt=t}}function Tu(r){const t=Hh({parent:r.parent,structuredQuery:r.structuredQuery});return"LAST"===r.limitType?Po(t,t.limit,"L"):t}class Jn{constructor(){}At(t,e){this.Rt(t,e),e.Vt()}Rt(t,e){if("nullValue"in t)this.ft(e,5);else if("booleanValue"in t)this.ft(e,10),e.gt(t.booleanValue?1:0);else if("integerValue"in t)this.ft(e,15),e.gt(ft(t.integerValue));else if("doubleValue"in t){const n=ft(t.doubleValue);isNaN(n)?this.ft(e,13):(this.ft(e,15),ln(n)?e.gt(0):e.gt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.ft(e,20),"string"==typeof n&&(n=Te(n)),e.yt(`${n.seconds||""}`),e.gt(n.nanos||0)}else if("stringValue"in t)this.wt(t.stringValue,e),this.St(e);else if("bytesValue"in t)this.ft(e,30),e.bt(Ie(t.bytesValue)),this.St(e);else if("referenceValue"in t)this.Dt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.ft(e,45),e.gt(n.latitude||0),e.gt(n.longitude||0)}else"mapValue"in t?Ql(t)?this.ft(e,Number.MAX_SAFE_INTEGER):Ao(t)?this.vt(t.mapValue,e):(this.Ct(t.mapValue,e),this.St(e)):"arrayValue"in t?(this.Ft(t.arrayValue,e),this.St(e)):j()}wt(t,e){this.ft(e,25),this.Mt(t,e)}Mt(t,e){e.yt(t)}Ct(t,e){const n=t.fields||{};this.ft(e,55);for(const i of Object.keys(n))this.wt(i,e),this.Rt(n[i],e)}vt(t,e){var n,i;const s=t.fields||{};this.ft(e,53);const a=f,u=(null===(i=null===(n=s[a].arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.length)||0;this.ft(e,15),e.gt(ft(u)),this.wt(a,e),this.Rt(s[a],e)}Ft(t,e){const n=t.values||[];this.ft(e,50);for(const i of n)this.Rt(i,e)}Dt(t,e){this.ft(e,37),U.fromName(t).path.forEach(n=>{this.ft(e,60),this.Mt(n,e)})}ft(t,e){t.gt(e)}St(t){t.gt(2)}}Jn.xt=new Jn;class Jm{constructor(){this.Tn=new Ru}addToCollectionParentIndex(t,e){return this.Tn.add(e),P.resolve()}getCollectionParents(t,e){return P.resolve(this.Tn.getEntries(e))}addFieldIndex(t,e){return P.resolve()}deleteFieldIndex(t,e){return P.resolve()}deleteAllFieldIndexes(t){return P.resolve()}createTargetIndexes(t,e){return P.resolve()}getDocumentsMatchingTarget(t,e){return P.resolve(null)}getIndexType(t,e){return P.resolve(0)}getFieldIndexes(t,e){return P.resolve([])}getNextCollectionGroupToUpdate(t){return P.resolve(null)}getMinOffset(t,e){return P.resolve(Lt.min())}getMinOffsetFromCollectionGroup(t,e){return P.resolve(Lt.min())}updateCollectionGroup(t,e,n){return P.resolve()}updateIndexEntries(t,e){return P.resolve()}}class Ru{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e]||new ct(nt.comparator),s=!i.has(n);return this.index[e]=i.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e];return i&&i.has(n)}getEntries(t){return(this.index[t]||new ct(nt.comparator)).toArray()}}new Uint8Array(0);const md={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Kt{static withCacheSize(t){return new Kt(t,Kt.DEFAULT_COLLECTION_PERCENTILE,Kt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}}Kt.DEFAULT_COLLECTION_PERCENTILE=10,Kt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Kt.DEFAULT=new Kt(41943040,Kt.DEFAULT_COLLECTION_PERCENTILE,Kt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Kt.DISABLED=new Kt(-1,0,0);class Zn{constructor(t){this.$n=t}next(){return this.$n+=2,this.$n}static Un(){return new Zn(0)}static Kn(){return new Zn(-1)}}const Ed="LruGarbageCollector";function Ad([r,t],[e,n]){const i=H(r,e);return 0===i?H(t,n):i}class tg{constructor(t){this.Hn=t,this.buffer=new ct(Ad),this.Jn=0}Yn(){return++this.Jn}Zn(t){const e=[t,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(e);else{const n=this.buffer.last();Ad(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}}get maxValue(){return this.buffer.last()[0]}}class wd{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Xn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return null!==this.Xn}er(t){var e=this;M(Ed,`Garbage collection scheduled in ${t}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(0,k.A)(function*(){e.Xn=null;try{yield e.localStore.collectGarbage(e.garbageCollector)}catch(n){be(n)?M(Ed,"Ignoring IndexedDB error during garbage collection: ",n):yield ye(n)}yield e.er(3e5)}))}}class eg{constructor(t,e){this.tr=t,this.params=e}calculateTargetCount(t,e){return this.tr.nr(t).next(n=>Math.floor(e/100*n))}nthSequenceNumber(t,e){if(0===e)return P.resolve(ne.ae);const n=new tg(e);return this.tr.forEachTarget(t,i=>n.Zn(i.sequenceNumber)).next(()=>this.tr.rr(t,i=>n.Zn(i))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.tr.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.tr.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(M("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve(md)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(M("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),md):this.ir(t,e))}getCacheSize(t){return this.tr.getCacheSize(t)}ir(t,e){let n,i,s,a,u,c,h;const p=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(M("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,a=Date.now(),this.nthSequenceNumber(t,i))).next(g=>(n=g,u=Date.now(),this.removeTargets(t,n,e))).next(g=>(s=g,c=Date.now(),this.removeOrphanedDocuments(t,n))).next(g=>(h=Date.now(),Be()<=ce.$b.DEBUG&&M("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${a-p}ms\n\tDetermined least recently used ${i} in `+(u-a)+`ms\n\tRemoved ${s} targets in `+(c-u)+`ms\n\tRemoved ${g} documents in `+(h-c)+`ms\nTotal Duration: ${h-p}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:g})))}}class Pd{constructor(){this.changes=new Ze(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,yt.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?P.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class sg{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Cd{constructor(t,e,n,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=i}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next(i=>(n=i,this.remoteDocumentCache.getEntry(t,e))).next(i=>(null!==n&&ls(n.mutation,i,qt.empty(),pt.now()),i))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.getLocalViewOfDocuments(t,n,Z()).next(()=>n))}getLocalViewOfDocuments(t,e,n=Z()){const i=Oe();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,n).next(s=>{let a=as();return s.forEach((u,c)=>{a=a.insert(u,c.overlayedDocument)}),a}))}getOverlayedDocuments(t,e){const n=Oe();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,Z()))}populateOverlays(t,e,n){const i=[];return n.forEach(s=>{e.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(t,i).next(s=>{s.forEach((a,u)=>{e.set(a,u)})})}computeViews(t,e,n,i){let s=ie();const a=us(),u=us();return e.forEach((c,h)=>{const p=n.get(h.key);i.has(h.key)&&(void 0===p||p.mutation instanceof tn)?s=s.insert(h.key,h):void 0!==p?(a.set(h.key,p.mutation.getFieldMask()),ls(p.mutation,h,p.mutation.getFieldMask(),pt.now())):a.set(h.key,qt.empty())}),this.recalculateAndSaveOverlays(t,s).next(c=>(c.forEach((h,p)=>a.set(h,p)),e.forEach((h,p)=>{var g;return u.set(h,new sg(p,null!==(g=a.get(h))&&void 0!==g?g:null))}),u))}recalculateAndSaveOverlays(t,e){const n=us();let i=new lt((a,u)=>a-u),s=Z();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(a=>{for(const u of a)u.keys().forEach(c=>{const h=e.get(c);if(null===h)return;let p=n.get(c)||qt.empty();p=u.applyToLocalView(h,p),n.set(c,p);const g=(i.get(u.batchId)||Z()).add(c);i=i.insert(u.batchId,g)})}).next(()=>{const a=[],u=i.getReverseIterator();for(;u.hasNext();){const c=u.getNext(),h=c.key,p=c.value,g=yh();p.forEach(T=>{if(!s.has(T)){const S=Ph(e.get(T),n.get(T));null!==S&&g.set(T,S),s=s.add(T)}}),a.push(this.documentOverlayCache.saveOverlays(t,h,g))}return P.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.recalculateAndSaveOverlays(t,n))}getDocumentsMatchingQuery(t,e,n,i){return U.isDocumentKey((a=e).path)&&null===a.collectionGroup&&0===a.filters.length?this.getDocumentsMatchingDocumentQuery(t,e.path):function su(r){return null!==r.collectionGroup}(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,i):this.getDocumentsMatchingCollectionQuery(t,e,n,i);var a}getNextDocuments(t,e,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,i).next(s=>{const a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,i-s.size):P.resolve(Oe());let u=-1,c=s;return a.next(h=>P.forEach(h,(p,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),s.get(p)?P.resolve():this.remoteDocumentCache.getEntry(t,p).next(T=>{c=c.insert(p,T)}))).next(()=>this.populateOverlays(t,h,s)).next(()=>this.computeViews(t,c,h,Z())).next(p=>({batchId:u,changes:_h(p)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new U(e)).next(n=>{let i=as();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(t,e,n,i){const s=e.collectionGroup;let a=as();return this.indexManager.getCollectionParents(t,s).next(u=>P.forEach(u,c=>{const h=(g=e,T=c.child(s),new Xe(T,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt));var g,T;return this.getDocumentsMatchingCollectionQuery(t,h,n,i).next(p=>{p.forEach((g,T)=>{a=a.insert(g,T)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,e,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,s,i))).next(a=>{s.forEach((c,h)=>{const p=h.getKey();null===a.get(p)&&(a=a.insert(p,yt.newInvalidDocument(p)))});let u=as();return a.forEach((c,h)=>{const p=s.get(c);void 0!==p&&ls(p.mutation,h,qt.empty(),pt.now()),os(e,h)&&(u=u.insert(c,h))}),u})}}class og{constructor(t){this.serializer=t,this.dr=new Map,this.Ar=new Map}getBundleMetadata(t,e){return P.resolve(this.dr.get(e))}saveBundleMetadata(t,e){return this.dr.set(e.id,{id:(i=e).id,version:i.version,createTime:Ct(i.createTime)}),P.resolve();var i}getNamedQuery(t,e){return P.resolve(this.Ar.get(e))}saveNamedQuery(t,e){return this.Ar.set(e.name,{name:(i=e).name,query:Tu(i.bundledQuery),readTime:Ct(i.readTime)}),P.resolve();var i}}class ag{constructor(){this.overlays=new lt(U.comparator),this.Rr=new Map}getOverlay(t,e){return P.resolve(this.overlays.get(e))}getOverlays(t,e){const n=Oe();return P.forEach(e,i=>this.getOverlay(t,i).next(s=>{null!==s&&n.set(i,s)})).next(()=>n)}saveOverlays(t,e,n){return n.forEach((i,s)=>{this.Et(t,e,s)}),P.resolve()}removeOverlaysForBatchId(t,e,n){const i=this.Rr.get(n);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Rr.delete(n)),P.resolve()}getOverlaysForCollection(t,e,n){const i=Oe(),s=e.length+1,a=new U(e.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const c=u.getNext().value,h=c.getKey();if(!e.isPrefixOf(h.path))break;h.path.length===s&&c.largestBatchId>n&&i.set(c.getKey(),c)}return P.resolve(i)}getOverlaysForCollectionGroup(t,e,n,i){let s=new lt((h,p)=>h-p);const a=this.overlays.getIterator();for(;a.hasNext();){const h=a.getNext().value;if(h.getKey().getCollectionGroup()===e&&h.largestBatchId>n){let p=s.get(h.largestBatchId);null===p&&(p=Oe(),s=s.insert(h.largestBatchId,p)),p.set(h.getKey(),h)}}const u=Oe(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((h,p)=>u.set(h,p)),!(u.size()>=i)););return P.resolve(u)}Et(t,e,n){const i=this.overlays.get(n.key);if(null!==i){const a=this.Rr.get(i.largestBatchId).delete(n.key);this.Rr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new du(e,n));let s=this.Rr.get(e);void 0===s&&(s=Z(),this.Rr.set(e,s)),this.Rr.set(e,s.add(n.key))}}class ug{constructor(){this.sessionToken=It.EMPTY_BYTE_STRING}getSessionToken(t){return P.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,P.resolve()}}class Pu{constructor(){this.Vr=new ct(Ft.mr),this.gr=new ct(Ft.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(t,e){const n=new Ft(t,e);this.Vr=this.Vr.add(n),this.gr=this.gr.add(n)}yr(t,e){t.forEach(n=>this.addReference(n,e))}removeReference(t,e){this.wr(new Ft(t,e))}Sr(t,e){t.forEach(n=>this.removeReference(n,e))}br(t){const e=new U(new nt([])),n=new Ft(e,t),i=new Ft(e,t+1),s=[];return this.gr.forEachInRange([n,i],a=>{this.wr(a),s.push(a.key)}),s}Dr(){this.Vr.forEach(t=>this.wr(t))}wr(t){this.Vr=this.Vr.delete(t),this.gr=this.gr.delete(t)}vr(t){const e=new U(new nt([])),n=new Ft(e,t),i=new Ft(e,t+1);let s=Z();return this.gr.forEachInRange([n,i],a=>{s=s.add(a.key)}),s}containsKey(t){const e=new Ft(t,0),n=this.Vr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Ft{constructor(t,e){this.key=t,this.Cr=e}static mr(t,e){return U.comparator(t.key,e.key)||H(t.Cr,e.Cr)}static pr(t,e){return H(t.Cr,e.Cr)||U.comparator(t.key,e.key)}}class cg{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.Fr=1,this.Mr=new ct(Ft.mr)}checkEmpty(t){return P.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,i){const s=this.Fr;this.Fr++;const a=new lu(s,e,n,i);this.mutationQueue.push(a);for(const u of i)this.Mr=this.Mr.add(new Ft(u.key,s)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast());return P.resolve(a)}lookupMutationBatch(t,e){return P.resolve(this.Or(e))}getNextMutationBatchAfterBatchId(t,e){const i=this.Nr(e+1),s=i<0?0:i;return P.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(0===this.mutationQueue.length?-1:this.Fr-1)}getAllMutationBatches(t){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Ft(e,0),i=new Ft(e,Number.POSITIVE_INFINITY),s=[];return this.Mr.forEachInRange([n,i],a=>{const u=this.Or(a.Cr);s.push(u)}),P.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new ct(H);return e.forEach(i=>{const s=new Ft(i,0),a=new Ft(i,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([s,a],u=>{n=n.add(u.Cr)})}),P.resolve(this.Br(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,i=n.length+1;let s=n;U.isDocumentKey(s)||(s=s.child(""));const a=new Ft(new U(s),0);let u=new ct(H);return this.Mr.forEachWhile(c=>{const h=c.key.path;return!!n.isPrefixOf(h)&&(h.length===i&&(u=u.add(c.Cr)),!0)},a),P.resolve(this.Br(u))}Br(t){const e=[];return t.forEach(n=>{const i=this.Or(n);null!==i&&e.push(i)}),e}removeMutationBatch(t,e){z(0===this.Lr(e.batchId,"removed")),this.mutationQueue.shift();let n=this.Mr;return P.forEach(e.mutations,i=>{const s=new Ft(i.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(()=>{this.Mr=n})}qn(t){}containsKey(t,e){const n=new Ft(e,0),i=this.Mr.firstAfterOrEqual(n);return P.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return P.resolve()}Lr(t,e){return this.Nr(t)}Nr(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Or(t){const e=this.Nr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class lg{constructor(t){this.kr=t,this.docs=new lt(U.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,i=this.docs.get(n),s=i?i.size:0,a=this.kr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return P.resolve(n?n.document.mutableCopy():yt.newInvalidDocument(e))}getEntries(t,e){let n=ie();return e.forEach(i=>{const s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():yt.newInvalidDocument(i))}),P.resolve(n)}getDocumentsMatchingQuery(t,e,n,i){let s=ie();const a=e.path,u=new U(a.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){const{key:h,value:{document:p}}=c.getNext();if(!a.isPrefixOf(h.path))break;h.path.length>a.length+1||Tr(new Lt((r=p).readTime,r.key,-1),n)<=0||(i.has(p.key)||os(e,p))&&(s=s.insert(p.key,p.mutableCopy()))}var r;return P.resolve(s)}getAllFromCollectionGroup(t,e,n,i){j()}qr(t,e){return P.forEach(this.docs,n=>e(n))}newChangeBuffer(t){return new hg(this)}getSize(t){return P.resolve(this.size)}}class hg extends Pd{constructor(t){super(),this.Ir=t}applyChanges(t){const e=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?e.push(this.Ir.addEntry(t,i)):this.Ir.removeEntry(n)}),P.waitFor(e)}getFromCache(t,e){return this.Ir.getEntry(t,e)}getAllFromCache(t,e){return this.Ir.getEntries(t,e)}}class dg{constructor(t){this.persistence=t,this.Qr=new Ze(e=>zn(e),is),this.lastRemoteSnapshotVersion=Q.min(),this.highestTargetId=0,this.$r=0,this.Ur=new Pu,this.targetCount=0,this.Kr=Zn.Un()}forEachTarget(t,e){return this.Qr.forEach((n,i)=>e(i)),P.resolve()}getLastRemoteSnapshotVersion(t){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return P.resolve(this.$r)}allocateTargetId(t){return this.highestTargetId=this.Kr.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.$r&&(this.$r=e),P.resolve()}zn(t){this.Qr.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Kr=new Zn(e),this.highestTargetId=e),t.sequenceNumber>this.$r&&(this.$r=t.sequenceNumber)}addTargetData(t,e){return this.zn(e),this.targetCount+=1,P.resolve()}updateTargetData(t,e){return this.zn(e),P.resolve()}removeTargetData(t,e){return this.Qr.delete(e.target),this.Ur.br(e.targetId),this.targetCount-=1,P.resolve()}removeTargets(t,e,n){let i=0;const s=[];return this.Qr.forEach((a,u)=>{u.sequenceNumber<=e&&null===n.get(u.targetId)&&(this.Qr.delete(a),s.push(this.removeMatchingKeysForTargetId(t,u.targetId)),i++)}),P.waitFor(s).next(()=>i)}getTargetCount(t){return P.resolve(this.targetCount)}getTargetData(t,e){const n=this.Qr.get(e)||null;return P.resolve(n)}addMatchingKeys(t,e,n){return this.Ur.yr(e,n),P.resolve()}removeMatchingKeys(t,e,n){this.Ur.Sr(e,n);const i=this.persistence.referenceDelegate,s=[];return i&&e.forEach(a=>{s.push(i.markPotentiallyOrphaned(t,a))}),P.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Ur.br(e),P.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Ur.vr(e);return P.resolve(n)}containsKey(t,e){return P.resolve(this.Ur.containsKey(e))}}class bu{constructor(t,e){this.Wr={},this.overlays={},this.Gr=new ne(0),this.zr=!1,this.zr=!0,this.jr=new ug,this.referenceDelegate=t(this),this.Hr=new dg(this),this.indexManager=new Jm,this.remoteDocumentCache=new lg(n=>this.referenceDelegate.Jr(n)),this.serializer=new Zh(e),this.Yr=new og(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new ag,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Wr[t.toKey()];return n||(n=new cg(e,this.referenceDelegate),this.Wr[t.toKey()]=n),n}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(t,e,n){M("MemoryPersistence","Starting transaction:",t);const i=new fg(this.Gr.next());return this.referenceDelegate.Zr(),n(i).next(s=>this.referenceDelegate.Xr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}ei(t,e){return P.or(Object.values(this.Wr).map(n=>()=>n.containsKey(t,e)))}}class fg extends Ir{constructor(t){super(),this.currentSequenceNumber=t}}class Uo{constructor(t){this.persistence=t,this.ti=new Pu,this.ni=null}static ri(t){return new Uo(t)}get ii(){if(this.ni)return this.ni;throw j()}addReference(t,e,n){return this.ti.addReference(n,e),this.ii.delete(n.toString()),P.resolve()}removeReference(t,e,n){return this.ti.removeReference(n,e),this.ii.add(n.toString()),P.resolve()}markPotentiallyOrphaned(t,e){return this.ii.add(e.toString()),P.resolve()}removeTarget(t,e){this.ti.br(e.targetId).forEach(i=>this.ii.add(i.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(i=>{i.forEach(s=>this.ii.add(s.toString()))}).next(()=>n.removeTargetData(t,e))}Zr(){this.ni=new Set}Xr(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.ii,n=>{const i=U.fromPath(n);return this.si(t,i).next(s=>{s||e.removeEntry(i,Q.min())})}).next(()=>(this.ni=null,e.apply(t)))}updateLimboDocument(t,e){return this.si(t,e).next(n=>{n?this.ii.delete(e.toString()):this.ii.add(e.toString())})}Jr(t){return 0}si(t,e){return P.or([()=>P.resolve(this.ti.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.ei(t,e)])}}class Go{constructor(t,e){this.persistence=t,this.oi=new Ze(n=>function Ot(r){let t="";for(let e=0;e<r.length;e++)t.length>0&&(t=co(t)),t=La(r.get(e),t);return co(t)}(n.path),(n,i)=>n.isEqual(i)),this.garbageCollector=function Rd(r,t){return new eg(r,t)}(this,e)}static ri(t,e){return new Go(t,e)}Zr(){}Xr(t){return P.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}nr(t){const e=this.sr(t);return this.persistence.getTargetCache().getTargetCount(t).next(n=>e.next(i=>n+i))}sr(t){let e=0;return this.rr(t,n=>{e++}).next(()=>e)}rr(t,e){return P.forEach(this.oi,(n,i)=>this.ar(t,n,i).next(s=>s?P.resolve():e(i)))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0;const i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.qr(t,a=>this.ar(t,a,e).next(u=>{u||(n++,s.removeEntry(a,Q.min()))})).next(()=>s.apply(t)).next(()=>n)}markPotentiallyOrphaned(t,e){return this.oi.set(e,t.currentSequenceNumber),P.resolve()}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.oi.set(n,t.currentSequenceNumber),P.resolve()}removeReference(t,e,n){return this.oi.set(n,t.currentSequenceNumber),P.resolve()}updateLimboDocument(t,e){return this.oi.set(e,t.currentSequenceNumber),P.resolve()}Jr(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=ae(t.data.value)),e}ar(t,e,n){return P.or([()=>this.persistence.ei(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const i=this.oi.get(e);return P.resolve(void 0!==i&&i>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class ku{constructor(t,e,n,i){this.targetId=t,this.fromCache=e,this.Hi=n,this.Ji=i}static Yi(t,e){let n=Z(),i=Z();for(const s of e.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new ku(t,e.fromCache,n,i)}}class mg{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class Nd{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=(0,et.nr)()?8:function vr(r){const t=r.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}((0,et.ZQ)())>0?6:4}initialize(t,e){this.ns=t,this.indexManager=e,this.Zi=!0}getDocumentsMatchingQuery(t,e,n,i){const s={result:null};return this.rs(t,e).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.ss(t,e,i,n).next(a=>{s.result=a})}).next(()=>{if(s.result)return;const a=new mg;return this._s(t,e,a).next(u=>{if(s.result=u,this.Xi)return this.us(t,e,a,u.size)})}).next(()=>s.result)}us(t,e,n,i){return n.documentReadCount<this.es?(Be()<=ce.$b.DEBUG&&M("QueryEngine","SDK will not create cache indexes for query:",Br(e),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),P.resolve()):(Be()<=ce.$b.DEBUG&&M("QueryEngine","Query:",Br(e),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.ts*i?(Be()<=ce.$b.DEBUG&&M("QueryEngine","The SDK decides to create cache indexes for query:",Br(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,jt(e))):P.resolve())}rs(t,e){if(lh(e))return P.resolve(null);let n=jt(e);return this.indexManager.getIndexType(t,n).next(i=>0===i?null:(null!==e.limit&&1===i&&(e=Po(e,null,"F"),n=jt(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next(s=>{const a=Z(...s);return this.ns.getDocuments(t,a).next(u=>this.indexManager.getMinOffset(t,n).next(c=>{const h=this.cs(e,u);return this.ls(e,h,a,c.readTime)?this.rs(t,Po(e,null,"F")):this.hs(t,h,e,c)}))})))}ss(t,e,n,i){return lh(e)||i.isEqual(Q.min())?P.resolve(null):this.ns.getDocuments(t,n).next(s=>{const a=this.cs(e,s);return this.ls(e,a,n,i)?P.resolve(null):(Be()<=ce.$b.DEBUG&&M("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Br(e)),this.hs(t,a,e,function yr(r,t){const e=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=Q.fromTimestamp(1e9===n?new pt(e+1,0):new pt(e,n));return new Lt(i,U.empty(),t)}(i,-1)).next(u=>u))})}cs(t,e){let n=new ct(mh(t));return e.forEach((i,s)=>{os(t,s)&&(n=n.add(s))}),n}ls(t,e,n,i){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const s="F"===t.limitType?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}_s(t,e,n){return Be()<=ce.$b.DEBUG&&M("QueryEngine","Using full collection scan to execute query:",Br(e)),this.ns.getDocumentsMatchingQuery(t,e,Lt.min(),n)}hs(t,e,n,i){return this.ns.getDocumentsMatchingQuery(t,n,i).next(s=>(e.forEach(a=>{s=s.insert(a.key,a)}),s))}}const Nu="LocalStore";class _g{constructor(t,e,n,i){this.persistence=t,this.Ps=e,this.serializer=i,this.Ts=new lt(H),this.Is=new Ze(s=>zn(s),is),this.Es=new Map,this.ds=t.getRemoteDocumentCache(),this.Hr=t.getTargetCache(),this.Yr=t.getBundleCache(),this.As(n)}As(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Cd(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Ts))}}function Od(r,t){return Mu.apply(this,arguments)}function Mu(){return(Mu=(0,k.A)(function*(r,t){const e=q(r);return yield e.persistence.runTransaction("Handle user change","readonly",n=>{let i;return e.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,e.As(t),e.mutationQueue.getAllMutationBatches(n))).next(s=>{const a=[],u=[];let c=Z();for(const h of i){a.push(h.batchId);for(const p of h.mutations)c=c.add(p.key)}for(const h of s){u.push(h.batchId);for(const p of h.mutations)c=c.add(p.key)}return e.localDocuments.getDocuments(n,c).next(h=>({Rs:h,removedBatchIds:a,addedBatchIds:u}))})})})).apply(this,arguments)}function Fd(r){const t=q(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Hr.getLastRemoteSnapshotVersion(e))}function Ig(r,t){const e=q(r);return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}function Zr(r,t,e){return Ou.apply(this,arguments)}function Ou(){return(Ou=(0,k.A)(function*(r,t,e){const n=q(r),i=n.Ts.get(t),s=e?"readwrite":"readwrite-primary";try{e||(yield n.persistence.runTransaction("Release target",s,a=>n.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!be(a))throw a;M(Nu,`Failed to update sequence numbers for target ${t}: ${a}`)}n.Ts=n.Ts.remove(t),n.Is.delete(i.target)})).apply(this,arguments)}function Ko(r,t,e){const n=q(r);let i=Q.min(),s=Z();return n.persistence.runTransaction("Execute query","readwrite",a=>function(c,h,p){const g=q(c),T=g.Is.get(p);return void 0!==T?P.resolve(g.Ts.get(T)):g.Hr.getTargetData(h,p)}(n,a,jt(t)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,n.Hr.getMatchingKeysForTargetId(a,u.targetId).next(c=>{s=c})}).next(()=>n.Ps.getDocumentsMatchingQuery(a,t,e?i:Q.min(),e?s:Z())).next(u=>(function Ud(r,t,e){let n=r.Es.get(t)||Q.min();e.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.Es.set(t,n)}(n,function ph(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}(t),u),{documents:u,gs:s})))}class Uu{constructor(){this.activeTargetIds=function au(){return Im}()}Ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}vs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}bs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Qd{constructor(){this.ho=new Uu,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.ho.Ds(t),this.Po[t]||"not-current"}updateQueryState(t,e,n){this.Po[t]=e}removeLocalQueryTarget(t){this.ho.vs(t)}isLocalQueryTarget(t){return this.ho.activeTargetIds.has(t)}clearQueryState(t){delete this.Po[t]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(t){return this.ho.activeTargetIds.has(t)}start(){return this.ho=new Uu,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class Ag{To(t){}shutdown(){}}const Wd="ConnectivityMonitor";class Hd{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(t){this.Vo.push(t)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){M(Wd,"Network connectivity changed: AVAILABLE");for(const t of this.Vo)t(0)}Ro(){M(Wd,"Network connectivity changed: UNAVAILABLE");for(const t of this.Vo)t(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Qo=null;function ju(){return null===Qo?Qo=268435456+Math.round(2147483648*Math.random()):Qo++,"0x"+Qo.toString(16)}const Ku="RestConnection",wg={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Rg{get fo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.po=e+"://"+t.host,this.yo=`projects/${n}/databases/${i}`,this.wo=this.databaseId.database===Je?`project_id=${n}`:`project_id=${n}&database_id=${i}`}So(t,e,n,i,s){const a=ju(),u=this.bo(t,e.toUriEncodedString());M(Ku,`Sending RPC '${t}' ${a}:`,u,n);const c={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(c,i,s),this.vo(t,u,c,n).then(h=>(M(Ku,`Received RPC '${t}' ${a}: `,h),h),h=>{throw ee(Ku,`RPC '${t}' ${a} failed with error: `,h,"url: ",u,"request:",n),h})}Co(t,e,n,i,s,a){return this.So(t,e,n,i,s)}Do(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+Ae,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((i,s)=>t[s]=i),n&&n.headers.forEach((i,s)=>t[s]=i)}bo(t,e){return`${this.po}/v1/${e}:${wg[t]}`}terminate(){}}class Pg{constructor(t){this.Fo=t.Fo,this.Mo=t.Mo}xo(t){this.Oo=t}No(t){this.Bo=t}Lo(t){this.ko=t}onMessage(t){this.qo=t}close(){this.Mo()}send(t){this.Fo(t)}Qo(){this.Oo()}$o(){this.Bo()}Uo(t){this.ko(t)}Ko(t){this.qo(t)}}const zt="WebChannelConnection";class bg extends Rg{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}vo(t,e,n,i){const s=ju();return new Promise((a,u)=>{const c=new Ei;c.setWithCredentials(!0),c.listenOnce(Zs.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case hr.NO_ERROR:const p=c.getResponseJson();M(zt,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(p)),a(p);break;case hr.TIMEOUT:M(zt,`RPC '${t}' ${s} timed out`),u(new O(x.DEADLINE_EXCEEDED,"Request time out"));break;case hr.HTTP_ERROR:const g=c.getStatus();if(M(zt,`RPC '${t}' ${s} failed with status:`,g,"response text:",c.getResponseText()),g>0){let T=c.getResponseJson();Array.isArray(T)&&(T=T[0]);const S=null==T?void 0:T.error;if(S&&S.status&&S.message){const N=function(F){const $=F.toLowerCase().replace(/_/g,"-");return Object.values(x).indexOf($)>=0?$:x.UNKNOWN}(S.status);u(new O(N,S.message))}else u(new O(x.UNKNOWN,"Server responded with status "+c.getStatus()))}else u(new O(x.UNAVAILABLE,"Connection failed."));break;default:j()}}finally{M(zt,`RPC '${t}' ${s} completed.`)}});const h=JSON.stringify(i);M(zt,`RPC '${t}' ${s} sending request:`,i),c.send(e,"POST",h,n,15)})}Wo(t,e,n){const i=ju(),s=[this.po,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=Ai(),u=he(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;void 0!==h&&(c.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Do(c.initMessageHeaders,e,n),c.encodeInitMessageHeaders=!0;const p=s.join("");M(zt,`Creating RPC '${t}' stream ${i}: ${p}`,c);const g=a.createWebChannel(p,c);let T=!1,S=!1;const N=new Pg({Fo:F=>{S?M(zt,`Not sending because RPC '${t}' stream ${i} is closed:`,F):(T||(M(zt,`Opening RPC '${t}' stream ${i} transport.`),g.open(),T=!0),M(zt,`RPC '${t}' stream ${i} sending:`,F),g.send(F))},Mo:()=>g.close()}),L=(F,$,Y)=>{F.listen($,W=>{try{Y(W)}catch(J){setTimeout(()=>{throw J},0)}})};return L(g,Mn.EventType.OPEN,()=>{S||(M(zt,`RPC '${t}' stream ${i} transport opened.`),N.Qo())}),L(g,Mn.EventType.CLOSE,()=>{S||(S=!0,M(zt,`RPC '${t}' stream ${i} transport closed`),N.Uo())}),L(g,Mn.EventType.ERROR,F=>{S||(S=!0,ee(zt,`RPC '${t}' stream ${i} transport errored:`,F),N.Uo(new O(x.UNAVAILABLE,"The operation could not be completed")))}),L(g,Mn.EventType.MESSAGE,F=>{var $;if(!S){const Y=F.data[0];z(!!Y);const J=(null==Y?void 0:Y.error)||(null===($=Y[0])||void 0===$?void 0:$.error);if(J){M(zt,`RPC '${t}' stream ${i} received error:`,J);const at=J.status;let tt=function(E){const A=Mt[E];if(void 0!==A)return kh(A)}(at),v=J.message;void 0===tt&&(tt=x.INTERNAL,v="Unknown error status: "+at+" with message "+J.message),S=!0,N.Uo(new O(tt,v)),g.close()}else M(zt,`RPC '${t}' stream ${i} received:`,Y),N.Ko(Y)}}),L(u,to.STAT_EVENT,F=>{F.stat===vi.PROXY?M(zt,`RPC '${t}' stream ${i} detected buffering proxy`):F.stat===vi.NOPROXY&&M(zt,`RPC '${t}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{N.$o()},0),N}}function Wo(){return typeof document<"u"?document:null}function As(r){return new km(r,!0)}class zu{constructor(t,e,n=1e3,i=1.5,s=6e4){this.Ti=t,this.timerId=e,this.Go=n,this.zo=i,this.jo=s,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(t){this.cancel();const e=Math.floor(this.Ho+this.e_()),n=Math.max(0,Date.now()-this.Yo),i=Math.max(0,e-n);i>0&&M("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ho} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,i,()=>(this.Yo=Date.now(),t())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){null!==this.Jo&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){null!==this.Jo&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}const Jd="PersistentStream";class Xd{constructor(t,e,n,i,s,a,u,c){this.Ti=t,this.n_=n,this.r_=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new zu(t,e)}u_(){return 1===this.state||5===this.state||this.c_()}c_(){return 2===this.state||3===this.state}start(){this.__=0,4!==this.state?this.auth():this.l_()}stop(){var t=this;return(0,k.A)(function*(){t.u_()&&(yield t.close(0))})()}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&null===this.s_&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(t){this.E_(),this.stream.send(t)}T_(){var t=this;return(0,k.A)(function*(){if(t.c_())return t.close(0)})()}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}close(t,e){var n=this;return(0,k.A)(function*(){n.E_(),n.d_(),n.a_.cancel(),n.i_++,4!==t?n.a_.reset():e&&e.code===x.RESOURCE_EXHAUSTED?(At(e.toString()),At("Using maximum backoff delay to prevent overloading the backend."),n.a_.Zo()):e&&e.code===x.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.A_(),n.stream.close(),n.stream=null),n.state=t,yield n.listener.Lo(e)})()}A_(){}auth(){this.state=1;const t=this.R_(this.i_),e=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.i_===e&&this.V_(n,i)},n=>{t(()=>{const i=new O(x.UNKNOWN,"Fetching auth token failed: "+n.message);return this.m_(i)})})}V_(t,e){const n=this.R_(this.i_);this.stream=this.f_(t,e),this.stream.xo(()=>{n(()=>this.listener.xo())}),this.stream.No(()=>{n(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(i=>{n(()=>this.m_(i))}),this.stream.onMessage(i=>{n(()=>1==++this.__?this.g_(i):this.onNext(i))})}l_(){var t=this;this.state=5,this.a_.Xo((0,k.A)(function*(){t.state=0,t.start()}))}m_(t){return M(Jd,`close with error: ${t}`),this.stream=null,this.close(4,t)}R_(t){return e=>{this.Ti.enqueueAndForget(()=>this.i_===t?e():(M(Jd,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Sg extends Xd{constructor(t,e,n,i,s,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,i,a),this.serializer=s}f_(t,e){return this.connection.Wo("Listen",t,e)}g_(t){return this.onNext(t)}onNext(t){this.a_.reset();const e=function Om(r,t){let e;if("targetChange"in t){const n="NO_CHANGE"===(h=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===h?1:"REMOVE"===h?2:"CURRENT"===h?3:"RESET"===h?4:j(),i=t.targetChange.targetIds||[],s=function(h,p){return h.useProto3Json?(z(void 0===p||"string"==typeof p),It.fromBase64String(p||"")):(z(void 0===p||p instanceof Buffer||p instanceof Uint8Array),It.fromUint8Array(p||new Uint8Array))}(r,t.targetChange.resumeToken),a=t.targetChange.cause,u=a&&function(h){const p=void 0===h.code?x.UNKNOWN:kh(h.code);return new O(p,h.message||"")}(a);e=new Fh(n,i,s,u||null)}else if("documentChange"in t){const n=t.documentChange,i=Fe(r,n.document.name),s=Ct(n.document.updateTime),a=n.document.createTime?Ct(n.document.createTime):Q.min(),u=new Bt({mapValue:{fields:n.document.fields}}),c=yt.newFoundDocument(i,s,a,u);e=new Co(n.targetIds||[],n.removedTargetIds||[],c.key,c)}else if("documentDelete"in t){const n=t.documentDelete,i=Fe(r,n.document),s=n.readTime?Ct(n.readTime):Q.min(),a=yt.newNoDocument(i,s);e=new Co([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){const n=t.documentRemove,i=Fe(r,n.document);e=new Co([],n.removedTargetIds||[],i,null)}else{if(!("filter"in t))return j();{const n=t.filter,{count:i=0,unchangedNames:s}=n,a=new bm(i,s);e=new Oh(n.targetId,a)}}var h;return e}(this.serializer,t),n=function(s){if(!("targetChange"in s))return Q.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?Q.min():a.readTime?Ct(a.readTime):Q.min()}(t);return this.listener.p_(e,n)}y_(t){const e={};e.database=_u(this.serializer),e.addTarget=function(s,a){let u;const c=a.target;if(u=wo(c)?{documents:Qh(s,c)}:{query:ko(s,c).ht},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=Bh(s,a.resumeToken);const h=pu(s,a.expectedCount);null!==h&&(u.expectedCount=h)}else if(a.snapshotVersion.compareTo(Q.min())>0){u.readTime=zr(s,a.snapshotVersion.toTimestamp());const h=pu(s,a.expectedCount);null!==h&&(u.expectedCount=h)}return u}(this.serializer,t);const n=function Lm(r,t){const e=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return j()}}(t.purpose);return null==e?null:{"goog-listen-tags":e}}(0,t);n&&(e.labels=n),this.I_(e)}w_(t){const e={};e.database=_u(this.serializer),e.removeTarget=t,this.I_(e)}}class Vg extends Xd{constructor(t,e,n,i,s,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,i,a),this.serializer=s}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(t,e){return this.connection.Wo("Write",t,e)}g_(t){return z(!!t.streamToken),this.lastStreamToken=t.streamToken,z(!t.writeResults||0===t.writeResults.length),this.listener.D_()}onNext(t){z(!!t.streamToken),this.lastStreamToken=t.streamToken,this.a_.reset();const e=function Fm(r,t){return r&&r.length>0?(z(void 0!==t),r.map(e=>function(i,s){let a=Ct(i.updateTime?i.updateTime:s);return a.isEqual(Q.min())&&(a=Ct(s)),new wm(a,i.transformResults||[])}(e,t))):[]}(t.writeResults,t.commitTime),n=Ct(t.commitTime);return this.listener.v_(n,e)}C_(){const t={};t.database=_u(this.serializer),this.I_(t)}b_(t){const e={streamToken:this.lastStreamToken,writes:t.map(n=>function ms(r,t){let e;if(t instanceof jr)e={update:zh(r,t.key,t.value)};else if(t instanceof Kr)e={delete:ps(r,t.key)};else if(t instanceof tn)e={update:zh(r,t.key,t.data),updateMask:Gm(t.fieldMask)};else{if(!(t instanceof cu))return j();e={verify:ps(r,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(n=>function(s,a){const u=a.transform;if(u instanceof Ur)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof $n)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Qn)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Gr)return{fieldPath:a.field.canonicalString(),increment:u.Ie};throw j()}(0,n))),t.precondition.isNone||(e.currentDocument=void 0!==(s=t.precondition).updateTime?{updateTime:Nm(r,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:j()),e;var s}(this.serializer,n))};this.I_(e)}}class xg{}class Cg extends xg{constructor(t,e,n,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=i,this.F_=!1}M_(){if(this.F_)throw new O(x.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,e,n,i){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.So(t,gu(e,n),i,s,a)).catch(s=>{throw"FirebaseError"===s.name?(s.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new O(x.UNKNOWN,s.toString())})}Co(t,e,n,i,s){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Co(t,gu(e,n),i,a,u,s)).catch(a=>{throw"FirebaseError"===a.name?(a.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new O(x.UNKNOWN,a.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class Dg{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){0===this.x_&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(t){"Online"===this.state?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.L_("Offline")))}set(t){this.Q_(),this.x_=0,"Online"===t&&(this.N_=!1),this.L_(t)}L_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}k_(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(At(e),this.N_=!1):M("OnlineStateTracker",e)}Q_(){null!==this.O_&&(this.O_.cancel(),this.O_=null)}}const er="RemoteStore";class kg{constructor(t,e,n,i,s){var a=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=s,this.z_.To(u=>{n.enqueueAndForget((0,k.A)(function*(){var c;An(a)&&(M(er,"Restarting streams for network reachability change."),yield(c=(0,k.A)(function*(p){const g=q(p);g.W_.add(4),yield ti(g),g.j_.set("Unknown"),g.W_.delete(4),yield ws(g)}),function h(p){return c.apply(this,arguments)})(a))}))}),this.j_=new Dg(n,i)}}function ws(r){return $u.apply(this,arguments)}function $u(){return($u=(0,k.A)(function*(r){if(An(r))for(const t of r.G_)yield t(!0)})).apply(this,arguments)}function ti(r){return Qu.apply(this,arguments)}function Qu(){return(Qu=(0,k.A)(function*(r){for(const t of r.G_)yield t(!1)})).apply(this,arguments)}function Ho(r,t){const e=q(r);e.K_.has(t.targetId)||(e.K_.set(t.targetId,t),Yu(e)?Hu(e):ri(e).c_()&&Wu(e,t))}function ei(r,t){const e=q(r),n=ri(e);e.K_.delete(t),n.c_()&&Zd(e,t),0===e.K_.size&&(n.c_()?n.P_():An(e)&&e.j_.set("Unknown"))}function Wu(r,t){if(r.H_.Ne(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Q.min())>0){const e=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}ri(r).y_(t)}function Zd(r,t){r.H_.Ne(t),ri(r).w_(t)}function Hu(r){r.H_=new Vm({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),lt:t=>r.K_.get(t)||null,it:()=>r.datastore.serializer.databaseId}),ri(r).start(),r.j_.B_()}function Yu(r){return An(r)&&!ri(r).u_()&&r.K_.size>0}function An(r){return 0===q(r).W_.size}function tf(r){r.H_=void 0}function Ng(r){return Ju.apply(this,arguments)}function Ju(){return(Ju=(0,k.A)(function*(r){r.j_.set("Online")})).apply(this,arguments)}function Mg(r){return Xu.apply(this,arguments)}function Xu(){return(Xu=(0,k.A)(function*(r){r.K_.forEach((t,e)=>{Wu(r,t)})})).apply(this,arguments)}function Og(r,t){return Zu.apply(this,arguments)}function Zu(){return(Zu=(0,k.A)(function*(r,t){tf(r),Yu(r)?(r.j_.q_(t),Hu(r)):r.j_.set("Unknown")})).apply(this,arguments)}function Fg(r,t,e){return tc.apply(this,arguments)}function tc(){return tc=(0,k.A)(function*(r,t,e){if(r.j_.set("Online"),t instanceof Fh&&2===t.state&&t.cause)try{yield(n=(0,k.A)(function*(s,a){const u=a.cause;for(const c of a.targetIds)s.K_.has(c)&&(yield s.remoteSyncer.rejectListen(c,u),s.K_.delete(c),s.H_.removeTarget(c))}),function i(s,a){return n.apply(this,arguments)})(r,t)}catch(n){M(er,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),yield Yo(r,n)}else if(t instanceof Co?r.H_.We(t):t instanceof Oh?r.H_.Ze(t):r.H_.je(t),!e.isEqual(Q.min()))try{const n=yield Fd(r.localStore);e.compareTo(n)>=0&&(yield function(s,a){const u=s.H_.ot(a);return u.targetChanges.forEach((c,h)=>{if(c.resumeToken.approximateByteSize()>0){const p=s.K_.get(h);p&&s.K_.set(h,p.withResumeToken(c.resumeToken,a))}}),u.targetMismatches.forEach((c,h)=>{const p=s.K_.get(c);if(!p)return;s.K_.set(c,p.withResumeToken(It.EMPTY_BYTE_STRING,p.snapshotVersion)),Zd(s,c);const g=new en(p.target,c,h,p.sequenceNumber);Wu(s,g)}),s.remoteSyncer.applyRemoteEvent(u)}(r,e))}catch(n){M(er,"Failed to raise snapshot:",n),yield Yo(r,n)}var n}),tc.apply(this,arguments)}function Yo(r,t,e){return ec.apply(this,arguments)}function ec(){return(ec=(0,k.A)(function*(r,t,e){if(!be(t))throw t;r.W_.add(1),yield ti(r),r.j_.set("Offline"),e||(e=()=>Fd(r.localStore)),r.asyncQueue.enqueueRetryable((0,k.A)(function*(){M(er,"Retrying IndexedDB access"),yield e(),r.W_.delete(1),yield ws(r)}))})).apply(this,arguments)}function ef(r,t){return t().catch(e=>Yo(r,e,t))}function ni(r){return nc.apply(this,arguments)}function nc(){return(nc=(0,k.A)(function*(r){const t=q(r),e=wn(t);let n=t.U_.length>0?t.U_[t.U_.length-1].batchId:-1;for(;Lg(t);)try{const i=yield Ig(t.localStore,n);if(null===i){0===t.U_.length&&e.P_();break}n=i.batchId,qg(t,i)}catch(i){yield Yo(t,i)}nf(t)&&rf(t)})).apply(this,arguments)}function Lg(r){return An(r)&&r.U_.length<10}function qg(r,t){r.U_.push(t);const e=wn(r);e.c_()&&e.S_&&e.b_(t.mutations)}function nf(r){return An(r)&&!wn(r).u_()&&r.U_.length>0}function rf(r){wn(r).start()}function Bg(r){return rc.apply(this,arguments)}function rc(){return(rc=(0,k.A)(function*(r){wn(r).C_()})).apply(this,arguments)}function Ug(r){return ic.apply(this,arguments)}function ic(){return(ic=(0,k.A)(function*(r){const t=wn(r);for(const e of r.U_)t.b_(e.mutations)})).apply(this,arguments)}function Gg(r,t,e){return sc.apply(this,arguments)}function sc(){return(sc=(0,k.A)(function*(r,t,e){const n=r.U_.shift(),i=hu.from(n,t,e);yield ef(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield ni(r)})).apply(this,arguments)}function jg(r,t){return oc.apply(this,arguments)}function oc(){return oc=(0,k.A)(function*(r,t){var e;t&&wn(r).S_&&(yield(e=(0,k.A)(function*(i,s){if(function Dh(r){switch(r){case x.OK:return j();case x.CANCELLED:case x.UNKNOWN:case x.DEADLINE_EXCEEDED:case x.RESOURCE_EXHAUSTED:case x.INTERNAL:case x.UNAVAILABLE:case x.UNAUTHENTICATED:return!1;case x.INVALID_ARGUMENT:case x.NOT_FOUND:case x.ALREADY_EXISTS:case x.PERMISSION_DENIED:case x.FAILED_PRECONDITION:case x.ABORTED:case x.OUT_OF_RANGE:case x.UNIMPLEMENTED:case x.DATA_LOSS:return!0;default:return j()}}(u=s.code)&&u!==x.ABORTED){const a=i.U_.shift();wn(i).h_(),yield ef(i,()=>i.remoteSyncer.rejectFailedWrite(a.batchId,s)),yield ni(i)}var u}),function n(i,s){return e.apply(this,arguments)})(r,t)),nf(r)&&rf(r)}),oc.apply(this,arguments)}function sf(r,t){return ac.apply(this,arguments)}function ac(){return(ac=(0,k.A)(function*(r,t){const e=q(r);e.asyncQueue.verifyOperationInProgress(),M(er,"RemoteStore received new credentials");const n=An(e);e.W_.add(3),yield ti(e),n&&e.j_.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.W_.delete(3),yield ws(e)})).apply(this,arguments)}function cc(){return(cc=(0,k.A)(function*(r,t){const e=q(r);t?(e.W_.delete(2),yield ws(e)):t||(e.W_.add(2),yield ti(e),e.j_.set("Unknown"))})).apply(this,arguments)}function ri(r){return r.J_||(r.J_=function(e,n,i){const s=q(e);return s.M_(),new Sg(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{xo:Ng.bind(null,r),No:Mg.bind(null,r),Lo:Og.bind(null,r),p_:Fg.bind(null,r)}),r.G_.push(function(){var t=(0,k.A)(function*(e){e?(r.J_.h_(),Yu(r)?Hu(r):r.j_.set("Unknown")):(yield r.J_.stop(),tf(r))});return function(e){return t.apply(this,arguments)}}())),r.J_}function wn(r){return r.Y_||(r.Y_=function(e,n,i){const s=q(e);return s.M_(),new Vg(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{xo:()=>Promise.resolve(),No:Bg.bind(null,r),Lo:jg.bind(null,r),D_:Ug.bind(null,r),v_:Gg.bind(null,r)}),r.G_.push(function(){var t=(0,k.A)(function*(e){e?(r.Y_.h_(),yield ni(r)):(yield r.Y_.stop(),r.U_.length>0&&(M(er,`Stopping write stream with ${r.U_.length} pending writes`),r.U_=[]))});return function(e){return t.apply(this,arguments)}}())),r.Y_}class lc{constructor(t,e,n,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new Nt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,i,s){const a=Date.now()+n,u=new lc(t,e,a,i,s);return u.start(n),u}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new O(x.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ii(r,t){if(At("AsyncQueue",`${t}: ${r}`),be(r))return new O(x.UNAVAILABLE,`${t}: ${r}`);throw r}class si{static emptySet(t){return new si(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||U.comparator(e.key,n.key):(e,n)=>U.comparator(e.key,n.key),this.keyedMap=as(),this.sortedSet=new lt(this.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof si)||this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const i=e.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new si;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class of{constructor(){this.Z_=new lt(U.comparator)}track(t){const e=t.doc.key,n=this.Z_.get(e);n?0!==t.type&&3===n.type?this.Z_=this.Z_.insert(e,t):3===t.type&&1!==n.type?this.Z_=this.Z_.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Z_=this.Z_.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Z_=this.Z_.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Z_=this.Z_.remove(e):1===t.type&&2===n.type?this.Z_=this.Z_.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Z_=this.Z_.insert(e,{type:2,doc:t.doc}):j():this.Z_=this.Z_.insert(e,t)}X_(){const t=[];return this.Z_.inorderTraversal((e,n)=>{t.push(n)}),t}}class oi{constructor(t,e,n,i,s,a,u,c,h){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(t,e,n,i,s){const a=[];return e.forEach(u=>{a.push({type:0,doc:u})}),new oi(t,e,si.emptySet(e),a,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&ss(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i].type!==n[i].type||!e[i].doc.isEqual(n[i].doc))return!1;return!0}}class Kg{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(t=>t.ra())}}class zg{constructor(){this.queries=af(),this.onlineState="Unknown",this.ia=new Set}terminate(){!function(e,n){const i=q(e),s=i.queries;i.queries=af(),s.forEach((a,u)=>{for(const c of u.ta)c.onError(n)})}(this,new O(x.ABORTED,"Firestore shutting down"))}}function af(){return new Ze(r=>fh(r),ss)}function hc(r,t){return dc.apply(this,arguments)}function dc(){return(dc=(0,k.A)(function*(r,t){const e=q(r);let n=3;const i=t.query;let s=e.queries.get(i);s?!s.na()&&t.ra()&&(n=2):(s=new Kg,n=t.ra()?0:1);try{switch(n){case 0:s.ea=yield e.onListen(i,!0);break;case 1:s.ea=yield e.onListen(i,!1);break;case 2:yield e.onFirstRemoteStoreListen(i)}}catch(a){const u=ii(a,`Initialization of query '${Br(t.query)}' failed`);return void t.onError(u)}e.queries.set(i,s),s.ta.push(t),t.sa(e.onlineState),s.ea&&t.oa(s.ea)&&mc(e)})).apply(this,arguments)}function fc(r,t){return pc.apply(this,arguments)}function pc(){return(pc=(0,k.A)(function*(r,t){const e=q(r),n=t.query;let i=3;const s=e.queries.get(n);if(s){const a=s.ta.indexOf(t);a>=0&&(s.ta.splice(a,1),0===s.ta.length?i=t.ra()?0:1:!s.na()&&t.ra()&&(i=2))}switch(i){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}})).apply(this,arguments)}function $g(r,t){const e=q(r);let n=!1;for(const i of t){const a=e.queries.get(i.query);if(a){for(const u of a.ta)u.oa(i)&&(n=!0);a.ea=i}}n&&mc(e)}function Qg(r,t,e){const n=q(r),i=n.queries.get(t);if(i)for(const s of i.ta)s.onError(e);n.queries.delete(t)}function mc(r){r.ia.forEach(t=>{t.next()})}var gc,uf;(uf=gc||(gc={}))._a="default",uf.Cache="cache";class _c{constructor(t,e,n){this.query=t,this.aa=e,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=n||{}}oa(t){if(!this.options.includeMetadataChanges){const n=[];for(const i of t.docChanges)3!==i.type&&n.push(i);t=new oi(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.ua?this.la(t)&&(this.aa.next(t),e=!0):this.ha(t,this.onlineState)&&(this.Pa(t),e=!0),this.ca=t,e}onError(t){this.aa.error(t)}sa(t){this.onlineState=t;let e=!1;return this.ca&&!this.ua&&this.ha(this.ca,t)&&(this.Pa(this.ca),e=!0),e}ha(t,e){return!t.fromCache||!this.ra()||(!this.options.Ta||!("Offline"!==e))&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}la(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.ca&&this.ca.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges}Pa(t){t=oi.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.ua=!0,this.aa.next(t)}ra(){return this.options.source!==gc.Cache}}class hf{constructor(t){this.key=t}}class df{constructor(t){this.key=t}}class ff{constructor(t,e){this.query=t,this.fa=e,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=Z(),this.mutatedKeys=Z(),this.ya=mh(t),this.wa=new si(this.ya)}get Sa(){return this.fa}ba(t,e){const n=e?e.Da:new of,i=e?e.wa:this.wa;let s=e?e.mutatedKeys:this.mutatedKeys,a=i,u=!1;const c="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,h="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((p,g)=>{const T=i.get(p),S=os(this.query,g)?g:null,N=!!T&&this.mutatedKeys.has(T.key),L=!!S&&(S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations);let F=!1;T&&S?T.data.isEqual(S.data)?N!==L&&(n.track({type:3,doc:S}),F=!0):this.va(T,S)||(n.track({type:2,doc:S}),F=!0,(c&&this.ya(S,c)>0||h&&this.ya(S,h)<0)&&(u=!0)):!T&&S?(n.track({type:0,doc:S}),F=!0):T&&!S&&(n.track({type:1,doc:T}),F=!0,(c||h)&&(u=!0)),F&&(S?(a=a.add(S),s=L?s.add(p):s.delete(p)):(a=a.delete(p),s=s.delete(p)))}),null!==this.query.limit)for(;a.size>this.query.limit;){const p="F"===this.query.limitType?a.last():a.first();a=a.delete(p.key),s=s.delete(p.key),n.track({type:1,doc:p})}return{wa:a,Da:n,ls:u,mutatedKeys:s}}va(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,i){const s=this.wa;this.wa=t.wa,this.mutatedKeys=t.mutatedKeys;const a=t.Da.X_();a.sort((p,g)=>function(S,N){const L=F=>{switch(F){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return j()}};return L(S)-L(N)}(p.type,g.type)||this.ya(p.doc,g.doc)),this.Ca(n),i=null!=i&&i;const u=e&&!i?this.Fa():[],c=0===this.pa.size&&this.current&&!i?1:0,h=c!==this.ga;return this.ga=c,0!==a.length||h?{snapshot:new oi(this.query,t.wa,s,a,t.mutatedKeys,0===c,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),Ma:u}:{Ma:u}}sa(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({wa:this.wa,Da:new of,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(t){return!this.fa.has(t)&&!!this.wa.has(t)&&!this.wa.get(t).hasLocalMutations}Ca(t){t&&(t.addedDocuments.forEach(e=>this.fa=this.fa.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.fa=this.fa.delete(e)),this.current=t.current)}Fa(){if(!this.current)return[];const t=this.pa;this.pa=Z(),this.wa.forEach(n=>{this.xa(n.key)&&(this.pa=this.pa.add(n.key))});const e=[];return t.forEach(n=>{this.pa.has(n)||e.push(new df(n))}),this.pa.forEach(n=>{t.has(n)||e.push(new hf(n))}),e}Oa(t){this.fa=t.gs,this.pa=Z();const e=this.ba(t.documents);return this.applyChanges(e,!0)}Na(){return oi.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,0===this.ga,this.hasCachedResults)}}const Rn="SyncEngine";class Yg{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Jg{constructor(t){this.key=t,this.Ba=!1}}class Xg{constructor(t,e,n,i,s,a){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.La={},this.ka=new Ze(u=>fh(u),ss),this.qa=new Map,this.Qa=new Set,this.$a=new lt(U.comparator),this.Ua=new Map,this.Ka=new Pu,this.Wa={},this.Ga=new Map,this.za=Zn.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return!0===this.ja}}function Zg(r,t){return yc.apply(this,arguments)}function yc(){return(yc=(0,k.A)(function*(r,t,e=!0){const n=Jo(r);let i;const s=n.ka.get(t);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Na()):i=yield pf(n,t,e,!0),i})).apply(this,arguments)}function t_(r,t){return Tc.apply(this,arguments)}function Tc(){return(Tc=(0,k.A)(function*(r,t){const e=Jo(r);yield pf(e,t,!0,!1)})).apply(this,arguments)}function pf(r,t,e,n){return Ic.apply(this,arguments)}function Ic(){return(Ic=(0,k.A)(function*(r,t,e,n){const i=yield function Xr(r,t){const e=q(r);return e.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return e.Hr.getTargetData(n,t).next(s=>s?(i=s,P.resolve(i)):e.Hr.allocateTargetId(n).next(a=>(i=new en(t,a,"TargetPurposeListen",n.currentSequenceNumber),e.Hr.addTargetData(n,i).next(()=>i))))}).then(n=>{const i=e.Ts.get(n.targetId);return(null===i||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(e.Ts=e.Ts.insert(n.targetId,n),e.Is.set(t,n.targetId)),n})}(r.localStore,jt(t)),s=i.targetId,a=r.sharedClientState.addLocalQueryTarget(s,e);let u;return n&&(u=yield function Ec(r,t,e,n,i){return vc.apply(this,arguments)}(r,t,s,"current"===a,i.resumeToken)),r.isPrimaryClient&&e&&Ho(r.remoteStore,i),u})).apply(this,arguments)}function vc(){return vc=(0,k.A)(function*(r,t,e,n,i){r.Ha=(g,T,S)=>{return(N=(0,k.A)(function*(F,$,Y,W){let J=$.view.ba(Y);J.ls&&(J=yield Ko(F.localStore,$.query,!1).then(({documents:y})=>$.view.ba(y,J)));const at=W&&W.targetChanges.get($.targetId),tt=W&&null!=W.targetMismatches.get($.targetId),v=$.view.applyChanges(J,F.isPrimaryClient,at,tt);return kc(F,$.targetId,v.Ma),v.snapshot}),function L(F,$,Y,W){return N.apply(this,arguments)})(r,g,T,S);var N};const s=yield Ko(r.localStore,t,!0),a=new ff(t,s.gs),u=a.ba(s.documents),c=fs.createSynthesizedTargetChangeForCurrentChange(e,n&&"Offline"!==r.onlineState,i),h=a.applyChanges(u,r.isPrimaryClient,c);kc(r,e,h.Ma);const p=new Yg(t,e,a);return r.ka.set(t,p),r.qa.has(e)?r.qa.get(e).push(t):r.qa.set(e,[t]),h.snapshot}),vc.apply(this,arguments)}function e_(r,t,e){return Ac.apply(this,arguments)}function Ac(){return(Ac=(0,k.A)(function*(r,t,e){const n=q(r),i=n.ka.get(t),s=n.qa.get(i.targetId);if(s.length>1)return n.qa.set(i.targetId,s.filter(a=>!ss(a,t))),void n.ka.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Zr(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),e&&ei(n.remoteStore,i.targetId),ai(n,i.targetId)}).catch(ye))):(ai(n,i.targetId),yield Zr(n.localStore,i.targetId,!0))})).apply(this,arguments)}function n_(r,t){return wc.apply(this,arguments)}function wc(){return(wc=(0,k.A)(function*(r,t){const e=q(r),n=e.ka.get(t),i=e.qa.get(n.targetId);e.isPrimaryClient&&1===i.length&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),ei(e.remoteStore,n.targetId))})).apply(this,arguments)}function Rc(){return(Rc=(0,k.A)(function*(r,t,e){const n=function Kc(r){const t=q(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=s_.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=o_.bind(null,t),t}(r);try{const i=yield function(a,u){const c=q(a),h=pt.now(),p=u.reduce((S,N)=>S.add(N.key),Z());let g,T;return c.persistence.runTransaction("Locally write mutations","readwrite",S=>{let N=ie(),L=Z();return c.ds.getEntries(S,p).next(F=>{N=F,N.forEach(($,Y)=>{Y.isValidDocument()||(L=L.add($))})}).next(()=>c.localDocuments.getOverlayedDocuments(S,N)).next(F=>{g=F;const $=[];for(const Y of u){const W=Pm(Y,g.get(Y.key).overlayedDocument);null!=W&&$.push(new tn(Y.key,W,Jl(W.value.mapValue),vt.exists(!0)))}return c.mutationQueue.addMutationBatch(S,h,$,u)}).next(F=>{T=F;const $=F.applyToLocalDocumentSet(g,L);return c.documentOverlayCache.saveOverlays(S,F.batchId,$)})}).then(()=>({batchId:T.batchId,changes:_h(g)}))}(n.localStore,t);n.sharedClientState.addPendingMutation(i.batchId),function(a,u,c){let h=a.Wa[a.currentUser.toKey()];h||(h=new lt(H)),h=h.insert(u,c),a.Wa[a.currentUser.toKey()]=h}(n,i.batchId,e),yield nn(n,i.changes),yield ni(n.remoteStore)}catch(i){const s=ii(i,"Failed to persist write");e.reject(s)}})).apply(this,arguments)}function mf(r,t){return Pc.apply(this,arguments)}function Pc(){return(Pc=(0,k.A)(function*(r,t){const e=q(r);try{const n=yield function Tg(r,t){const e=q(r),n=t.snapshotVersion;let i=e.Ts;return e.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=e.ds.newChangeBuffer({trackRemovals:!0});i=e.Ts;const u=[];t.targetChanges.forEach((p,g)=>{const T=i.get(g);if(!T)return;u.push(e.Hr.removeMatchingKeys(s,p.removedDocuments,g).next(()=>e.Hr.addMatchingKeys(s,p.addedDocuments,g)));let S=T.withSequenceNumber(s.currentSequenceNumber);var L,F,$;null!==t.targetMismatches.get(g)?S=S.withResumeToken(It.EMPTY_BYTE_STRING,Q.min()).withLastLimboFreeSnapshotVersion(Q.min()):p.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(p.resumeToken,n)),i=i.insert(g,S),F=S,$=p,(0===(L=T).resumeToken.approximateByteSize()||F.snapshotVersion.toMicroseconds()-L.snapshotVersion.toMicroseconds()>=3e8||$.addedDocuments.size+$.modifiedDocuments.size+$.removedDocuments.size>0)&&u.push(e.Hr.updateTargetData(s,S))});let c=ie(),h=Z();if(t.documentUpdates.forEach(p=>{t.resolvedLimboDocuments.has(p)&&u.push(e.persistence.referenceDelegate.updateLimboDocument(s,p))}),u.push(function Ld(r,t,e){let n=Z(),i=Z();return e.forEach(s=>n=n.add(s)),t.getEntries(r,n).next(s=>{let a=ie();return e.forEach((u,c)=>{const h=s.get(u);c.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(u)),c.isNoDocument()&&c.version.isEqual(Q.min())?(t.removeEntry(u,c.readTime),a=a.insert(u,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||0===c.version.compareTo(h.version)&&h.hasPendingWrites?(t.addEntry(c),a=a.insert(u,c)):M(Nu,"Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version)}),{Vs:a,fs:i}})}(s,a,t.documentUpdates).next(p=>{c=p.Vs,h=p.fs})),!n.isEqual(Q.min())){const p=e.Hr.getLastRemoteSnapshotVersion(s).next(g=>e.Hr.setTargetsMetadata(s,s.currentSequenceNumber,n));u.push(p)}return P.waitFor(u).next(()=>a.apply(s)).next(()=>e.localDocuments.getLocalViewOfDocuments(s,c,h)).next(()=>c)}).then(s=>(e.Ts=i,s))}(e.localStore,t);t.targetChanges.forEach((i,s)=>{const a=e.Ua.get(s);a&&(z(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.Ba=!0:i.modifiedDocuments.size>0?z(a.Ba):i.removedDocuments.size>0&&(z(a.Ba),a.Ba=!1))}),yield nn(e,n,t)}catch(n){yield ye(n)}})).apply(this,arguments)}function gf(r,t,e){const n=q(r);if(n.isPrimaryClient&&0===e||!n.isPrimaryClient&&1===e){const i=[];n.ka.forEach((s,a)=>{const u=a.view.sa(t);u.snapshot&&i.push(u.snapshot)}),function(a,u){const c=q(a);c.onlineState=u;let h=!1;c.queries.forEach((p,g)=>{for(const T of g.ta)T.sa(u)&&(h=!0)}),h&&mc(c)}(n.eventManager,t),i.length&&n.La.p_(i),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}function i_(r,t,e){return bc.apply(this,arguments)}function bc(){return(bc=(0,k.A)(function*(r,t,e){const n=q(r);n.sharedClientState.updateQueryState(t,"rejected",e);const i=n.Ua.get(t),s=i&&i.key;if(s){let a=new lt(U.comparator);a=a.insert(s,yt.newNoDocument(s,Q.min()));const u=Z().add(s),c=new ds(Q.min(),new Map,new lt(H),a,u);yield mf(n,c),n.$a=n.$a.remove(s),n.Ua.delete(t),Nc(n)}else yield Zr(n.localStore,t,!1).then(()=>ai(n,t,e)).catch(ye)})).apply(this,arguments)}function s_(r,t){return Sc.apply(this,arguments)}function Sc(){return(Sc=(0,k.A)(function*(r,t){const e=q(r),n=t.batch.batchId;try{const i=yield function yg(r,t){const e=q(r);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const i=t.batch.keys(),s=e.ds.newChangeBuffer({trackRemovals:!0});return function(u,c,h,p){const g=h.batch,T=g.keys();let S=P.resolve();return T.forEach(N=>{S=S.next(()=>p.getEntry(c,N)).next(L=>{const F=h.docVersions.get(N);z(null!==F),L.version.compareTo(F)<0&&(g.applyToRemoteDocument(L,h),L.isValidDocument()&&(L.setReadTime(h.commitVersion),p.addEntry(L)))})}),S.next(()=>u.mutationQueue.removeMutationBatch(c,g))}(e,n,t,s).next(()=>s.apply(n)).next(()=>e.mutationQueue.performConsistencyCheck(n)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(n,i,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let c=Z();for(let h=0;h<u.mutationResults.length;++h)u.mutationResults[h].transformResults.length>0&&(c=c.add(u.batch.mutations[h].key));return c}(t))).next(()=>e.localDocuments.getDocuments(n,i))})}(e.localStore,t);Dc(e,n,null),Cc(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),yield nn(e,i)}catch(i){yield ye(i)}})).apply(this,arguments)}function o_(r,t,e){return Vc.apply(this,arguments)}function Vc(){return(Vc=(0,k.A)(function*(r,t,e){const n=q(r);try{const i=yield function(a,u){const c=q(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let p;return c.mutationQueue.lookupMutationBatch(h,u).next(g=>(z(null!==g),p=g.keys(),c.mutationQueue.removeMutationBatch(h,g))).next(()=>c.mutationQueue.performConsistencyCheck(h)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(h,p,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,p)).next(()=>c.localDocuments.getDocuments(h,p))})}(n.localStore,t);Dc(n,t,e),Cc(n,t),n.sharedClientState.updateMutationState(t,"rejected",e),yield nn(n,i)}catch(i){yield ye(i)}})).apply(this,arguments)}function Cc(r,t){(r.Ga.get(t)||[]).forEach(e=>{e.resolve()}),r.Ga.delete(t)}function Dc(r,t,e){const n=q(r);let i=n.Wa[n.currentUser.toKey()];if(i){const s=i.get(t);s&&(e?s.reject(e):s.resolve(),i=i.remove(t)),n.Wa[n.currentUser.toKey()]=i}}function ai(r,t,e=null){r.sharedClientState.removeLocalQueryTarget(t);for(const n of r.qa.get(t))r.ka.delete(n),e&&r.La.Ja(n,e);r.qa.delete(t),r.isPrimaryClient&&r.Ka.br(t).forEach(n=>{r.Ka.containsKey(n)||_f(r,n)})}function _f(r,t){r.Qa.delete(t.path.canonicalString());const e=r.$a.get(t);null!==e&&(ei(r.remoteStore,e),r.$a=r.$a.remove(t),r.Ua.delete(e),Nc(r))}function kc(r,t,e){for(const n of e)n instanceof hf?(r.Ka.addReference(n.key,t),u_(r,n)):n instanceof df?(M(Rn,"Document no longer in limbo: "+n.key),r.Ka.removeReference(n.key,t),r.Ka.containsKey(n.key)||_f(r,n.key)):j()}function u_(r,t){const e=t.key,n=e.path.canonicalString();r.$a.get(e)||r.Qa.has(n)||(M(Rn,"New document in limbo: "+e),r.Qa.add(n),Nc(r))}function Nc(r){for(;r.Qa.size>0&&r.$a.size<r.maxConcurrentLimboResolutions;){const t=r.Qa.values().next().value;r.Qa.delete(t);const e=new U(nt.fromString(t)),n=r.za.next();r.Ua.set(n,new Jg(e)),r.$a=r.$a.insert(e,n),Ho(r.remoteStore,new en(jt(Lr(e.path)),n,"TargetPurposeLimboResolution",ne.ae))}}function nn(r,t,e){return Mc.apply(this,arguments)}function Mc(){return Mc=(0,k.A)(function*(r,t,e){const n=q(r),i=[],s=[],a=[];var u;n.ka.isEmpty()||(n.ka.forEach((u,c)=>{a.push(n.Ha(c,t,e).then(h=>{var p;if((h||e)&&n.isPrimaryClient){const g=h?!h.fromCache:null===(p=null==e?void 0:e.targetChanges.get(c.targetId))||void 0===p?void 0:p.current;n.sharedClientState.updateQueryState(c.targetId,g?"current":"not-current")}if(h){i.push(h);const g=ku.Yi(c.targetId,h);s.push(g)}}))}),yield Promise.all(a),n.La.p_(i),yield(u=(0,k.A)(function*(h,p){const g=q(h);try{yield g.persistence.runTransaction("notifyLocalViewChanges","readwrite",T=>P.forEach(p,S=>P.forEach(S.Hi,N=>g.persistence.referenceDelegate.addReference(T,S.targetId,N)).next(()=>P.forEach(S.Ji,N=>g.persistence.referenceDelegate.removeReference(T,S.targetId,N)))))}catch(T){if(!be(T))throw T;M(Nu,"Failed to update sequence numbers: "+T)}for(const T of p){const S=T.targetId;if(!T.fromCache){const N=g.Ts.get(S),F=N.withLastLimboFreeSnapshotVersion(N.snapshotVersion);g.Ts=g.Ts.insert(S,F)}}}),function c(h,p){return u.apply(this,arguments)})(n.localStore,s))}),Mc.apply(this,arguments)}function c_(r,t){return Oc.apply(this,arguments)}function Oc(){return(Oc=(0,k.A)(function*(r,t){const e=q(r);if(!e.currentUser.isEqual(t)){M(Rn,"User change. New user:",t.toKey());const n=yield Od(e.localStore,t);e.currentUser=t,(s=e).Ga.forEach(u=>{u.forEach(c=>{c.reject(new O(x.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.Ga.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),yield nn(e,n.Rs)}var s})).apply(this,arguments)}function l_(r,t){const e=q(r),n=e.Ua.get(t);if(n&&n.Ba)return Z().add(n.key);{let i=Z();const s=e.qa.get(t);if(!s)return i;for(const a of s){const u=e.ka.get(a);i=i.unionWith(u.view.Sa)}return i}}function Jo(r){const t=q(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=mf.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=l_.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=i_.bind(null,t),t.La.p_=$g.bind(null,t.eventManager),t.La.Ja=Qg.bind(null,t.eventManager),t}let Xo=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){var n=this;return(0,k.A)(function*(){n.serializer=As(e.databaseInfo.databaseId),n.sharedClientState=n.Za(e),n.persistence=n.Xa(e),yield n.persistence.start(),n.localStore=n.eu(e),n.gcScheduler=n.tu(e,n.localStore),n.indexBackfillerScheduler=n.nu(e,n.localStore)})()}tu(e,n){return null}nu(e,n){return null}eu(e){return function Md(r,t,e,n){return new _g(r,t,e,n)}(this.persistence,new Nd,e.initialUser,this.serializer)}Xa(e){return new bu(Uo.ri,this.serializer)}Za(e){return new Qd}terminate(){var e=this;return(0,k.A)(function*(){var n,i;null===(n=e.gcScheduler)||void 0===n||n.stop(),null===(i=e.indexBackfillerScheduler)||void 0===i||i.stop(),e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}return r.provider={build:()=>new r},r})();class zc extends Xo{constructor(t){super(),this.cacheSizeBytes=t}tu(t,e){return z(this.persistence.referenceDelegate instanceof Go),new wd(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue,e)}Xa(t){const e=void 0!==this.cacheSizeBytes?Kt.withCacheSize(this.cacheSizeBytes):Kt.DEFAULT;return new bu(n=>Go.ri(n,e),this.serializer)}}let ui=(()=>{class r{initialize(e,n){var i=this;return(0,k.A)(function*(){i.localStore||(i.localStore=e.localStore,i.sharedClientState=e.sharedClientState,i.datastore=i.createDatastore(n),i.remoteStore=i.createRemoteStore(n),i.eventManager=i.createEventManager(n),i.syncEngine=i.createSyncEngine(n,!e.synchronizeTabs),i.sharedClientState.onlineStateHandler=s=>gf(i.syncEngine,s,1),i.remoteStore.remoteSyncer.handleCredentialChange=c_.bind(null,i.syncEngine),yield function uc(r,t){return cc.apply(this,arguments)}(i.remoteStore,i.syncEngine.isPrimaryClient))})()}createEventManager(e){return new zg}createDatastore(e){const n=As(e.databaseInfo.databaseId),i=new bg(e.databaseInfo);return new Cg(e.authCredentials,e.appCheckCredentials,i,n)}createRemoteStore(e){return i=this.localStore,s=this.datastore,a=e.asyncQueue,u=n=>gf(this.syncEngine,n,0),c=Hd.D()?new Hd:new Ag,new kg(i,s,a,u,c);var i,s,a,u,c}createSyncEngine(e,n){return function(s,a,u,c,h,p,g){const T=new Xg(s,a,u,c,h,p);return g&&(T.ja=!0),T}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){var e=this;return(0,k.A)(function*(){var n,i,s;yield(s=(0,k.A)(function*(u){const c=q(u);M(er,"RemoteStore shutting down."),c.W_.add(5),yield ti(c),c.z_.shutdown(),c.j_.set("Unknown")}),function a(u){return s.apply(this,arguments)})(e.remoteStore),null===(n=e.datastore)||void 0===n||n.terminate(),null===(i=e.eventManager)||void 0===i||i.terminate()})()}}return r.provider={build:()=>new r},r})();class Zo{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.iu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.iu(this.observer.error,t):At("Uncaught Error in snapshot listener:",t.toString()))}su(){this.muted=!0}iu(t,e){setTimeout(()=>{this.muted||t(e)},0)}}const Pn="FirestoreClient";class v_{constructor(t,e,n,i,s){var a=this;this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=i,this.user=Pt.UNAUTHENTICATED,this.clientId=so.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,function(){var u=(0,k.A)(function*(c){M(Pn,"Received user=",c.uid),yield a.authCredentialListener(c),a.user=c});return function(c){return u.apply(this,arguments)}}()),this.appCheckCredentials.start(n,u=>(M(Pn,"Received new app check token=",u),this.appCheckCredentialListener(u,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){var t=this;this.asyncQueue.enterRestrictedMode();const e=new Nt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,k.A)(function*(){try{t._onlineComponents&&(yield t._onlineComponents.terminate()),t._offlineComponents&&(yield t._offlineComponents.terminate()),t.authCredentials.shutdown(),t.appCheckCredentials.shutdown(),e.resolve()}catch(n){const i=ii(n,"Failed to shutdown persistence");e.reject(i)}})),e.promise}}function Qc(r,t){return Wc.apply(this,arguments)}function Wc(){return Wc=(0,k.A)(function*(r,t){r.asyncQueue.verifyOperationInProgress(),M(Pn,"Initializing OfflineComponentProvider");const e=r.configuration;yield t.initialize(e);let n=e.initialUser;r.setCredentialChangeListener(function(){var i=(0,k.A)(function*(s){n.isEqual(s)||(yield Od(t.localStore,s),n=s)});return function(s){return i.apply(this,arguments)}}()),t.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=t}),Wc.apply(this,arguments)}function vf(r,t){return Hc.apply(this,arguments)}function Hc(){return(Hc=(0,k.A)(function*(r,t){r.asyncQueue.verifyOperationInProgress();const e=yield function Yc(r){return Jc.apply(this,arguments)}(r);M(Pn,"Initializing OnlineComponentProvider"),yield t.initialize(e,r.configuration),r.setCredentialChangeListener(n=>sf(t.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>sf(t.remoteStore,i)),r._onlineComponents=t})).apply(this,arguments)}function Jc(){return(Jc=(0,k.A)(function*(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){M(Pn,"Using user provided OfflineComponentProvider");try{yield Qc(r,r._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===(i=t).name?i.code===x.FAILED_PRECONDITION||i.code===x.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||22===i.code||20===i.code||11===i.code))throw t;ee("Error using user provided cache. Falling back to memory cache: "+t),yield Qc(r,new Xo)}}else M(Pn,"Using default OfflineComponentProvider"),yield Qc(r,new zc(void 0));var i;return r._offlineComponents})).apply(this,arguments)}function ta(r){return Xc.apply(this,arguments)}function Xc(){return(Xc=(0,k.A)(function*(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(M(Pn,"Using user provided OnlineComponentProvider"),yield vf(r,r._uninitializedComponentsProvider._online)):(M(Pn,"Using default OnlineComponentProvider"),yield vf(r,new ui))),r._onlineComponents})).apply(this,arguments)}function li(r){return tl.apply(this,arguments)}function tl(){return(tl=(0,k.A)(function*(r){const t=yield ta(r),e=t.eventManager;return e.onListen=Zg.bind(null,t.syncEngine),e.onUnlisten=e_.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=t_.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=n_.bind(null,t.syncEngine),e})).apply(this,arguments)}function Sf(r){const t={};return void 0!==r.timeoutSeconds&&(t.timeoutSeconds=r.timeoutSeconds),t}const Vf=new Map;function el(r,t,e){if(!e)throw new O(x.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function xf(r){if(!U.isDocumentKey(r))throw new O(x.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Cf(r){if(U.isDocumentKey(r))throw new O(x.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function ea(r){if(void 0===r)return"undefined";if(null===r)return"null";if("string"==typeof r)return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if("number"==typeof r||"boolean"==typeof r)return""+r;if("object"==typeof r){if(r instanceof Array)return"an array";{const t=(n=r).constructor?n.constructor.name:null;return t?`a custom ${t} object`:"an object"}}var n;return"function"==typeof r?"a function":j()}function rt(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new O(x.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=ea(r);throw new O(x.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return r}const kf="firestore.googleapis.com";class Mf{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new O(x.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=kf,this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new O(x.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function N_(r,t,e,n){if(!0===t&&!0===n)throw new O(x.INVALID_ARGUMENT,`${r} and ${e} cannot be used together.`)})("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==t.experimentalAutoDetectLongPolling&&!t.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=Sf(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new O(x.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new O(x.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new O(x.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===t.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Rs{constructor(t,e,n,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Mf({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new O(x.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new O(x.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Mf(t),this._emulatorOptions=t.emulatorOptions||{},void 0!==t.credentials&&(this._authCredentials=function(n){if(!n)return new un;switch(n.type){case"firstParty":return new ro(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new O(x.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){var t=this;return(0,k.A)(function*(){"notTerminated"===t._terminateTask?yield t._terminate():t._terminateTask="notTerminated"})()}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const n=Vf.get(e);n&&(M("ComponentProvider","Removing Datastore"),Vf.delete(e),n.terminate())}(this),Promise.resolve()}}class Ut{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Ut(this.firestore,t,this._query)}}class Dt{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new qe(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Dt(this.firestore,t,this._key)}}class qe extends Ut{constructor(t,e,n){super(t,e,Lr(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Dt(this.firestore,null,new U(t))}withConverter(t){return new qe(this.firestore,t,this._path)}}function O_(r,t,...e){if(r=(0,et.Ku)(r),el("collection","path",t),r instanceof Rs){const n=nt.fromString(t,...e);return Cf(n),new qe(r,null,n)}{if(!(r instanceof Dt||r instanceof qe))throw new O(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(nt.fromString(t,...e));return Cf(n),new qe(r.firestore,null,n)}}function Of(r,t,...e){if(r=(0,et.Ku)(r),1===arguments.length&&(t=so.newId()),el("doc","path",t),r instanceof Rs){const n=nt.fromString(t,...e);return xf(n),new Dt(r,null,new U(n))}{if(!(r instanceof Dt||r instanceof qe))throw new O(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(nt.fromString(t,...e));return xf(n),new Dt(r.firestore,r instanceof qe?r.converter:null,new U(n))}}const Lf="AsyncQueue";class qf{constructor(t=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new zu(this,"async_queue_retry"),this.Su=()=>{const n=Wo();n&&M(Lf,"Visibility state changed to "+n.visibilityState),this.a_.t_()},this.bu=t;const e=Wo();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Du(),this.vu(t)}enterRestrictedMode(t){if(!this.mu){this.mu=!0,this.yu=t||!1;const e=Wo();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Su)}}enqueue(t){if(this.Du(),this.mu)return new Promise(()=>{});const e=new Nt;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Vu.push(t),this.Cu()))}Cu(){var t=this;return(0,k.A)(function*(){if(0!==t.Vu.length){try{yield t.Vu[0](),t.Vu.shift(),t.a_.reset()}catch(e){if(!be(e))throw e;M(Lf,"Operation failed with retryable error: "+e)}t.Vu.length>0&&t.a_.Xo(()=>t.Cu())}})()}vu(t){const e=this.bu.then(()=>(this.pu=!0,t().catch(n=>{throw this.gu=n,this.pu=!1,At("INTERNAL UNHANDLED ERROR: ",function(a){let u=a.message||"";return a.stack&&(u=a.stack.includes(a.message)?a.stack:a.message+"\n"+a.stack),u}(n)),n}).then(n=>(this.pu=!1,n))));return this.bu=e,e}enqueueAfterDelay(t,e,n){this.Du(),this.wu.indexOf(t)>-1&&(e=0);const i=lc.createAndSchedule(this,t,e,n,s=>this.Fu(s));return this.fu.push(i),i}Du(){this.gu&&j()}verifyOperationInProgress(){}Mu(){var t=this;return(0,k.A)(function*(){let e;do{e=t.bu,yield e}while(e!==t.bu)})()}xu(t){for(const e of this.fu)if(e.timerId===t)return!0;return!1}Ou(t){return this.Mu().then(()=>{this.fu.sort((e,n)=>e.targetTimeMs-n.targetTimeMs);for(const e of this.fu)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Mu()})}Nu(t){this.wu.push(t)}Fu(t){const e=this.fu.indexOf(t);this.fu.splice(e,1)}}function nl(r){return function(e){if("object"!=typeof e||null===e)return!1;const i=e;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(r)}class mt extends Rs{constructor(t,e,n,i){super(t,e,n,i),this.type="firestore",this._queue=new qf,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){var t=this;return(0,k.A)(function*(){if(t._firestoreClient){const e=t._firestoreClient.terminate();t._queue=new qf(e),t._firestoreClient=void 0,yield e}})()}}function L_(r,t){const e="object"==typeof r?r:(0,te.Sx)(),n="string"==typeof r?r:t||Je,i=(0,te.j6)(e,"firestore").getImmediate({identifier:n});if(!i._initialized){const s=(0,et.yU)("firestore");s&&function M_(r,t,e,n={}){var i;const s=(r=rt(r,Rs))._getSettings(),a=Object.assign(Object.assign({},s),{emulatorOptions:r._getEmulatorOptions()}),u=`${t}:${e}`;s.host!==kf&&s.host!==u&&ee("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c=Object.assign(Object.assign({},s),{host:u,ssl:!1,emulatorOptions:n});if(!(0,et.bD)(c,a)&&(r._setSettings(c),n.mockUserToken)){let h,p;if("string"==typeof n.mockUserToken)h=n.mockUserToken,p=Pt.MOCK_USER;else{h=(0,et.Fy)(n.mockUserToken,null===(i=r._app)||void 0===i?void 0:i.options.projectId);const g=n.mockUserToken.sub||n.mockUserToken.user_id;if(!g)throw new O(x.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new Pt(g)}r._authCredentials=new no(new Ue(h,p))}}(i,...s)}return i}function Rt(r){if(r._terminated)throw new O(x.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||function Bf(r){var t,e,n;const i=r._freezeSettings(),s=(c=(null===(t=r._app)||void 0===t?void 0:t.options.appId)||"",new Xa(r._databaseId,c,r._persistenceKey,(p=i).host,p.ssl,p.experimentalForceLongPolling,p.experimentalAutoDetectLongPolling,Sf(p.experimentalLongPollingOptions),p.useFetchStreams));var c,p;r._componentsProvider||!(null===(e=i.localCache)||void 0===e)&&e._offlineComponentProvider&&!(null===(n=i.localCache)||void 0===n)&&n._onlineComponentProvider&&(r._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),r._firestoreClient=new v_(r._authCredentials,r._appCheckCredentials,r._queue,s,r._componentsProvider&&function(u){const c=null==u?void 0:u._online.build();return{_offline:null==u?void 0:u._offline.build(c),_online:c}}(r._componentsProvider))}(r),r._firestoreClient}class nr{constructor(t){this._byteString=t}static fromBase64String(t){try{return new nr(It.fromBase64String(t))}catch(e){throw new O(x.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new nr(It.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class rr{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new O(x.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new dt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class hi{constructor(t){this._methodName=t}}class il{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new O(x.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new O(x.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return H(this._lat,t._lat)||H(this._long,t._long)}}class na{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}(this._values,t._values)}}const B_=/^__.*__$/;class U_{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new tn(t,this.data,this.fieldMask,e,this.fieldTransforms):new jr(t,this.data,e,this.fieldTransforms)}}function jf(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw j()}}class ra{constructor(t,e,n,i,s,a){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===s&&this.Bu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(t){return new ra(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),i=this.ku({path:n,Qu:!1});return i.$u(t),i}Uu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),i=this.ku({path:n,Qu:!1});return i.Bu(),i}Ku(t){return this.ku({path:void 0,Qu:!0})}Wu(t){return oa(t,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}Bu(){if(this.path)for(let t=0;t<this.path.length;t++)this.$u(this.path.get(t))}$u(t){if(0===t.length)throw this.Wu("Document fields must not be empty");if(jf(this.Lu)&&B_.test(t))throw this.Wu('Document fields cannot begin and end with "__"')}}class G_{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||As(t)}ju(t,e,n,i=!1){return new ra({Lu:t,methodName:e,zu:n,path:dt.emptyPath(),Qu:!1,Gu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ir(r){const t=r._freezeSettings(),e=As(r._databaseId);return new G_(r._databaseId,!!t.ignoreUndefinedProperties,e)}function ia(r,t,e,n,i,s={}){const a=r.ju(s.merge||s.mergeFields?2:0,t,e,i);hl("Data must be an object, but it was:",a,n);const u=$f(n,a);let c,h;if(s.merge)c=new qt(a.fieldMask),h=a.fieldTransforms;else if(s.mergeFields){const p=[];for(const g of s.mergeFields){const T=Ss(t,g,e);if(!a.contains(T))throw new O(x.INVALID_ARGUMENT,`Field '${T}' is specified in your field mask but missing from your input data.`);Wf(p,T)||p.push(T)}c=new qt(p),h=a.fieldTransforms.filter(g=>c.covers(g.field))}else c=null,h=a.fieldTransforms;return new U_(new Bt(u),c,h)}function sr(r,t){if(Qf(r=(0,et.Ku)(r)))return hl("Unsupported field value:",t,r),$f(r,t);if(r instanceof hi)return function(n,i){if(!jf(i.Lu))throw i.Wu(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Wu(`${n._methodName}() is not currently supported inside arrays`);const s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,t),null;if(void 0===r&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.Qu&&4!==t.Lu)throw t.Wu("Nested arrays are not supported");return function(n,i){const s=[];let a=0;for(const u of n){let c=sr(u,i.Ku(a));null==c&&(c={nullValue:"NULL_VALUE"}),s.push(c),a++}return{arrayValue:{values:s}}}(r,t)}return function(n,i){if(null===(n=(0,et.Ku)(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return Ih(i.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){const s=pt.fromDate(n);return{timestampValue:zr(i.serializer,s)}}if(n instanceof pt){const s=new pt(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:zr(i.serializer,s)}}if(n instanceof il)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof nr)return{bytesValue:Bh(i.serializer,n._byteString)};if(n instanceof Dt){const s=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw i.Wu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:mu(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof na)return a=n,u=i,{mapValue:{fields:{[Zi]:{stringValue:ts},[f]:{arrayValue:{values:a.toArray().map(h=>{if("number"!=typeof h)throw u.Wu("VectorValues must only contain numeric values.");return uu(u.serializer,h)})}}}}};var a,u;throw i.Wu(`Unsupported field value: ${ea(n)}`)}(r,t)}function $f(r,t){const e={};return Yi(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ke(r,(n,i)=>{const s=sr(i,t.qu(n));null!=s&&(e[n]=s)}),{mapValue:{fields:e}}}function Qf(r){return!("object"!=typeof r||null===r||r instanceof Array||r instanceof Date||r instanceof pt||r instanceof il||r instanceof nr||r instanceof Dt||r instanceof hi||r instanceof na)}function hl(r,t,e){if(!Qf(e)||"object"!=typeof(i=e)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const n=ea(e);throw t.Wu("an object"===n?r+" a custom object":r+" "+n)}var i}function Ss(r,t,e){if((t=(0,et.Ku)(t))instanceof rr)return t._internalPath;if("string"==typeof t)return sa(r,t);throw oa("Field path arguments must be of type string or ",r,!1,void 0,e)}const j_=new RegExp("[~\\*/\\[\\]]");function sa(r,t,e){if(t.search(j_)>=0)throw oa(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,e);try{return new rr(...t.split("."))._internalPath}catch{throw oa(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,e)}}function oa(r,t,e,n,i){const s=n&&!n.isEmpty(),a=void 0!==i;let u=`Function ${t}() called with invalid data`;e&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(s||a)&&(c+=" (found",s&&(c+=` in field ${n}`),a&&(c+=` in document ${i}`),c+=")"),new O(x.INVALID_ARGUMENT,u+r+c)}function Wf(r,t){return r.some(e=>e.isEqual(t))}class Vs{constructor(t,e,n,i,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Dt(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new K_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(aa("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class K_ extends Vs{data(){return super.data()}}function aa(r,t){return"string"==typeof t?sa(r,t):t instanceof rr?t._internalPath:t._delegate._internalPath}class ep{convertValue(t,e="none"){switch(w(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ft(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Ie(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw j()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return ke(t,(i,s)=>{n[i]=this.convertValue(s,e)}),n}convertVectorValue(t){var e,n,i;const s=null===(i=null===(n=null===(e=t.fields)||void 0===e?void 0:e[f].arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.map(a=>ft(a.doubleValue));return new na(s)}convertGeoPoint(t){return new il(ft(t.latitude),ft(t.longitude))}convertArray(t,e){return(t.values||[]).map(n=>this.convertValue(n,e))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Xi(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Or(t));default:return null}}convertTimestamp(t){const e=Te(t);return new pt(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=nt.fromString(t);z(Xh(n));const i=new me(n.get(1),n.get(3)),s=new U(n.popFirst(5));return i.isEqual(e)||At(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}}class or{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class fi extends Vs{constructor(t,e,n,i,s,a){super(t,e,n,i,a),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new da(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(aa("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class da extends fi{data(t={}){return super.data(t)}}class pi{constructor(t,e,n,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new or(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new da(this._firestore,this._userDataWriter,n.key,n,new or(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new O(x.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>({type:"added",doc:new da(i._firestore,i._userDataWriter,u.doc.key,u.doc,new or(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:a++}))}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||3!==u.type).map(u=>{const c=new da(i._firestore,i._userDataWriter,u.doc.key,u.doc,new or(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let h=-1,p=-1;return 0!==u.type&&(h=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),1!==u.type&&(a=a.add(u.doc),p=a.indexOf(u.doc.key)),{type:Q_(u.type),doc:c,oldIndex:h,newIndex:p}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Q_(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return j()}}function W_(r){r=rt(r,Dt);const t=rt(r.firestore,mt);return function Pf(r,t,e={}){const n=new Nt;return r.asyncQueue.enqueueAndForget((0,k.A)(function*(){return function(s,a,u,c,h){const p=new Zo({next:T=>{p.su(),a.enqueueAndForget(()=>fc(s,g));const S=T.docs.has(u);!S&&T.fromCache?h.reject(new O(x.UNAVAILABLE,"Failed to get document because the client is offline.")):S&&T.fromCache&&c&&"server"===c.source?h.reject(new O(x.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(T)},error:T=>h.reject(T)}),g=new _c(Lr(u.path),p,{includeMetadataChanges:!0,Ta:!0});return hc(s,g)}(yield li(r),r.asyncQueue,t,e,n)})),n.promise}(Rt(t),r._key).then(e=>pl(t,r,e))}class bn extends ep{constructor(t){super(),this.firestore=t}convertBytes(t){return new nr(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Dt(this.firestore,null,e)}}function H_(r,t,e){r=rt(r,Dt);const n=rt(r.firestore,mt),i=function ha(r,t,e){let n;return n=r?e&&(e.merge||e.mergeFields)?r.toFirestore(t,e):r.toFirestore(t):t,n}(r.converter,t,e);return function Ds(r,t){return function(n,i){const s=new Nt;return n.asyncQueue.enqueueAndForget((0,k.A)(function*(){return function r_(r,t,e){return Rc.apply(this,arguments)}(yield function Zc(r){return ta(r).then(t=>t.syncEngine)}(n),i,s)})),s.promise}(Rt(r),t)}(n,[ia(ir(n),"setDoc",r._key,i,null!==r.converter,e).toMutation(r._key,vt.none())])}function Y_(r,...t){var e,n,i;r=(0,et.Ku)(r);let s={includeMetadataChanges:!1,source:"default"},a=0;"object"!=typeof t[a]||nl(t[a])||(s=t[a],a++);const u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(nl(t[a])){const g=t[a];t[a]=null===(e=g.next)||void 0===e?void 0:e.bind(g),t[a+1]=null===(n=g.error)||void 0===n?void 0:n.bind(g),t[a+2]=null===(i=g.complete)||void 0===i?void 0:i.bind(g)}let c,h,p;if(r instanceof Dt)h=rt(r.firestore,mt),p=Lr(r._key.path),c={next:g=>{t[a]&&t[a](pl(h,r,g))},error:t[a+1],complete:t[a+2]};else{const g=rt(r,Ut);h=rt(g.firestore,mt),p=g._query;const T=new bn(h);c={next:S=>{t[a]&&t[a](new pi(h,T,g,S))},error:t[a+1],complete:t[a+2]},function Hf(r){if("L"===r.limitType&&0===r.explicitOrderBy.length)throw new O(x.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(r._query)}return function(T,S,N,L){const F=new Zo(L),$=new _c(S,F,N);return T.asyncQueue.enqueueAndForget((0,k.A)(function*(){return hc(yield li(T),$)})),()=>{F.su(),T.asyncQueue.enqueueAndForget((0,k.A)(function*(){return fc(yield li(T),$)}))}}(Rt(h),p,u,c)}function pl(r,t,e){const n=e.docs.get(t._key),i=new bn(r);return new fi(r,i,t._key,n,new or(e.hasPendingWrites,e.fromCache),t.converter)}!function(t,e=!0){Ae=te.MF,(0,te.om)(new kn.uA("firestore",(n,{instanceIdentifier:i,options:s})=>{const a=n.getProvider("app").getImmediate(),u=new mt(new Ca(n.getProvider("auth-internal")),new Ge(a,n.getProvider("app-check-internal")),function(h,p){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new O(x.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new me(h.options.projectId,p)}(a,i),a);return s=Object.assign({useFetchStreams:e},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),(0,te.KO)(dr,"4.7.10",t),(0,te.KO)(dr,"4.7.10","esm2017")}()},6828:(Ul,Ti,kt)=>{kt.d(Ti,{u:()=>ts});var k=kt(467),te=kt(5087),kn=kt(3273),ce=kt(2214),et=kt(8742),Nn=kt(1362),ve=kt(6858),Yt=kt(6749);const Ii="@firebase/installations",an="0.6.13",Ei=`w:${an}`,he=new ve.FA("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Ai(f){return f instanceof ve.g&&f.code.includes("request-failed")}function dr({projectId:f}){return`https://firebaseinstallations.googleapis.com/v1/projects/${f}/installations`}function wi(f){return{token:f.token,requestStatus:2,expiresIn:At(f.expiresIn),creationTime:Date.now()}}function Pt(f,_){return Ae.apply(this,arguments)}function Ae(){return(Ae=(0,k.A)(function*(f,_){const D=(yield _.json()).error;return he.create("request-failed",{requestName:f,serverCode:D.code,serverMessage:D.message,serverStatus:D.status})})).apply(this,arguments)}function ge({apiKey:f}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":f})}function eo(f){return M.apply(this,arguments)}function M(){return(M=(0,k.A)(function*(f){const _=yield f();return _.status>=500&&_.status<600?f():_})).apply(this,arguments)}function At(f){return Number(f.replace("s","000"))}function j(){return(j=(0,k.A)(function*({appConfig:f,heartbeatServiceProvider:_},{fid:w}){const D=dr(f),G=ge(f),K=_.getImmediate({optional:!0});if(K){const xt=yield K.getHeartbeatsHeader();xt&&G.append("x-firebase-client",xt)}const Et={method:"POST",headers:G,body:JSON.stringify({fid:w,authVersion:"FIS_v2",appId:f.appId,sdkVersion:Ei})},_t=yield eo(()=>fetch(D,Et));if(_t.ok){const xt=yield _t.json();return{fid:xt.fid||w,registrationStatus:2,refreshToken:xt.refreshToken,authToken:wi(xt.authToken)}}throw yield Pt("Create Installation",_t)})).apply(this,arguments)}function z(f){return new Promise(_=>{setTimeout(_,f)})}const q=/^[cdef][\w-]{21}$/;function O(){try{const f=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(f),f[0]=112+f[0]%16;const w=function Nt(f){return function Gl(f){return btoa(String.fromCharCode(...f)).replace(/\+/g,"-").replace(/\//g,"_")}(f).substr(0,22)}(f);return q.test(w)?w:""}catch{return""}}function Ue(f){return`${f.appName}!${f.appId}`}const un=new Map;function no(f,_){const w=Ue(f);ro(w,_),function Pi(f,_){const w=function ka(){return!Ge&&"BroadcastChannel"in self&&(Ge=new BroadcastChannel("[Firebase] FID Change"),Ge.onmessage=f=>{ro(f.data.key,f.data.fid)}),Ge}();w&&w.postMessage({key:f,fid:_}),function io(){0===un.size&&Ge&&(Ge.close(),Ge=null)}()}(w,_)}function ro(f,_){const w=un.get(f);if(w)for(const D of w)D(_)}let Ge=null;const H="firebase-installations-store";let On=null;function fr(){return On||(On=(0,Yt.P2)("firebase-installations-database",1,{upgrade:(f,_)=>{0===_&&f.createObjectStore(H)}})),On}function pr(f,_){return we.apply(this,arguments)}function we(){return(we=(0,k.A)(function*(f,_){const w=Ue(f),G=(yield fr()).transaction(H,"readwrite"),K=G.objectStore(H),X=yield K.get(w);return yield K.put(_,w),yield G.done,(!X||X.fid!==_.fid)&&no(f,_.fid),_})).apply(this,arguments)}function mr(f){return gr.apply(this,arguments)}function gr(){return(gr=(0,k.A)(function*(f){const _=Ue(f),D=(yield fr()).transaction(H,"readwrite");yield D.objectStore(H).delete(_),yield D.done})).apply(this,arguments)}function cn(f,_){return pt.apply(this,arguments)}function pt(){return(pt=(0,k.A)(function*(f,_){const w=Ue(f),G=(yield fr()).transaction(H,"readwrite"),K=G.objectStore(H),X=yield K.get(w),Et=_(X);return void 0===Et?yield K.delete(w):yield K.put(Et,w),yield G.done,Et&&(!X||X.fid!==Et.fid)&&no(f,Et.fid),Et})).apply(this,arguments)}function Q(f){return Fn.apply(this,arguments)}function Fn(){return Fn=(0,k.A)(function*(f){let _;const w=yield cn(f.appConfig,D=>{const G=function de(f){return _r(f||{fid:O(),registrationStatus:0})}(D),K=function nt(f,_){if(0===_.registrationStatus){if(!navigator.onLine)return{installationEntry:_,registrationPromise:Promise.reject(he.create("app-offline"))};const w={fid:_.fid,registrationStatus:1,registrationTime:Date.now()},D=function Na(f,_){return dt.apply(this,arguments)}(f,w);return{installationEntry:w,registrationPromise:D}}return 1===_.registrationStatus?{installationEntry:_,registrationPromise:U(f)}:{installationEntry:_}}(f,G);return _=K.registrationPromise,K.installationEntry});return""===w.fid?{installationEntry:yield _}:{installationEntry:w,registrationPromise:_}}),Fn.apply(this,arguments)}function dt(){return dt=(0,k.A)(function*(f,_){try{const w=yield function Ri(f,_){return j.apply(this,arguments)}(f,_);return pr(f.appConfig,w)}catch(w){throw Ai(w)&&409===w.customData.serverCode?yield mr(f.appConfig):yield pr(f.appConfig,{fid:_.fid,registrationStatus:0}),w}}),dt.apply(this,arguments)}function U(f){return Re.apply(this,arguments)}function Re(){return(Re=(0,k.A)(function*(f){let _=yield je(f.appConfig);for(;1===_.registrationStatus;)yield z(100),_=yield je(f.appConfig);if(0===_.registrationStatus){const{installationEntry:w,registrationPromise:D}=yield Q(f);return D||w}return _})).apply(this,arguments)}function je(f){return cn(f,_=>{if(!_)throw he.create("installation-not-found");return _r(_)})}function _r(f){return function Ke(f){return 1===f.registrationStatus&&f.registrationTime+1e4<Date.now()}(f)?{fid:f.fid,registrationStatus:0}:f}function _e(){return(_e=(0,k.A)(function*({appConfig:f,heartbeatServiceProvider:_},w){const D=function Oa(f,{fid:_}){return`${dr(f)}/${_}/authTokens:generate`}(f,w),G=function Be(f,{refreshToken:_}){const w=ge(f);return w.append("Authorization",function ee(f){return`FIS_v2 ${f}`}(_)),w}(f,w),K=_.getImmediate({optional:!0});if(K){const xt=yield K.getHeartbeatsHeader();xt&&G.append("x-firebase-client",xt)}const Et={method:"POST",headers:G,body:JSON.stringify({installation:{sdkVersion:Ei,appId:f.appId}})},_t=yield eo(()=>fetch(D,Et));if(_t.ok)return wi(yield _t.json());throw yield Pt("Generate Auth Token",_t)})).apply(this,arguments)}function Pe(f){return yr.apply(this,arguments)}function yr(){return yr=(0,k.A)(function*(f,_=!1){let w;const D=yield cn(f.appConfig,K=>{if(!ye(K))throw he.create("not-registered");const X=K.authToken;if(!_&&function Si(f){return 2===f.requestStatus&&!function P(f){const _=Date.now();return _<f.creationTime||f.creationTime+f.expiresIn<_+36e5}(f)}(X))return K;if(1===X.requestStatus)return w=function oo(f,_){return Lt.apply(this,arguments)}(f,_),K;{if(!navigator.onLine)throw he.create("app-offline");const Et=function Jt(f){const _={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},f),{authToken:_})}(K);return w=function ao(f,_){return Ir.apply(this,arguments)}(f,Et),Et}});return w?yield w:D.authToken}),yr.apply(this,arguments)}function Lt(){return(Lt=(0,k.A)(function*(f,_){let w=yield Tr(f.appConfig);for(;1===w.authToken.requestStatus;)yield z(100),w=yield Tr(f.appConfig);const D=w.authToken;return 0===D.requestStatus?Pe(f,_):D})).apply(this,arguments)}function Tr(f){return cn(f,_=>{if(!ye(_))throw he.create("not-registered");return function Er(f){return 1===f.requestStatus&&f.requestTime+1e4<Date.now()}(_.authToken)?Object.assign(Object.assign({},_),{authToken:{requestStatus:0}}):_})}function Ir(){return Ir=(0,k.A)(function*(f,_){try{const w=yield function Ma(f,_){return _e.apply(this,arguments)}(f,_),D=Object.assign(Object.assign({},_),{authToken:w});return yield pr(f.appConfig,D),w}catch(w){if(!Ai(w)||401!==w.customData.serverCode&&404!==w.customData.serverCode){const D=Object.assign(Object.assign({},_),{authToken:{requestStatus:0}});yield pr(f.appConfig,D)}else yield mr(f.appConfig);throw w}}),Ir.apply(this,arguments)}function ye(f){return void 0!==f&&2===f.registrationStatus}function vr(){return(vr=(0,k.A)(function*(f){const _=f,{installationEntry:w,registrationPromise:D}=yield Q(_);return D?D.catch(console.error):Pe(_).catch(console.error),w.fid})).apply(this,arguments)}function ze(){return ze=(0,k.A)(function*(f,_=!1){const w=f;return yield function be(f){return Vi.apply(this,arguments)}(w),(yield Pe(w,_)).token}),ze.apply(this,arguments)}function Vi(){return(Vi=(0,k.A)(function*(f){const{registrationPromise:_}=yield Q(f);_&&(yield _)})).apply(this,arguments)}function Qe(f){return he.create("missing-app-config-values",{valueName:f})}const ln="installations",Rr=f=>{const _=f.getProvider("app").getImmediate(),w=function Se(f){if(!f||!f.options)throw Qe("App Configuration");if(!f.name)throw Qe("App Name");const _=["projectId","apiKey","appId"];for(const w of _)if(!f.options[w])throw Qe(w);return{appName:f.name,projectId:f.options.projectId,apiKey:f.options.apiKey,appId:f.options.appId}}(_);return{app:_,appConfig:w,heartbeatServiceProvider:(0,et.j6)(_,"heartbeat"),_delete:()=>Promise.resolve()}},Ot=f=>{const _=f.getProvider("app").getImmediate(),w=(0,et.j6)(_,ln).getImmediate();return{getId:()=>function fe(f){return vr.apply(this,arguments)}(w),getToken:G=>function Fa(f){return ze.apply(this,arguments)}(w,G)}};(function La(){(0,et.om)(new Nn.uA(ln,Rr,"PUBLIC")),(0,et.om)(new Nn.uA("installations-internal",Ot,"PRIVATE"))})(),(0,et.KO)(Ii,an),(0,et.KO)(Ii,an,"esm2017");const Ve="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",We="google.c.a.c_id";var Bn=function(f){return f.PUSH_RECEIVED="push-received",f.NOTIFICATION_CLICKED="notification-clicked",f}(Bn||{});function re(f){const _=new Uint8Array(f);return btoa(String.fromCharCode(..._)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function lo(f){const w=(f+"=".repeat((4-f.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),D=atob(w),G=new Uint8Array(D.length);for(let K=0;K<D.length;++K)G[K]=D.charCodeAt(K);return G}const ki="fcm_token_details_db",Un="fcm_token_object_Store";function dn(){return dn=(0,k.A)(function*(f){if("databases"in indexedDB&&!(yield indexedDB.databases()).map(K=>K.name).includes(ki))return null;let _=null;return(yield(0,Yt.P2)(ki,5,{upgrade:(D=(0,k.A)(function*(G,K,X,Et){var _t;if(K<2||!G.objectStoreNames.contains(Un))return;const xt=Et.objectStore(Un),ae=yield xt.index("fcmSenderId").get(f);if(yield xt.clear(),ae)if(2===K){const it=ae;if(!it.auth||!it.p256dh||!it.endpoint)return;_={token:it.fcmToken,createTime:null!==(_t=it.createTime)&&void 0!==_t?_t:Date.now(),subscriptionOptions:{auth:it.auth,p256dh:it.p256dh,endpoint:it.endpoint,swScope:it.swScope,vapidKey:"string"==typeof it.vapidKey?it.vapidKey:re(it.vapidKey)}}}else if(3===K){const it=ae;_={token:it.fcmToken,createTime:it.createTime,subscriptionOptions:{auth:re(it.auth),p256dh:re(it.p256dh),endpoint:it.endpoint,swScope:it.swScope,vapidKey:re(it.vapidKey)}}}else if(4===K){const it=ae;_={token:it.fcmToken,createTime:it.createTime,subscriptionOptions:{auth:re(it.auth),p256dh:re(it.p256dh),endpoint:it.endpoint,swScope:it.swScope,vapidKey:re(it.vapidKey)}}}}),function(K,X,Et,_t){return D.apply(this,arguments)})})).close(),yield(0,Yt.MR)(ki),yield(0,Yt.MR)("fcm_vapid_details_db"),yield(0,Yt.MR)("undefined"),function Ua(f){if(!f||!f.subscriptionOptions)return!1;const{subscriptionOptions:_}=f;return"number"==typeof f.createTime&&f.createTime>0&&"string"==typeof f.token&&f.token.length>0&&"string"==typeof _.auth&&_.auth.length>0&&"string"==typeof _.p256dh&&_.p256dh.length>0&&"string"==typeof _.endpoint&&_.endpoint.length>0&&"string"==typeof _.swScope&&_.swScope.length>0&&"string"==typeof _.vapidKey&&_.vapidKey.length>0}(_)?_:null;var D}),dn.apply(this,arguments)}const oe="firebase-messaging-store";let Gn=null;function xe(){return Gn||(Gn=(0,Yt.P2)("firebase-messaging-database",1,{upgrade:(f,_)=>{0===_&&f.createObjectStore(oe)}})),Gn}function Mi(){return Mi=(0,k.A)(function*(f){const _=fn(f),D=yield(yield xe()).transaction(oe).objectStore(oe).get(_);if(D)return D;{const G=yield function Ba(f){return dn.apply(this,arguments)}(f.appConfig.senderId);if(G)return yield Ce(f,G),G}}),Mi.apply(this,arguments)}function Ce(f,_){return Oi.apply(this,arguments)}function Oi(){return(Oi=(0,k.A)(function*(f,_){const w=fn(f),G=(yield xe()).transaction(oe,"readwrite");return yield G.objectStore(oe).put(_,w),yield G.done,_})).apply(this,arguments)}function fn({appConfig:f}){return f.appId}const wt=new ve.FA("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});function ja(f,_){return De.apply(this,arguments)}function De(){return(De=(0,k.A)(function*(f,_){const w=yield jn(f),D=Pr(_),G={method:"POST",headers:w,body:JSON.stringify(D)};let K;try{K=yield(yield fetch(qi(f.appConfig),G)).json()}catch(X){throw wt.create("token-subscribe-failed",{errorInfo:null==X?void 0:X.toString()})}if(K.error)throw wt.create("token-subscribe-failed",{errorInfo:K.error.message});if(!K.token)throw wt.create("token-subscribe-no-token");return K.token})).apply(this,arguments)}function pn(){return(pn=(0,k.A)(function*(f,_){const w=yield jn(f),D=Pr(_.subscriptionOptions),G={method:"PATCH",headers:w,body:JSON.stringify(D)};let K;try{K=yield(yield fetch(`${qi(f.appConfig)}/${_.token}`,G)).json()}catch(X){throw wt.create("token-update-failed",{errorInfo:null==X?void 0:X.toString()})}if(K.error)throw wt.create("token-update-failed",{errorInfo:K.error.message});if(!K.token)throw wt.create("token-update-no-token");return K.token})).apply(this,arguments)}function mn(){return(mn=(0,k.A)(function*(f,_){const D={method:"DELETE",headers:yield jn(f)};try{const K=yield(yield fetch(`${qi(f.appConfig)}/${_}`,D)).json();if(K.error)throw wt.create("token-unsubscribe-failed",{errorInfo:K.error.message})}catch(G){throw wt.create("token-unsubscribe-failed",{errorInfo:null==G?void 0:G.toString()})}})).apply(this,arguments)}function qi({projectId:f}){return`https://fcmregistrations.googleapis.com/v1/projects/${f}/registrations`}function jn(f){return Bi.apply(this,arguments)}function Bi(){return(Bi=(0,k.A)(function*({appConfig:f,installations:_}){const w=yield _.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":f.apiKey,"x-goog-firebase-installations-auth":`FIS ${w}`})})).apply(this,arguments)}function Pr({p256dh:f,auth:_,endpoint:w,vapidKey:D}){const G={web:{endpoint:w,auth:_,p256dh:f}};return D!==Ve&&(G.web.applicationPubKey=D),G}function Ui(){return Ui=(0,k.A)(function*(f){const _=yield function Vr(f,_){return $i.apply(this,arguments)}(f.swRegistration,f.vapidKey),w={vapidKey:f.vapidKey,swScope:f.swRegistration.scope,endpoint:_.endpoint,auth:re(_.getKey("auth")),p256dh:re(_.getKey("p256dh"))},D=yield function Ni(f){return Mi.apply(this,arguments)}(f.firebaseDependencies);if(D){if(function Qi(f,_){return _.vapidKey===f.vapidKey&&_.endpoint===f.endpoint&&_.auth===f.auth&&_.p256dh===f.p256dh}(D.subscriptionOptions,w))return Date.now()>=D.createTime+6048e5?function Sr(f,_){return ji.apply(this,arguments)}(f,{token:D.token,createTime:Date.now(),subscriptionOptions:w}):D.token;try{yield function fo(f,_){return mn.apply(this,arguments)}(f.firebaseDependencies,D.token)}catch(G){console.warn(G)}return Ki(f.firebaseDependencies,w)}return Ki(f.firebaseDependencies,w)}),Ui.apply(this,arguments)}function ji(){return ji=(0,k.A)(function*(f,_){try{const w=yield function Ka(f,_){return pn.apply(this,arguments)}(f.firebaseDependencies,_),D=Object.assign(Object.assign({},_),{token:w,createTime:Date.now()});return yield Ce(f.firebaseDependencies,D),w}catch(w){throw w}}),ji.apply(this,arguments)}function Ki(f,_){return zi.apply(this,arguments)}function zi(){return(zi=(0,k.A)(function*(f,_){const D={token:yield ja(f,_),createTime:Date.now(),subscriptionOptions:_};return yield Ce(f,D),D.token})).apply(this,arguments)}function $i(){return($i=(0,k.A)(function*(f,_){return(yield f.pushManager.getSubscription())||f.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:lo(_)})})).apply(this,arguments)}function mo(f){const _={from:f.from,collapseKey:f.collapse_key,messageId:f.fcmMessageId};return function go(f,_){if(!_.notification)return;f.notification={};const w=_.notification.title;w&&(f.notification.title=w);const D=_.notification.body;D&&(f.notification.body=D);const G=_.notification.image;G&&(f.notification.image=G);const K=_.notification.icon;K&&(f.notification.icon=K)}(_,f),function $a(f,_){_.data&&(f.data=_.data)}(_,f),function Wi(f,_){var w,D,G,K,X;if(!(_.fcmOptions||null!==(w=_.notification)&&void 0!==w&&w.click_action))return;f.fcmOptions={};const Et=null!==(G=null===(D=_.fcmOptions)||void 0===D?void 0:D.link)&&void 0!==G?G:null===(K=_.notification)||void 0===K?void 0:K.click_action;Et&&(f.fcmOptions.link=Et);const _t=null===(X=_.fcmOptions)||void 0===X?void 0:X.analytics_label;_t&&(f.fcmOptions.analyticsLabel=_t)}(_,f),_}function xr(f){return wt.create("missing-app-config-values",{valueName:f})}!function _o(f,_){const w=[];for(let D=0;D<f.length;D++)w.push(f.charAt(D)),D<_.length&&w.push(_.charAt(D));w.join("")}("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class yo{constructor(_,w,D){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const G=function Wa(f){if(!f||!f.options)throw xr("App Configuration Object");if(!f.name)throw xr("App Name");const _=["projectId","apiKey","appId","messagingSenderId"],{options:w}=f;for(const D of _)if(!w[D])throw xr(D);return{appName:f.name,projectId:w.projectId,apiKey:w.apiKey,appId:w.appId,senderId:w.messagingSenderId}}(_);this.firebaseDependencies={app:_,appConfig:G,installations:w,analyticsProvider:D}}_delete(){return Promise.resolve()}}function Hi(){return Hi=(0,k.A)(function*(f){try{f.swRegistration=yield navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}),f.swRegistration.update().catch(()=>{}),yield function Ha(f){return Kn.apply(this,arguments)}(f.swRegistration)}catch(_){throw wt.create("failed-service-worker-registration",{browserErrorMessage:null==_?void 0:_.message})}}),Hi.apply(this,arguments)}function Kn(){return(Kn=(0,k.A)(function*(f){return new Promise((_,w)=>{const D=setTimeout(()=>w(new Error("Service worker not registered after 10000 ms")),1e4),G=f.installing||f.waiting;f.active?(clearTimeout(D),_()):G?G.onstatechange=K=>{var X;"activated"===(null===(X=K.target)||void 0===X?void 0:X.state)&&(G.onstatechange=null,clearTimeout(D),_())}:(clearTimeout(D),w(new Error("No incoming service worker found.")))})})).apply(this,arguments)}function Dr(){return(Dr=(0,k.A)(function*(f,_){if(!_&&!f.swRegistration&&(yield function Cr(f){return Hi.apply(this,arguments)}(f)),_||!f.swRegistration){if(!(_ instanceof ServiceWorkerRegistration))throw wt.create("invalid-sw-registration");f.swRegistration=_}})).apply(this,arguments)}function kr(){return(kr=(0,k.A)(function*(f,_){_?f.vapidKey=_:f.vapidKey||(f.vapidKey=Ve)})).apply(this,arguments)}function lt(){return lt=(0,k.A)(function*(f,_){if(!navigator)throw wt.create("only-available-in-window");if("default"===Notification.permission&&(yield Notification.requestPermission()),"granted"!==Notification.permission)throw wt.create("permission-blocked");return yield function ke(f,_){return kr.apply(this,arguments)}(f,null==_?void 0:_.vapidKey),yield function St(f,_){return Dr.apply(this,arguments)}(f,null==_?void 0:_.serviceWorkerRegistration),function br(f){return Ui.apply(this,arguments)}(f)}),lt.apply(this,arguments)}function Vt(){return(Vt=(0,k.A)(function*(f,_,w){const D=function ct(f){switch(f){case Bn.NOTIFICATION_CLICKED:return"notification_open";case Bn.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(_);(yield f.firebaseDependencies.analyticsProvider.get()).logEvent(D,{message_id:w[We],message_name:w["google.c.a.c_l"],message_time:w["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)})})).apply(this,arguments)}function Ne(){return Ne=(0,k.A)(function*(f,_){const w=_.data;if(!w.isFirebaseMessaging)return;f.onMessageHandler&&w.messageType===Bn.PUSH_RECEIVED&&("function"==typeof f.onMessageHandler?f.onMessageHandler(mo(w)):f.onMessageHandler.next(mo(w)));const D=w.data;(function Qa(f){return"object"==typeof f&&!!f&&We in f})(D)&&"1"===D["google.c.a.e"]&&(yield function Nr(f,_,w){return Vt.apply(this,arguments)}(f,w.messageType,D))}),Ne.apply(this,arguments)}const qt="@firebase/messaging",Ji="0.12.17",Kl=f=>{const _=new yo(f.getProvider("app").getImmediate(),f.getProvider("installations-internal").getImmediate(),f.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",w=>function To(f,_){return Ne.apply(this,arguments)}(_,w)),_},It=f=>{const _=f.getProvider("messaging").getImmediate();return{getToken:D=>function Yi(f,_){return lt.apply(this,arguments)}(_,D)}};function ft(){return(ft=(0,k.A)(function*(){try{yield(0,ve.eX)()}catch{return!1}return typeof window<"u"&&(0,ve.zW)()&&(0,ve.dM)()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")})).apply(this,arguments)}!function Ya(){(0,et.om)(new Nn.uA("messaging",Kl,"PUBLIC")),(0,et.om)(new Nn.uA("messaging-internal",It,"PRIVATE")),(0,et.KO)(qt,Ji),(0,et.KO)(qt,Ji,"esm2017")}();const Je=(0,ce.Wp)({apiKey:"AIzaSyDMs1k5KrRoBxeB3VRV6smRXk6BWZjpIYk",authDomain:"jitcall-b72ec.firebaseapp.com",projectId:"jitcall-b72ec",storageBucket:"jitcall-b72ec.firebasestorage.app",messagingSenderId:"143489396645",appId:"1:143489396645:web:c0589cbc9a4ef07e65c24c",measurementId:"G-3VS63P1SYS"}),me=(0,te.xI)(Je),Zi=(0,kn.aU)(Je);!function Eo(f=(0,et.Sx)()){(function Te(){return ft.apply(this,arguments)})().then(_=>{if(!_)throw wt.create("unsupported-browser")},_=>{throw wt.create("indexed-db-unsupported")}),(0,et.j6)((0,ve.Ku)(f),"messaging").getImmediate()}(Je);var Me=kt(1360);let ts=(()=>{var f;class _{constructor(){}registerUser(D,G,K,X,Et){return(0,k.A)(function*(){const _t=yield(0,te.eJ)(me,D,G),xt=_t.user.uid,ae=(0,kn.H9)(Zi,"users",xt);return yield(0,kn.BN)(ae,{uid:xt,email:D,nombre:K,apellido:X,telefono:Et}),_t})()}login(D,G){return(0,k.A)(function*(){return(0,te.x9)(me,D,G)})()}logout(){return(0,k.A)(function*(){return(0,te.CI)(me)})()}getCurrentUser(){return me.currentUser}}return(f=_).\u0275fac=function(D){return new(D||f)},f.\u0275prov=Me.jDH({token:f,factory:f.\u0275fac,providedIn:"root"}),_})()}}]);