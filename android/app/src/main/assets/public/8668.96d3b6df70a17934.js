(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8668],{505:(V,O,b)=>{"use strict";b.d(O,{F:()=>k});var c=b(467),w=b(9967),B=b(8455),M=b(1985),p=b(6354),h=b(1360),m=b(3522),E=b(5621),S=b(7125);let k=(()=>{var T;class _{constructor(A,R,U,C){this.firestore=A,this.authService=R,this.auth=U,this.alertController=C}obtenerContactos(){const A=this.authService.getUserId();if(A){const R=(0,w.rJ)(this.firestore,`users/${A}/contacts`),U=(0,w.P)(R);return(0,B.H)((0,w.GG)(U)).pipe((0,p.T)(C=>C.docs.map(q=>q.data())))}return new M.c}checkIfContactExists(A){var R=this;return(0,c.A)(function*(){const U=R.authService.getUserId();if(U){const C=(0,w.rJ)(R.firestore,`users/${U}/contacts`),q=(0,w.P)(C,(0,w._M)("phone","==",A));return!(yield(0,w.GG)(q)).empty}return!1})()}agregarContacto(A,R){var U=this;return(0,c.A)(function*(){const C=(0,w.rJ)(U.firestore,"users"),q=(0,w.P)(C,(0,w._M)("phone","==",A)),X=yield(0,w.GG)(q);if(X.empty)console.error("No se encontr\xf3 un usuario con ese tel\xe9fono."),U.showAlert("Contacto no encontrado","No existe un usuario con ese n\xfamero de tel\xe9fono.");else{var re;const x=X.docs[0],g=null===(re=U.auth.currentUser)||void 0===re?void 0:re.uid;if(g){const v=(0,w.H9)(U.firestore,`users/${g}/contacts/${x.id}`);yield(0,w.BN)(v,{name:R,phone:x.data().phone,userId:x.id}),console.log("Contacto agregado exitosamente."),U.showAlert("Contacto Agregado","\xa1El contacto se agreg\xf3 exitosamente!")}else console.error("No hay usuario logueado."),U.showAlert("Error","No hay usuario logueado.")}})()}getUserData(A){var R=this;return(0,c.A)(function*(){const U=(0,w.H9)(R.firestore,`users/${A}`),C=yield(0,w.x7)(U);return C.exists()?C.data():null})()}showAlert(A,R){var U=this;return(0,c.A)(function*(){yield(yield U.alertController.create({header:A,message:R,buttons:["OK"]})).present()})()}}return(T=_).\u0275fac=function(A){return new(A||T)(h.KVO(w._7),h.KVO(m.K),h.KVO(E.Nj),h.KVO(S.hG))},T.\u0275prov=h.jDH({token:T,factory:T.\u0275fac,providedIn:"root"}),_})()},3056:(V,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.version=void 0,O.version="0.0.0-automated"},3057:(V,O,b)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.DEFAULT_HEADERS=void 0;const c=b(3056);O.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${c.version}`}},3242:function(V,O,b){"use strict";var c=this&&this.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(O,"__esModule",{value:!0});const w=c(b(8666)),B=c(b(3608)),M=b(3057);class p{constructor(m,{headers:E={},schema:S,fetch:k}={}){this.url=m,this.headers=Object.assign(Object.assign({},M.DEFAULT_HEADERS),E),this.schemaName=S,this.fetch=k}from(m){const E=new URL(`${this.url}/${m}`);return new w.default(E,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(m){return new p(this.url,{headers:this.headers,schema:m,fetch:this.fetch})}rpc(m,E={},{head:S=!1,get:k=!1,count:T}={}){let _;const y=new URL(`${this.url}/rpc/${m}`);let A;S||k?(_=S?"HEAD":"GET",Object.entries(E).filter(([U,C])=>void 0!==C).map(([U,C])=>[U,Array.isArray(C)?`{${C.join(",")}}`:`${C}`]).forEach(([U,C])=>{y.searchParams.append(U,C)})):(_="POST",A=E);const R=Object.assign({},this.headers);return T&&(R.Prefer=`count=${T}`),new B.default({method:_,url:y,headers:R,schema:this.schemaName,body:A,fetch:this.fetch,allowEmpty:!1})}}O.default=p},3342:function(V,O,b){"use strict";var c=this&&this.__importDefault||function(M){return M&&M.__esModule?M:{default:M}};Object.defineProperty(O,"__esModule",{value:!0});const w=c(b(5958));O.default=class B extends w.default{select(p){let h=!1;const m=(null!=p?p:"*").split("").map(E=>/\s/.test(E)&&!h?"":('"'===E&&(h=!h),E)).join("");return this.url.searchParams.set("select",m),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(p,{ascending:h=!0,nullsFirst:m,foreignTable:E,referencedTable:S=E}={}){const k=S?`${S}.order`:"order",T=this.url.searchParams.get(k);return this.url.searchParams.set(k,`${T?`${T},`:""}${p}.${h?"asc":"desc"}${void 0===m?"":m?".nullsfirst":".nullslast"}`),this}limit(p,{foreignTable:h,referencedTable:m=h}={}){return this.url.searchParams.set(typeof m>"u"?"limit":`${m}.limit`,`${p}`),this}range(p,h,{foreignTable:m,referencedTable:E=m}={}){const k=typeof E>"u"?"limit":`${E}.limit`;return this.url.searchParams.set(typeof E>"u"?"offset":`${E}.offset`,`${p}`),this.url.searchParams.set(k,""+(h-p+1)),this}abortSignal(p){return this.signal=p,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.headers.Accept="GET"===this.method?"application/json":"application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:p=!1,verbose:h=!1,settings:m=!1,buffers:E=!1,wal:S=!1,format:k="text"}={}){var T;const _=[p?"analyze":null,h?"verbose":null,m?"settings":null,E?"buffers":null,S?"wal":null].filter(Boolean).join("|"),y=null!==(T=this.headers.Accept)&&void 0!==T?T:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${k}; for="${y}"; options=${_};`,this}rollback(){var p;return(null!==(p=this.headers.Prefer)&&void 0!==p?p:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}},3608:function(V,O,b){"use strict";var c=this&&this.__importDefault||function(M){return M&&M.__esModule?M:{default:M}};Object.defineProperty(O,"__esModule",{value:!0});const w=c(b(3342));O.default=class B extends w.default{eq(p,h){return this.url.searchParams.append(p,`eq.${h}`),this}neq(p,h){return this.url.searchParams.append(p,`neq.${h}`),this}gt(p,h){return this.url.searchParams.append(p,`gt.${h}`),this}gte(p,h){return this.url.searchParams.append(p,`gte.${h}`),this}lt(p,h){return this.url.searchParams.append(p,`lt.${h}`),this}lte(p,h){return this.url.searchParams.append(p,`lte.${h}`),this}like(p,h){return this.url.searchParams.append(p,`like.${h}`),this}likeAllOf(p,h){return this.url.searchParams.append(p,`like(all).{${h.join(",")}}`),this}likeAnyOf(p,h){return this.url.searchParams.append(p,`like(any).{${h.join(",")}}`),this}ilike(p,h){return this.url.searchParams.append(p,`ilike.${h}`),this}ilikeAllOf(p,h){return this.url.searchParams.append(p,`ilike(all).{${h.join(",")}}`),this}ilikeAnyOf(p,h){return this.url.searchParams.append(p,`ilike(any).{${h.join(",")}}`),this}is(p,h){return this.url.searchParams.append(p,`is.${h}`),this}in(p,h){const m=Array.from(new Set(h)).map(E=>"string"==typeof E&&new RegExp("[,()]").test(E)?`"${E}"`:`${E}`).join(",");return this.url.searchParams.append(p,`in.(${m})`),this}contains(p,h){return"string"==typeof h?this.url.searchParams.append(p,`cs.${h}`):Array.isArray(h)?this.url.searchParams.append(p,`cs.{${h.join(",")}}`):this.url.searchParams.append(p,`cs.${JSON.stringify(h)}`),this}containedBy(p,h){return"string"==typeof h?this.url.searchParams.append(p,`cd.${h}`):Array.isArray(h)?this.url.searchParams.append(p,`cd.{${h.join(",")}}`):this.url.searchParams.append(p,`cd.${JSON.stringify(h)}`),this}rangeGt(p,h){return this.url.searchParams.append(p,`sr.${h}`),this}rangeGte(p,h){return this.url.searchParams.append(p,`nxl.${h}`),this}rangeLt(p,h){return this.url.searchParams.append(p,`sl.${h}`),this}rangeLte(p,h){return this.url.searchParams.append(p,`nxr.${h}`),this}rangeAdjacent(p,h){return this.url.searchParams.append(p,`adj.${h}`),this}overlaps(p,h){return this.url.searchParams.append(p,"string"==typeof h?`ov.${h}`:`ov.{${h.join(",")}}`),this}textSearch(p,h,{config:m,type:E}={}){let S="";return"plain"===E?S="pl":"phrase"===E?S="ph":"websearch"===E&&(S="w"),this.url.searchParams.append(p,`${S}fts${void 0===m?"":`(${m})`}.${h}`),this}match(p){return Object.entries(p).forEach(([h,m])=>{this.url.searchParams.append(h,`eq.${m}`)}),this}not(p,h,m){return this.url.searchParams.append(p,`not.${h}.${m}`),this}or(p,{foreignTable:h,referencedTable:m=h}={}){return this.url.searchParams.append(m?`${m}.or`:"or",`(${p})`),this}filter(p,h,m){return this.url.searchParams.append(p,`${h}.${m}`),this}}},4060:function(V,O,b){"use strict";var c=this&&this.__importDefault||function(E){return E&&E.__esModule?E:{default:E}};Object.defineProperty(O,"__esModule",{value:!0}),O.PostgrestError=O.PostgrestBuilder=O.PostgrestTransformBuilder=O.PostgrestFilterBuilder=O.PostgrestQueryBuilder=O.PostgrestClient=void 0;const w=c(b(3242));O.PostgrestClient=w.default;const B=c(b(8666));O.PostgrestQueryBuilder=B.default;const M=c(b(3608));O.PostgrestFilterBuilder=M.default;const p=c(b(3342));O.PostgrestTransformBuilder=p.default;const h=c(b(5958));O.PostgrestBuilder=h.default;const m=c(b(4659));O.PostgrestError=m.default,O.default={PostgrestClient:w.default,PostgrestQueryBuilder:B.default,PostgrestFilterBuilder:M.default,PostgrestTransformBuilder:p.default,PostgrestBuilder:h.default,PostgrestError:m.default}},4287:(V,O,b)=>{"use strict";function c(w){var B;null!==(B=window.AndroidJitsi)&&void 0!==B&&B.startJitsiCall?window.AndroidJitsi.startJitsiCall(w):console.warn("AndroidJitsi no disponible")}b.d(O,{_:()=>c})},4659:(V,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0});class b extends Error{constructor(w){super(w.message),this.name="PostgrestError",this.details=w.details,this.hint=w.hint,this.code=w.code}}O.default=b},5051:(V,O,b)=>{"use strict";b.d(O,{k:()=>c});const c={RECORDING:"RECORDING",PAUSED:"PAUSED",NONE:"NONE"}},5286:(V,O,b)=>{"use strict";b.r(O),b.d(O,{Headers:()=>p,Request:()=>h,Response:()=>m,default:()=>M,fetch:()=>B});var w=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}();const B=w.fetch,M=w.fetch.bind(w),p=w.Headers,h=w.Request,m=w.Response},5293:(V,O,b)=>{"use strict";b.d(O,{R:()=>B});var c=b(7464);b(5051);const B=(0,c.F3)("VoiceRecorder",{web:()=>Promise.all([b.e(2076),b.e(9047)]).then(b.bind(b,9047)).then(M=>new M.VoiceRecorderWeb)})},5958:function(V,O,b){"use strict";var c=b(9293).default,w=this&&this.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(O,"__esModule",{value:!0});const B=w(b(5286)),M=w(b(4659));O.default=class p{constructor(m){this.shouldThrowOnError=!1,this.method=m.method,this.url=m.url,this.headers=m.headers,this.schema=m.schema,this.body=m.body,this.shouldThrowOnError=m.shouldThrowOnError,this.signal=m.signal,this.isMaybeSingle=m.isMaybeSingle,this.fetch=m.fetch?m.fetch:typeof fetch>"u"?B.default:fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(m,E){return this.headers=Object.assign({},this.headers),this.headers[m]=E,this}then(m,E){var S=this;void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let T=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(function(){var _=c(function*(y){var A,R,U;let C=null,q=null,X=null,re=y.status,x=y.statusText;if(y.ok){if("HEAD"!==S.method){const I=yield y.text();""===I||(q="text/csv"===S.headers.Accept||S.headers.Accept&&S.headers.Accept.includes("application/vnd.pgrst.plan+text")?I:JSON.parse(I))}const v=null===(A=S.headers.Prefer)||void 0===A?void 0:A.match(/count=(exact|planned|estimated)/),L=null===(R=y.headers.get("content-range"))||void 0===R?void 0:R.split("/");v&&L&&L.length>1&&(X=parseInt(L[1])),S.isMaybeSingle&&"GET"===S.method&&Array.isArray(q)&&(q.length>1?(C={code:"PGRST116",details:`Results contain ${q.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},q=null,X=null,re=406,x="Not Acceptable"):q=1===q.length?q[0]:null)}else{const v=yield y.text();try{C=JSON.parse(v),Array.isArray(C)&&404===y.status&&(q=[],C=null,re=200,x="OK")}catch{404===y.status&&""===v?(re=204,x="No Content"):C={message:v}}if(C&&S.isMaybeSingle&&!(null===(U=null==C?void 0:C.details)||void 0===U)&&U.includes("0 rows")&&(C=null,re=200,x="OK"),C&&S.shouldThrowOnError)throw new M.default(C)}return{error:C,data:q,count:X,status:re,statusText:x}});return function(y){return _.apply(this,arguments)}}());return this.shouldThrowOnError||(T=T.catch(_=>{var y,A,R;return{error:{message:`${null!==(y=null==_?void 0:_.name)&&void 0!==y?y:"FetchError"}: ${null==_?void 0:_.message}`,details:`${null!==(A=null==_?void 0:_.stack)&&void 0!==A?A:""}`,hint:"",code:`${null!==(R=null==_?void 0:_.code)&&void 0!==R?R:""}`},data:null,count:null,status:0,statusText:""}})),T.then(m,E)}returns(){return this}overrideTypes(){return this}}},6368:(V,O,b)=>{"use strict";b.d(O,{A:()=>T});const w={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let B;const M=new Uint8Array(16),h=[];for(let _=0;_<256;++_)h.push((_+256).toString(16).slice(1));const T=function k(_,y,A){var R,U,C,q;if(w.randomUUID&&!y&&!_)return w.randomUUID();const X=null!==(R=null!==(U=(_=_||{}).random)&&void 0!==U?U:null===(C=(q=_).rng)||void 0===C?void 0:C.call(q))&&void 0!==R?R:function p(){if(!B){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");B=crypto.getRandomValues.bind(crypto)}return B(M)}();if(X.length<16)throw new Error("Random bytes length must be >= 16");if(X[6]=15&X[6]|64,X[8]=63&X[8]|128,y){if((A=A||0)<0||A+16>y.length)throw new RangeError(`UUID byte range ${A}:${A+15} is out of buffer bounds`);for(let re=0;re<16;++re)y[A+re]=X[re];return y}return function m(_,y=0){return(h[_[y+0]]+h[_[y+1]]+h[_[y+2]]+h[_[y+3]]+"-"+h[_[y+4]]+h[_[y+5]]+"-"+h[_[y+6]]+h[_[y+7]]+"-"+h[_[y+8]]+h[_[y+9]]+"-"+h[_[y+10]]+h[_[y+11]]+h[_[y+12]]+h[_[y+13]]+h[_[y+14]]+h[_[y+15]]).toLowerCase()}(X)}},7464:(V,O,b)=>{"use strict";b.d(O,{EA:()=>q,E_:()=>S,F3:()=>E,I9:()=>B,Ii:()=>m});var c=b(467),w=function(x){return x.Unimplemented="UNIMPLEMENTED",x.Unavailable="UNAVAILABLE",x}(w||{});class B extends Error{constructor(g,v,L){super(g),this.message=g,this.code=v,this.data=L}}const p=x=>{const g=x.CapacitorCustomPlatform||null,v=x.Capacitor||{},L=v.Plugins=v.Plugins||{},I=()=>null!==g?g.name:(x=>{var g,v;return null!=x&&x.androidBridge?"android":null!==(v=null===(g=null==x?void 0:x.webkit)||void 0===g?void 0:g.messageHandlers)&&void 0!==v&&v.bridge?"ios":"web"})(x),Y=z=>{var Q;return null===(Q=v.PluginHeaders)||void 0===Q?void 0:Q.find(ye=>ye.name===z)},N=new Map;return v.convertFileSrc||(v.convertFileSrc=z=>z),v.getPlatform=I,v.handleError=z=>x.console.error(z),v.isNativePlatform=()=>"web"!==I(),v.isPluginAvailable=z=>{const Q=N.get(z);return!!(null!=Q&&Q.platforms.has(I())||Y(z))},v.registerPlugin=(z,Q={})=>{const ye=N.get(z);if(ye)return console.warn(`Capacitor plugin "${z}" already registered. Cannot register plugins twice.`),ye.proxy;const fe=I(),me=Y(z);let ae;const Xe=function(){var Z=(0,c.A)(function*(){return!ae&&fe in Q?ae=ae="function"==typeof Q[fe]?yield Q[fe]():Q[fe]:null!==g&&!ae&&"web"in Q&&(ae=ae="function"==typeof Q.web?yield Q.web():Q.web),ae});return function(){return Z.apply(this,arguments)}}(),xe=Z=>{let W;const le=(...oe)=>{const ce=Xe().then(ie=>{const pe=((Z,W)=>{var le,oe;if(!me){if(Z)return null===(oe=Z[W])||void 0===oe?void 0:oe.bind(Z);throw new B(`"${z}" plugin is not implemented on ${fe}`,w.Unimplemented)}{const ce=null==me?void 0:me.methods.find(ie=>W===ie.name);if(ce)return"promise"===ce.rtype?ie=>v.nativePromise(z,W.toString(),ie):(ie,pe)=>v.nativeCallback(z,W.toString(),ie,pe);if(Z)return null===(le=Z[W])||void 0===le?void 0:le.bind(Z)}})(ie,Z);if(pe){const Ce=pe(...oe);return W=null==Ce?void 0:Ce.remove,Ce}throw new B(`"${z}.${Z}()" is not implemented on ${fe}`,w.Unimplemented)});return"addListener"===Z&&(ce.remove=(0,c.A)(function*(){return W()})),ce};return le.toString=()=>`${Z.toString()}() { [capacitor code] }`,Object.defineProperty(le,"name",{value:Z,writable:!1,configurable:!1}),le},je=xe("addListener"),qe=xe("removeListener"),Se=(Z,W)=>{const le=je({eventName:Z},W),oe=function(){var ie=(0,c.A)(function*(){const pe=yield le;qe({eventName:Z,callbackId:pe},W)});return function(){return ie.apply(this,arguments)}}(),ce=new Promise(ie=>le.then(()=>ie({remove:oe})));return ce.remove=(0,c.A)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield oe()}),ce},De=new Proxy({},{get(Z,W){switch(W){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return me?Se:je;case"removeListener":return qe;default:return xe(W)}}});return L[z]=De,N.set(z,{name:z,proxy:De,platforms:new Set([...Object.keys(Q),...me?[fe]:[]])}),De},v.Exception=B,v.DEBUG=!!v.DEBUG,v.isLoggingEnabled=!!v.isLoggingEnabled,v},m=(x=>x.Capacitor=p(x))(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),E=m.registerPlugin;class S{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(g,v){var L=this;let I=!1;this.listeners[g]||(this.listeners[g]=[],I=!0),this.listeners[g].push(v);const G=this.windowListeners[g];G&&!G.registered&&this.addWindowListener(G),I&&this.sendRetainedArgumentsForEvent(g);const Y=function(){var N=(0,c.A)(function*(){return L.removeListener(g,v)});return function(){return N.apply(this,arguments)}}();return Promise.resolve({remove:Y})}removeAllListeners(){var g=this;return(0,c.A)(function*(){g.listeners={};for(const v in g.windowListeners)g.removeWindowListener(g.windowListeners[v]);g.windowListeners={}})()}notifyListeners(g,v,L){const I=this.listeners[g];if(I)I.forEach(D=>D(v));else if(L){let D=this.retainedEventArguments[g];D||(D=[]),D.push(v),this.retainedEventArguments[g]=D}}hasListeners(g){return!!this.listeners[g].length}registerWindowListener(g,v){this.windowListeners[v]={registered:!1,windowEventName:g,pluginEventName:v,handler:L=>{this.notifyListeners(v,L)}}}unimplemented(g="not implemented"){return new m.Exception(g,w.Unimplemented)}unavailable(g="not available"){return new m.Exception(g,w.Unavailable)}removeListener(g,v){var L=this;return(0,c.A)(function*(){const I=L.listeners[g];if(!I)return;const D=I.indexOf(v);L.listeners[g].splice(D,1),L.listeners[g].length||L.removeWindowListener(L.windowListeners[g])})()}addWindowListener(g){window.addEventListener(g.windowEventName,g.handler),g.registered=!0}removeWindowListener(g){g&&(window.removeEventListener(g.windowEventName,g.handler),g.registered=!1)}sendRetainedArgumentsForEvent(g){const v=this.retainedEventArguments[g];v&&(delete this.retainedEventArguments[g],v.forEach(L=>{this.notifyListeners(g,L)}))}}const T=x=>encodeURIComponent(x).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),_=x=>x.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class y extends S{getCookies(){return(0,c.A)(function*(){const g=document.cookie,v={};return g.split(";").forEach(L=>{if(L.length<=0)return;let[I,D]=L.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");I=_(I).trim(),D=_(D).trim(),v[I]=D}),v})()}setCookie(g){return(0,c.A)(function*(){try{const v=T(g.key),L=T(g.value),I=`; expires=${(g.expires||"").replace("expires=","")}`,D=(g.path||"/").replace("path=",""),G=null!=g.url&&g.url.length>0?`domain=${g.url}`:"";document.cookie=`${v}=${L||""}${I}; path=${D}; ${G};`}catch(v){return Promise.reject(v)}})()}deleteCookie(g){return(0,c.A)(function*(){try{document.cookie=`${g.key}=; Max-Age=0`}catch(v){return Promise.reject(v)}})()}clearCookies(){return(0,c.A)(function*(){try{const g=document.cookie.split(";")||[];for(const v of g)document.cookie=v.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(g){return Promise.reject(g)}})()}clearAllCookies(){var g=this;return(0,c.A)(function*(){try{yield g.clearCookies()}catch(v){return Promise.reject(v)}})()}}E("CapacitorCookies",{web:()=>new y});const R=function(){var x=(0,c.A)(function*(g){return new Promise((v,L)=>{const I=new FileReader;I.onload=()=>{const D=I.result;v(D.indexOf(",")>=0?D.split(",")[1]:D)},I.onerror=D=>L(D),I.readAsDataURL(g)})});return function(v){return x.apply(this,arguments)}}(),q=(x,g={})=>{const v=Object.assign({method:x.method||"GET",headers:x.headers},g),I=((x={})=>{const g=Object.keys(x);return Object.keys(x).map(I=>I.toLocaleLowerCase()).reduce((I,D,G)=>(I[D]=x[g[G]],I),{})})(x.headers)["content-type"]||"";if("string"==typeof x.data)v.body=x.data;else if(I.includes("application/x-www-form-urlencoded")){const D=new URLSearchParams;for(const[G,Y]of Object.entries(x.data||{}))D.set(G,Y);v.body=D.toString()}else if(I.includes("multipart/form-data")||x.data instanceof FormData){const D=new FormData;if(x.data instanceof FormData)x.data.forEach((Y,ee)=>{D.append(ee,Y)});else for(const Y of Object.keys(x.data))D.append(Y,x.data[Y]);v.body=D;const G=new Headers(v.headers);G.delete("content-type"),v.headers=G}else(I.includes("application/json")||"object"==typeof x.data)&&(v.body=JSON.stringify(x.data));return v};class X extends S{request(g){return(0,c.A)(function*(){const v=q(g,g.webFetchExtra),L=((x,g=!0)=>x?Object.entries(x).reduce((L,I)=>{const[D,G]=I;let Y,ee;return Array.isArray(G)?(ee="",G.forEach(N=>{Y=g?encodeURIComponent(N):N,ee+=`${D}=${Y}&`}),ee.slice(0,-1)):(Y=g?encodeURIComponent(G):G,ee=`${D}=${Y}`),`${L}&${ee}`},"").substr(1):null)(g.params,g.shouldEncodeUrlParams),I=L?`${g.url}?${L}`:g.url,D=yield fetch(I,v),G=D.headers.get("content-type")||"";let ee,N,{responseType:Y="text"}=D.ok?g:{};switch(G.includes("application/json")&&(Y="json"),Y){case"arraybuffer":case"blob":N=yield D.blob(),ee=yield R(N);break;case"json":ee=yield D.json();break;default:ee=yield D.text()}const ve={};return D.headers.forEach((z,Q)=>{ve[Q]=z}),{data:ee,headers:ve,status:D.status,url:D.url}})()}get(g){var v=this;return(0,c.A)(function*(){return v.request(Object.assign(Object.assign({},g),{method:"GET"}))})()}post(g){var v=this;return(0,c.A)(function*(){return v.request(Object.assign(Object.assign({},g),{method:"POST"}))})()}put(g){var v=this;return(0,c.A)(function*(){return v.request(Object.assign(Object.assign({},g),{method:"PUT"}))})()}patch(g){var v=this;return(0,c.A)(function*(){return v.request(Object.assign(Object.assign({},g),{method:"PATCH"}))})()}delete(g){var v=this;return(0,c.A)(function*(){return v.request(Object.assign(Object.assign({},g),{method:"DELETE"}))})()}}E("CapacitorHttp",{web:()=>new X})},7691:(V,O,b)=>{"use strict";b.d(O,{i7:()=>E,LK:()=>p,ru:()=>B});var c=b(7464),w=b(467),B=function(S){return S.Prompt="PROMPT",S.Camera="CAMERA",S.Photos="PHOTOS",S}(B||{}),M=function(S){return S.Rear="REAR",S.Front="FRONT",S}(M||{}),p=function(S){return S.Uri="uri",S.Base64="base64",S.DataUrl="dataUrl",S}(p||{});class h extends c.E_{getPhoto(k){var T=this;return(0,w.A)(function*(){return new Promise(function(){var _=(0,w.A)(function*(y,A){if(k.webUseInput||k.source===B.Photos)T.fileInputExperience(k,y,A);else if(k.source===B.Prompt){let R=document.querySelector("pwa-action-sheet");R||(R=document.createElement("pwa-action-sheet"),document.body.appendChild(R)),R.header=k.promptLabelHeader||"Photo",R.cancelable=!1,R.options=[{title:k.promptLabelPhoto||"From Photos"},{title:k.promptLabelPicture||"Take Picture"}],R.addEventListener("onSelection",function(){var U=(0,w.A)(function*(C){0===C.detail?T.fileInputExperience(k,y,A):T.cameraExperience(k,y,A)});return function(C){return U.apply(this,arguments)}}())}else T.cameraExperience(k,y,A)});return function(y,A){return _.apply(this,arguments)}}())})()}pickImages(k){var T=this;return(0,w.A)(function*(){return new Promise(function(){var _=(0,w.A)(function*(y,A){T.multipleFileInputExperience(y,A)});return function(y,A){return _.apply(this,arguments)}}())})()}cameraExperience(k,T,_){var y=this;return(0,w.A)(function*(){if(customElements.get("pwa-camera-modal")){const A=document.createElement("pwa-camera-modal");A.facingMode=k.direction===M.Front?"user":"environment",document.body.appendChild(A);try{yield A.componentOnReady(),A.addEventListener("onPhoto",function(){var R=(0,w.A)(function*(U){const C=U.detail;null===C?_(new c.I9("User cancelled photos app")):C instanceof Error?_(C):T(yield y._getCameraPhoto(C,k)),A.dismiss(),document.body.removeChild(A)});return function(U){return R.apply(this,arguments)}}()),A.present()}catch{y.fileInputExperience(k,T,_)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),y.fileInputExperience(k,T,_)})()}fileInputExperience(k,T,_){let y=document.querySelector("#_capacitor-camera-input");const A=()=>{var R;null===(R=y.parentNode)||void 0===R||R.removeChild(y)};y||(y=document.createElement("input"),y.id="_capacitor-camera-input",y.type="file",y.hidden=!0,document.body.appendChild(y),y.addEventListener("change",R=>{const U=y.files[0];let C="jpeg";if("image/png"===U.type?C="png":"image/gif"===U.type&&(C="gif"),"dataUrl"===k.resultType||"base64"===k.resultType){const q=new FileReader;q.addEventListener("load",()=>{if("dataUrl"===k.resultType)T({dataUrl:q.result,format:C});else if("base64"===k.resultType){const X=q.result.split(",")[1];T({base64String:X,format:C})}A()}),q.readAsDataURL(U)}else T({webPath:URL.createObjectURL(U),format:C}),A()}),y.addEventListener("cancel",R=>{_(new c.I9("User cancelled photos app")),A()})),y.accept="image/*",y.capture=!0,k.source===B.Photos||k.source===B.Prompt?y.removeAttribute("capture"):k.direction===M.Front?y.capture="user":k.direction===M.Rear&&(y.capture="environment"),y.click()}multipleFileInputExperience(k,T){let _=document.querySelector("#_capacitor-camera-input-multiple");const y=()=>{var A;null===(A=_.parentNode)||void 0===A||A.removeChild(_)};_||(_=document.createElement("input"),_.id="_capacitor-camera-input-multiple",_.type="file",_.hidden=!0,_.multiple=!0,document.body.appendChild(_),_.addEventListener("change",A=>{const R=[];for(let U=0;U<_.files.length;U++){const C=_.files[U];let q="jpeg";"image/png"===C.type?q="png":"image/gif"===C.type&&(q="gif"),R.push({webPath:URL.createObjectURL(C),format:q})}k({photos:R}),y()}),_.addEventListener("cancel",A=>{T(new c.I9("User cancelled photos app")),y()})),_.accept="image/*",_.click()}_getCameraPhoto(k,T){return new Promise((_,y)=>{const A=new FileReader,R=k.type.split("/")[1];"uri"===T.resultType?_({webPath:URL.createObjectURL(k),format:R,saved:!1}):(A.readAsDataURL(k),A.onloadend=()=>{const U=A.result;_("dataUrl"===T.resultType?{dataUrl:U,format:R,saved:!1}:{base64String:U.split(",")[1],format:R,saved:!1})},A.onerror=U=>{y(U)})})}checkPermissions(){var k=this;return(0,w.A)(function*(){if(typeof navigator>"u"||!navigator.permissions)throw k.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw k.unavailable("Camera permissions are not available in this browser")}})()}requestPermissions(){var k=this;return(0,w.A)(function*(){throw k.unimplemented("Not implemented on web.")})()}pickLimitedLibraryPhotos(){var k=this;return(0,w.A)(function*(){throw k.unavailable("Not implemented on web.")})()}getLimitedLibraryPhotos(){var k=this;return(0,w.A)(function*(){throw k.unavailable("Not implemented on web.")})()}}new h;const E=(0,c.F3)("Camera",{web:()=>new h})},8666:function(V,O,b){"use strict";var c=this&&this.__importDefault||function(M){return M&&M.__esModule?M:{default:M}};Object.defineProperty(O,"__esModule",{value:!0});const w=c(b(3608));O.default=class B{constructor(p,{headers:h={},schema:m,fetch:E}){this.url=p,this.headers=h,this.schema=m,this.fetch=E}select(p,{head:h=!1,count:m}={}){const E=h?"HEAD":"GET";let S=!1;const k=(null!=p?p:"*").split("").map(T=>/\s/.test(T)&&!S?"":('"'===T&&(S=!S),T)).join("");return this.url.searchParams.set("select",k),m&&(this.headers.Prefer=`count=${m}`),new w.default({method:E,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(p,{count:h,defaultToNull:m=!0}={}){const S=[];if(this.headers.Prefer&&S.push(this.headers.Prefer),h&&S.push(`count=${h}`),m||S.push("missing=default"),this.headers.Prefer=S.join(","),Array.isArray(p)){const k=p.reduce((T,_)=>T.concat(Object.keys(_)),[]);if(k.length>0){const T=[...new Set(k)].map(_=>`"${_}"`);this.url.searchParams.set("columns",T.join(","))}}return new w.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:p,fetch:this.fetch,allowEmpty:!1})}upsert(p,{onConflict:h,ignoreDuplicates:m=!1,count:E,defaultToNull:S=!0}={}){const T=[`resolution=${m?"ignore":"merge"}-duplicates`];if(void 0!==h&&this.url.searchParams.set("on_conflict",h),this.headers.Prefer&&T.push(this.headers.Prefer),E&&T.push(`count=${E}`),S||T.push("missing=default"),this.headers.Prefer=T.join(","),Array.isArray(p)){const _=p.reduce((y,A)=>y.concat(Object.keys(A)),[]);if(_.length>0){const y=[...new Set(_)].map(A=>`"${A}"`);this.url.searchParams.set("columns",y.join(","))}}return new w.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:p,fetch:this.fetch,allowEmpty:!1})}update(p,{count:h}={}){const E=[];return this.headers.Prefer&&E.push(this.headers.Prefer),h&&E.push(`count=${h}`),this.headers.Prefer=E.join(","),new w.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:p,fetch:this.fetch,allowEmpty:!1})}delete({count:p}={}){const m=[];return p&&m.push(`count=${p}`),this.headers.Prefer&&m.unshift(this.headers.Prefer),this.headers.Prefer=m.join(","),new w.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}},8761:(V,O,b)=>{"use strict";b.d(O,{W:()=>pn});var c=b(467);class B extends Error{constructor(r,e="FunctionsError",t){super(r),this.name=e,this.context=t}}class M extends B{constructor(r){super("Failed to send a request to the Edge Function","FunctionsFetchError",r)}}class p extends B{constructor(r){super("Relay Error invoking the Edge Function","FunctionsRelayError",r)}}class h extends B{constructor(r){super("Edge Function returned a non-2xx status code","FunctionsHttpError",r)}}var m=function(s){return s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2",s}(m||{});class S{constructor(r,{headers:e={},customFetch:t,region:n=m.Any}={}){this.url=r,this.headers=e,this.region=n,this.fetch=(s=>{let r;return r=s||(typeof fetch>"u"?(...e)=>Promise.resolve().then(b.bind(b,5286)).then(({default:t})=>t(...e)):fetch),(...e)=>r(...e)})(t)}setAuth(r){this.headers.Authorization=`Bearer ${r}`}invoke(r,e={}){var t;return function(s,r,e,t){return new(e||(e=Promise))(function(i,o){function a(u){try{d(t.next(u))}catch(f){o(f)}}function l(u){try{d(t.throw(u))}catch(f){o(f)}}function d(u){u.done?i(u.value):function n(i){return i instanceof e?i:new e(function(o){o(i)})}(u.value).then(a,l)}d((t=t.apply(s,r||[])).next())})}(this,void 0,void 0,function*(){try{const{headers:n,method:i,body:o}=e;let d,a={},{region:l}=e;l||(l=this.region),l&&"any"!==l&&(a["x-region"]=l),o&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",d=o):"string"==typeof o?(a["Content-Type"]="text/plain",d=o):typeof FormData<"u"&&o instanceof FormData?d=o:(a["Content-Type"]="application/json",d=JSON.stringify(o)));const u=yield this.fetch(`${this.url}/${r}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),n),body:d}).catch($=>{throw new M($)}),f=u.headers.get("x-relay-error");if(f&&"true"===f)throw new p(u);if(!u.ok)throw new h(u);let j,P=(null!==(t=u.headers.get("Content-Type"))&&void 0!==t?t:"text/plain").split(";")[0].trim();return j="application/json"===P?yield u.json():"application/octet-stream"===P?yield u.blob():"text/event-stream"===P?u:"multipart/form-data"===P?yield u.formData():yield u.text(),{data:j,error:null}}catch(n){return{data:null,error:n}}})}}var k=b(4060);const{PostgrestClient:T}=k,X={"X-Client-Info":"realtime-js/2.11.2"};var v=function(s){return s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed",s}(v||{}),L=function(s){return s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving",s}(L||{}),I=function(s){return s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token",s}(I||{}),D=function(s){return s.websocket="websocket",s}(D||{}),G=function(s){return s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed",s}(G||{});class Y{constructor(){this.HEADER_LENGTH=1}decode(r,e){return r.constructor===ArrayBuffer?e(this._binaryDecode(r)):e("string"==typeof r?JSON.parse(r):{})}_binaryDecode(r){const e=new DataView(r),t=new TextDecoder;return this._decodeBroadcast(r,e,t)}_decodeBroadcast(r,e,t){const n=e.getUint8(1),i=e.getUint8(2);let o=this.HEADER_LENGTH+2;const a=t.decode(r.slice(o,o+n));o+=n;const l=t.decode(r.slice(o,o+i));return o+=i,{ref:null,topic:a,event:l,payload:JSON.parse(t.decode(r.slice(o,r.byteLength)))}}}class ee{constructor(r,e){this.callback=r,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=r,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var N=function(s){return s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange",s}(N||{});const ve=(s,r,e={})=>{var t;const n=null!==(t=e.skipTypes)&&void 0!==t?t:[];return Object.keys(r).reduce((i,o)=>(i[o]=z(o,s,r,n),i),{})},z=(s,r,e,t)=>{const n=r.find(a=>a.name===s),i=null==n?void 0:n.type,o=e[s];return i&&!t.includes(i)?Q(i,o):ye(o)},Q=(s,r)=>{if("_"===s.charAt(0)){const e=s.slice(1,s.length);return Xe(r,e)}switch(s){case N.bool:return fe(r);case N.float4:case N.float8:case N.int2:case N.int4:case N.int8:case N.numeric:case N.oid:return me(r);case N.json:case N.jsonb:return ae(r);case N.timestamp:return Ye(r);default:return ye(r)}},ye=s=>s,fe=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},me=s=>{if("string"==typeof s){const r=parseFloat(s);if(!Number.isNaN(r))return r}return s},ae=s=>{if("string"==typeof s)try{return JSON.parse(s)}catch(r){return console.log(`JSON parse error: ${r}`),s}return s},Xe=(s,r)=>{if("string"!=typeof s)return s;const e=s.length-1;if("{"===s[0]&&"}"===s[e]){let i;const o=s.slice(1,e);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>Q(r,a))}return s},Ye=s=>"string"==typeof s?s.replace(" ","T"):s,xe=s=>{let r=s;return r=r.replace(/^ws/i,"http"),r=r.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),r.replace(/\/+$/,"")};class je{constructor(r,e,t={},n=1e4){this.channel=r,this.event=e,this.payload=t,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(r){this.timeout=r,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(r){this.payload=Object.assign(Object.assign({},this.payload),r)}receive(r,e){var t;return this._hasReceived(r)&&e(null===(t=this.receivedResp)||void 0===t?void 0:t.response),this.recHooks.push({status:r,callback:e}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref),this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout))}trigger(r,e){this.refEvent&&this.channel._trigger(this.refEvent,{status:r,response:e})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:r,response:e}){this.recHooks.filter(t=>t.status===r).forEach(t=>t.callback(e))}_hasReceived(r){return this.receivedResp&&this.receivedResp.status===r}}class Se{constructor(r,e){this.channel=r,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const t=(null==e?void 0:e.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(t.state,{},n=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Se.syncState(this.state,n,i,o),this.pendingDiffs.forEach(l=>{this.state=Se.syncDiff(this.state,l,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(t.diff,{},n=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=Se.syncDiff(this.state,n,i,o),a())}),this.onJoin((n,i,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:o})}),this.onLeave((n,i,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(r,e,t,n){const i=this.cloneDeep(r),o=this.transformState(e),a={},l={};return this.map(i,(d,u)=>{o[d]||(l[d]=u)}),this.map(o,(d,u)=>{const f=i[d];if(f){const P=u.map(K=>K.presence_ref),j=f.map(K=>K.presence_ref),$=u.filter(K=>j.indexOf(K.presence_ref)<0),H=f.filter(K=>P.indexOf(K.presence_ref)<0);$.length>0&&(a[d]=$),H.length>0&&(l[d]=H)}else a[d]=u}),this.syncDiff(i,{joins:a,leaves:l},t,n)}static syncDiff(r,e,t,n){const{joins:i,leaves:o}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return t||(t=()=>{}),n||(n=()=>{}),this.map(i,(a,l)=>{var d;const u=null!==(d=r[a])&&void 0!==d?d:[];if(r[a]=this.cloneDeep(l),u.length>0){const f=r[a].map(j=>j.presence_ref),P=u.filter(j=>f.indexOf(j.presence_ref)<0);r[a].unshift(...P)}t(a,u,l)}),this.map(o,(a,l)=>{let d=r[a];if(!d)return;const u=l.map(f=>f.presence_ref);d=d.filter(f=>u.indexOf(f.presence_ref)<0),r[a]=d,n(a,d,l),0===d.length&&delete r[a]}),r}static map(r,e){return Object.getOwnPropertyNames(r).map(t=>e(t,r[t]))}static transformState(r){return r=this.cloneDeep(r),Object.getOwnPropertyNames(r).reduce((e,t)=>{const n=r[t];return e[t]="metas"in n?n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):n,e},{})}static cloneDeep(r){return JSON.parse(JSON.stringify(r))}onJoin(r){this.caller.onJoin=r}onLeave(r){this.caller.onLeave=r}onSync(r){this.caller.onSync=r}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var W=function(s){return s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR",s}(W||{});class oe{constructor(r,e={config:{}},t){this.topic=r,this.params=e,this.socket=t,this.bindings={},this.state=L.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=r.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},e.config),this.timeout=this.socket.timeout,this.joinPush=new je(this,I.join,this.params,this.timeout),this.rejoinTimer=new ee(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=L.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=L.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=L.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=L.errored,this.rejoinTimer.scheduleTimeout())}),this._on(I.reply,{},(n,i)=>{this._trigger(this._replyEventName(i),n)}),this.presence=new Se(this),this.broadcastEndpointURL=xe(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(r,e=this.timeout){var n,i,t=this;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:o,presence:a,private:l}}=this.params;this._onError(f=>null==r?void 0:r(W.CHANNEL_ERROR,f)),this._onClose(()=>null==r?void 0:r(W.CLOSED));const d={},u={broadcast:o,presence:a,postgres_changes:null!==(i=null===(n=this.bindings.postgres_changes)||void 0===n?void 0:n.map(f=>f.filter))&&void 0!==i?i:[],private:l};this.socket.accessTokenValue&&(d.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:u},d)),this.joinedOnce=!0,this._rejoin(e),this.joinPush.receive("ok",function(){var f=(0,c.A)(function*({postgres_changes:P}){var j;if(t.socket.setAuth(),void 0!==P){const $=t.bindings.postgres_changes,H=null!==(j=null==$?void 0:$.length)&&void 0!==j?j:0,K=[];for(let se=0;se<H;se++){const ue=$[se],{filter:{event:ge,schema:he,table:_e,filter:Qe}}=ue,Le=P&&P[se];if(!Le||Le.event!==ge||Le.schema!==he||Le.table!==_e||Le.filter!==Qe)return t.unsubscribe(),void(null==r||r(W.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));K.push(Object.assign(Object.assign({},ue),{id:Le.id}))}return t.bindings.postgres_changes=K,void(r&&r(W.SUBSCRIBED))}null==r||r(W.SUBSCRIBED)});return function(P){return f.apply(this,arguments)}}()).receive("error",f=>{null==r||r(W.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{null==r||r(W.TIMED_OUT)})}return this}presenceState(){return this.presence.state}track(r,e={}){var t=this;return(0,c.A)(function*(){return yield t.send({type:"presence",event:"track",payload:r},e.timeout||t.timeout)})()}untrack(r={}){var e=this;return(0,c.A)(function*(){return yield e.send({type:"presence",event:"untrack"},r)})()}on(r,e,t){return this._on(r,e,t)}send(r,e={}){var t=this;return(0,c.A)(function*(){var n,i;if(t._canPush()||"broadcast"!==r.type)return new Promise(o=>{var a,l,d;const u=t._push(r.type,r,e.timeout||t.timeout);"broadcast"===r.type&&!(null!==(d=null===(l=null===(a=t.params)||void 0===a?void 0:a.config)||void 0===l?void 0:l.broadcast)&&void 0!==d&&d.ack)&&o("ok"),u.receive("ok",()=>o("ok")),u.receive("error",()=>o("error")),u.receive("timeout",()=>o("timed out"))});{const{event:o,payload:a}=r,d={method:"POST",headers:{Authorization:t.socket.accessTokenValue?`Bearer ${t.socket.accessTokenValue}`:"",apikey:t.socket.apiKey?t.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:t.subTopic,event:o,payload:a,private:t.private}]})};try{const u=yield t._fetchWithTimeout(t.broadcastEndpointURL,d,null!==(n=e.timeout)&&void 0!==n?n:t.timeout);return yield null===(i=u.body)||void 0===i?void 0:i.cancel(),u.ok?"ok":"error"}catch(u){return"AbortError"===u.name?"timed out":"error"}}})()}updateJoinPayload(r){this.joinPush.updatePayload(r)}unsubscribe(r=this.timeout){this.state=L.leaving;const e=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(I.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(t=>{const n=new je(this,I.leave,{},r);n.receive("ok",()=>{e(),t("ok")}).receive("timeout",()=>{e(),t("timed out")}).receive("error",()=>{t("error")}),n.send(),this._canPush()||n.trigger("ok",{})})}_fetchWithTimeout(r,e,t){var n=this;return(0,c.A)(function*(){const i=new AbortController,o=setTimeout(()=>i.abort(),t),a=yield n.socket.fetch(r,Object.assign(Object.assign({},e),{signal:i.signal}));return clearTimeout(o),a})()}_push(r,e,t=this.timeout){if(!this.joinedOnce)throw`tried to push '${r}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new je(this,r,e,t);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(r,e,t){return e}_isMember(r){return this.topic===r}_joinRef(){return this.joinPush.ref}_trigger(r,e,t){var n,i;const o=r.toLocaleLowerCase(),{close:a,error:l,leave:d,join:u}=I;if(t&&[a,l,d,u].indexOf(o)>=0&&t!==this._joinRef())return;let P=this._onMessage(o,e,t);if(e&&!P)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?null===(n=this.bindings.postgres_changes)||void 0===n||n.filter(j=>{var $,H,K;return"*"===(null===($=j.filter)||void 0===$?void 0:$.event)||(null===(K=null===(H=j.filter)||void 0===H?void 0:H.event)||void 0===K?void 0:K.toLocaleLowerCase())===o}).map(j=>j.callback(P,t)):null===(i=this.bindings[o])||void 0===i||i.filter(j=>{var $,H,K,se,ue,ge;if(["broadcast","presence","postgres_changes"].includes(o)){if("id"in j){const he=j.id,_e=null===($=j.filter)||void 0===$?void 0:$.event;return he&&(null===(H=e.ids)||void 0===H?void 0:H.includes(he))&&("*"===_e||(null==_e?void 0:_e.toLocaleLowerCase())===(null===(K=e.data)||void 0===K?void 0:K.type.toLocaleLowerCase()))}{const he=null===(ue=null===(se=null==j?void 0:j.filter)||void 0===se?void 0:se.event)||void 0===ue?void 0:ue.toLocaleLowerCase();return"*"===he||he===(null===(ge=null==e?void 0:e.event)||void 0===ge?void 0:ge.toLocaleLowerCase())}}return j.type.toLocaleLowerCase()===o}).map(j=>{if("object"==typeof P&&"ids"in P){const $=P.data,{schema:H,table:K,commit_timestamp:se,type:ue,errors:ge}=$;P=Object.assign(Object.assign({},{schema:H,table:K,commit_timestamp:se,eventType:ue,new:{},old:{},errors:ge}),this._getPayloadRecords($))}j.callback(P,t)})}_isClosed(){return this.state===L.closed}_isJoined(){return this.state===L.joined}_isJoining(){return this.state===L.joining}_isLeaving(){return this.state===L.leaving}_replyEventName(r){return`chan_reply_${r}`}_on(r,e,t){const n=r.toLocaleLowerCase(),i={type:n,filter:e,callback:t};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(r,e){const t=r.toLocaleLowerCase();return this.bindings[t]=this.bindings[t].filter(n=>{var i;return!((null===(i=n.type)||void 0===i?void 0:i.toLocaleLowerCase())===t&&oe.isEqual(n.filter,e))}),this}static isEqual(r,e){if(Object.keys(r).length!==Object.keys(e).length)return!1;for(const t in r)if(r[t]!==e[t])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(r){this._on(I.close,{},r)}_onError(r){this._on(I.error,{},e=>r(e))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(r=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=L.joining,this.joinPush.resend(r))}_getPayloadRecords(r){const e={new:{},old:{}};return("INSERT"===r.type||"UPDATE"===r.type)&&(e.new=ve(r.columns,r.record)),("UPDATE"===r.type||"DELETE"===r.type)&&(e.old=ve(r.columns,r.old_record)),e}}const ce=()=>{},ie=typeof WebSocket<"u";class Ce{constructor(r,e){var n,t=this;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=X,this.params={},this.timeout=1e4,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=ce,this.conn=null,this.sendBuffer=[],this.serializer=new Y,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=o=>{let a;return a=o||(typeof fetch>"u"?(...l)=>Promise.resolve().then(b.bind(b,5286)).then(({default:d})=>d(...l)):fetch),(...l)=>a(...l)},this.endPoint=`${r}/${D.websocket}`,this.httpEndpoint=xe(r),this.transport=null!=e&&e.transport?e.transport:null,null!=e&&e.params&&(this.params=e.params),null!=e&&e.headers&&(this.headers=Object.assign(Object.assign({},this.headers),e.headers)),null!=e&&e.timeout&&(this.timeout=e.timeout),null!=e&&e.logger&&(this.logger=e.logger),null!=e&&e.heartbeatIntervalMs&&(this.heartbeatIntervalMs=e.heartbeatIntervalMs);const i=null===(n=null==e?void 0:e.params)||void 0===n?void 0:n.apikey;if(i&&(this.accessTokenValue=i,this.apiKey=i),this.reconnectAfterMs=null!=e&&e.reconnectAfterMs?e.reconnectAfterMs:o=>[1e3,2e3,5e3,1e4][o-1]||1e4,this.encode=null!=e&&e.encode?e.encode:(o,a)=>a(JSON.stringify(o)),this.decode=null!=e&&e.decode?e.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new ee((0,c.A)(function*(){t.disconnect(),t.connect()}),this.reconnectAfterMs),this.fetch=this._resolveFetch(null==e?void 0:e.fetch),null!=e&&e.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(null==e?void 0:e.worker)||!1,this.workerUrl=null==e?void 0:e.workerUrl}this.accessToken=(null==e?void 0:e.accessToken)||null}connect(){if(!this.conn){if(this.transport)return void(this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers}));if(ie)return this.conn=new WebSocket(this.endpointURL()),void this.setupConnection();this.conn=new Ht(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),b.e(8).then(b.t.bind(b,8,23)).then(({default:r})=>{this.conn=new r(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(r,e){this.conn&&(this.conn.onclose=function(){},r?this.conn.close(r,null!=e?e:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}removeChannel(r){var e=this;return(0,c.A)(function*(){const t=yield r.unsubscribe();return 0===e.channels.length&&e.disconnect(),t})()}removeAllChannels(){var r=this;return(0,c.A)(function*(){const e=yield Promise.all(r.channels.map(t=>t.unsubscribe()));return r.disconnect(),e})()}log(r,e,t){this.logger(r,e,t)}connectionState(){switch(this.conn&&this.conn.readyState){case v.connecting:return G.Connecting;case v.open:return G.Open;case v.closing:return G.Closing;default:return G.Closed}}isConnected(){return this.connectionState()===G.Open}channel(r,e={config:{}}){const t=new oe(`realtime:${r}`,e,this);return this.channels.push(t),t}push(r){const{topic:e,event:t,payload:n,ref:i}=r,o=()=>{this.encode(r,a=>{var l;null===(l=this.conn)||void 0===l||l.send(a)})};this.log("push",`${e} ${t} (${i})`,n),this.isConnected()?o():this.sendBuffer.push(o)}setAuth(r=null){var e=this;return(0,c.A)(function*(){let t=r||e.accessToken&&(yield e.accessToken())||e.accessTokenValue;if(t){let n=null;try{n=JSON.parse(atob(t.split(".")[1]))}catch{}if(n&&n.exp&&!(Math.floor(Date.now()/1e3)-n.exp<0))return e.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${n.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${n.exp}`);e.accessTokenValue=t,e.channels.forEach(i=>{t&&i.updateJoinPayload({access_token:t}),i.joinedOnce&&i._isJoined()&&i._push(I.access_token,{access_token:t})})}})()}sendHeartbeat(){var r=this;return(0,c.A)(function*(){var e;if(r.isConnected()){if(r.pendingHeartbeatRef)return r.pendingHeartbeatRef=null,r.log("transport","heartbeat timeout. Attempting to re-establish connection"),void(null===(e=r.conn)||void 0===e||e.close(1e3,"hearbeat timeout"));r.pendingHeartbeatRef=r._makeRef(),r.push({topic:"phoenix",event:"heartbeat",payload:{},ref:r.pendingHeartbeatRef}),r.setAuth()}})()}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(r=>r()),this.sendBuffer=[])}_makeRef(){let r=this.ref+1;return this.ref=r===this.ref?0:r,this.ref.toString()}_leaveOpenTopic(r){let e=this.channels.find(t=>t.topic===r&&(t._isJoined()||t._isJoining()));e&&(this.log("transport",`leaving duplicate topic "${r}"`),e.unsubscribe())}_remove(r){this.channels=this.channels.filter(e=>e._joinRef()!==r._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=r=>this._onConnError(r),this.conn.onmessage=r=>this._onConnMessage(r),this.conn.onclose=r=>this._onConnClose(r))}_onConnMessage(r){this.decode(r.data,e=>{let{topic:t,event:n,payload:i,ref:o}=e;o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${t} ${n} ${o&&"("+o+")"||""}`,i),this.channels.filter(a=>a._isMember(t)).forEach(a=>a._trigger(n,i,o)),this.stateChangeCallbacks.message.forEach(a=>a(e))})}_onConnOpen(){var r=this;return(0,c.A)(function*(){if(r.log("transport",`connected to ${r.endpointURL()}`),r.flushSendBuffer(),r.reconnectTimer.reset(),r.worker){r.log("worker",r.workerUrl?`starting worker for from ${r.workerUrl}`:"starting default worker");const e=r._workerObjectUrl(r.workerUrl);r.workerRef=new Worker(e),r.workerRef.onerror=t=>{r.log("worker","worker error",t.message),r.workerRef.terminate()},r.workerRef.onmessage=t=>{"keepAlive"===t.data.event&&r.sendHeartbeat()},r.workerRef.postMessage({event:"start",interval:r.heartbeatIntervalMs})}else r.heartbeatTimer&&clearInterval(r.heartbeatTimer),r.heartbeatTimer=setInterval(()=>r.sendHeartbeat(),r.heartbeatIntervalMs);r.stateChangeCallbacks.open.forEach(e=>e())})()}_onConnClose(r){this.log("transport","close",r),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(e=>e(r))}_onConnError(r){this.log("transport",r.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(e=>e(r))}_triggerChanError(){this.channels.forEach(r=>r._trigger(I.error))}_appendParams(r,e){if(0===Object.keys(e).length)return r;const t=r.match(/\?/)?"&":"?";return`${r}${t}${new URLSearchParams(e)}`}_workerObjectUrl(r){let e;if(r)e=r;else{const t=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});e=URL.createObjectURL(t)}return e}}class Ht{constructor(r,e,t){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=v.connecting,this.send=()=>{},this.url=null,this.url=r,this.close=t.close}}class Ze extends Error{constructor(r){super(r),this.__isStorageError=!0,this.name="StorageError"}}function te(s){return"object"==typeof s&&null!==s&&"__isStorageError"in s}class Gt extends Ze{constructor(r,e){super(r),this.name="StorageApiError",this.status=e}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class et extends Ze{constructor(r,e){super(r),this.name="StorageUnknownError",this.originalError=e}}const wt=s=>{let r;return r=s||(typeof fetch>"u"?(...e)=>Promise.resolve().then(b.bind(b,5286)).then(({default:t})=>t(...e)):fetch),(...e)=>r(...e)},tt=s=>{if(Array.isArray(s))return s.map(e=>tt(e));if("function"==typeof s||s!==Object(s))return s;const r={};return Object.entries(s).forEach(([e,t])=>{const n=e.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));r[n]=tt(t)}),r};var Pe=function(s,r,e,t){return new(e||(e=Promise))(function(i,o){function a(u){try{d(t.next(u))}catch(f){o(f)}}function l(u){try{d(t.throw(u))}catch(f){o(f)}}function d(u){u.done?i(u.value):function n(i){return i instanceof e?i:new e(function(o){o(i)})}(u.value).then(a,l)}d((t=t.apply(s,r||[])).next())})};const rt=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),Vt=(s,r,e)=>Pe(void 0,void 0,void 0,function*(){const t=yield function(s,r,e,t){return new(e||(e=Promise))(function(i,o){function a(u){try{d(t.next(u))}catch(f){o(f)}}function l(u){try{d(t.throw(u))}catch(f){o(f)}}function d(u){u.done?i(u.value):function n(i){return i instanceof e?i:new e(function(o){o(i)})}(u.value).then(a,l)}d((t=t.apply(s,r||[])).next())})}(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Promise.resolve().then(b.bind(b,5286))).Response:Response});s instanceof t&&(null==e||!e.noResolveJson)?s.json().then(n=>{r(new Gt(rt(n),s.status||500))}).catch(n=>{r(new et(rt(n),n))}):r(new et(rt(s),s))});function Be(s,r,e,t,n,i){return Pe(this,void 0,void 0,function*(){return new Promise((o,a)=>{s(e,((s,r,e,t)=>{const n={method:s,headers:(null==r?void 0:r.headers)||{}};return"GET"===s?n:(n.headers=Object.assign({"Content-Type":"application/json"},null==r?void 0:r.headers),t&&(n.body=JSON.stringify(t)),Object.assign(Object.assign({},n),e))})(r,t,n,i)).then(l=>{if(!l.ok)throw l;return null!=t&&t.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>Vt(l,a,t))})})}function Je(s,r,e,t){return Pe(this,void 0,void 0,function*(){return Be(s,"GET",r,e,t)})}function be(s,r,e,t,n){return Pe(this,void 0,void 0,function*(){return Be(s,"POST",r,t,n,e)})}function Xt(s,r,e,t,n){return Pe(this,void 0,void 0,function*(){return Be(s,"PUT",r,t,n,e)})}function At(s,r,e,t,n){return Pe(this,void 0,void 0,function*(){return Be(s,"DELETE",r,t,n,e)})}var ne=function(s,r,e,t){return new(e||(e=Promise))(function(i,o){function a(u){try{d(t.next(u))}catch(f){o(f)}}function l(u){try{d(t.throw(u))}catch(f){o(f)}}function d(u){u.done?i(u.value):function n(i){return i instanceof e?i:new e(function(o){o(i)})}(u.value).then(a,l)}d((t=t.apply(s,r||[])).next())})};const Zt={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},kt={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class er{constructor(r,e={},t,n){this.url=r,this.headers=e,this.bucketId=t,this.fetch=wt(n)}uploadOrUpdate(r,e,t,n){return ne(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},kt),n);let a=Object.assign(Object.assign({},this.headers),"POST"===r&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&t instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",this.encodeMetadata(l)),i.append("",t)):typeof FormData<"u"&&t instanceof FormData?(i=t,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",this.encodeMetadata(l))):(i=t,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),null!=n&&n.headers&&(a=Object.assign(Object.assign({},a),n.headers));const d=this._removeEmptyFolders(e),u=this._getFinalPath(d),f=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:r,body:i,headers:a},null!=o&&o.duplex?{duplex:o.duplex}:{})),P=yield f.json();return f.ok?{data:{path:d,id:P.Id,fullPath:P.Key},error:null}:{data:null,error:P}}catch(i){if(te(i))return{data:null,error:i};throw i}})}upload(r,e,t){return ne(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",r,e,t)})}uploadToSignedUrl(r,e,t,n){return ne(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(r),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",e);try{let l;const d=Object.assign({upsert:kt.upsert},n),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&t instanceof Blob?(l=new FormData,l.append("cacheControl",d.cacheControl),l.append("",t)):typeof FormData<"u"&&t instanceof FormData?(l=t,l.append("cacheControl",d.cacheControl)):(l=t,u["cache-control"]=`max-age=${d.cacheControl}`,u["content-type"]=d.contentType);const f=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:u}),P=yield f.json();return f.ok?{data:{path:i,fullPath:P.Key},error:null}:{data:null,error:P}}catch(l){if(te(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(r,e){return ne(this,void 0,void 0,function*(){try{let t=this._getFinalPath(r);const n=Object.assign({},this.headers);null!=e&&e.upsert&&(n["x-upsert"]="true");const i=yield be(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:n}),o=new URL(this.url+i.url),a=o.searchParams.get("token");if(!a)throw new Ze("No token returned by API");return{data:{signedUrl:o.toString(),path:r,token:a},error:null}}catch(t){if(te(t))return{data:null,error:t};throw t}})}update(r,e,t){return ne(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",r,e,t)})}move(r,e,t){return ne(this,void 0,void 0,function*(){try{return{data:yield be(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:r,destinationKey:e,destinationBucket:null==t?void 0:t.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(te(n))return{data:null,error:n};throw n}})}copy(r,e,t){return ne(this,void 0,void 0,function*(){try{return{data:{path:(yield be(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:r,destinationKey:e,destinationBucket:null==t?void 0:t.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(te(n))return{data:null,error:n};throw n}})}createSignedUrl(r,e,t){return ne(this,void 0,void 0,function*(){try{let n=this._getFinalPath(r),i=yield be(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:e},null!=t&&t.transform?{transform:t.transform}:{}),{headers:this.headers});const o=null!=t&&t.download?`&download=${!0===t.download?"":t.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(n){if(te(n))return{data:null,error:n};throw n}})}createSignedUrls(r,e,t){return ne(this,void 0,void 0,function*(){try{const n=yield be(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:e,paths:r},{headers:this.headers}),i=null!=t&&t.download?`&download=${!0===t.download?"":t.download}`:"";return{data:n.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(n){if(te(n))return{data:null,error:n};throw n}})}download(r,e){return ne(this,void 0,void 0,function*(){const n=typeof(null==e?void 0:e.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((null==e?void 0:e.transform)||{}),o=i?`?${i}`:"";try{const a=this._getFinalPath(r);return{data:yield(yield Je(this.fetch,`${this.url}/${n}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(te(a))return{data:null,error:a};throw a}})}info(r){return ne(this,void 0,void 0,function*(){const e=this._getFinalPath(r);try{const t=yield Je(this.fetch,`${this.url}/object/info/${e}`,{headers:this.headers});return{data:tt(t),error:null}}catch(t){if(te(t))return{data:null,error:t};throw t}})}exists(r){return ne(this,void 0,void 0,function*(){const e=this._getFinalPath(r);try{return yield function Yt(s,r,e,t){return Pe(this,void 0,void 0,function*(){return Be(s,"HEAD",r,Object.assign(Object.assign({},e),{noResolveJson:!0}),t)})}(this.fetch,`${this.url}/object/${e}`,{headers:this.headers}),{data:!0,error:null}}catch(t){if(te(t)&&t instanceof et){const n=t.originalError;if([400,404].includes(null==n?void 0:n.status))return{data:!1,error:t}}throw t}})}getPublicUrl(r,e){const t=this._getFinalPath(r),n=[],i=null!=e&&e.download?`download=${!0===e.download?"":e.download}`:"";""!==i&&n.push(i);const a=typeof(null==e?void 0:e.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((null==e?void 0:e.transform)||{});""!==l&&n.push(l);let d=n.join("&");return""!==d&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${t}${d}`)}}}remove(r){return ne(this,void 0,void 0,function*(){try{return{data:yield At(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:r},{headers:this.headers}),error:null}}catch(e){if(te(e))return{data:null,error:e};throw e}})}list(r,e,t){return ne(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},Zt),e),{prefix:r||""});return{data:yield be(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},t),error:null}}catch(n){if(te(n))return{data:null,error:n};throw n}})}encodeMetadata(r){return JSON.stringify(r)}toBase64(r){return typeof Buffer<"u"?Buffer.from(r).toString("base64"):btoa(r)}_getFinalPath(r){return`${this.bucketId}/${r}`}_removeEmptyFolders(r){return r.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(r){const e=[];return r.width&&e.push(`width=${r.width}`),r.height&&e.push(`height=${r.height}`),r.resize&&e.push(`resize=${r.resize}`),r.format&&e.push(`format=${r.format}`),r.quality&&e.push(`quality=${r.quality}`),e.join("&")}}const tr={"X-Client-Info":"storage-js/2.7.1"};var Re=function(s,r,e,t){return new(e||(e=Promise))(function(i,o){function a(u){try{d(t.next(u))}catch(f){o(f)}}function l(u){try{d(t.throw(u))}catch(f){o(f)}}function d(u){u.done?i(u.value):function n(i){return i instanceof e?i:new e(function(o){o(i)})}(u.value).then(a,l)}d((t=t.apply(s,r||[])).next())})};class rr{constructor(r,e={},t){this.url=r,this.headers=Object.assign(Object.assign({},tr),e),this.fetch=wt(t)}listBuckets(){return Re(this,void 0,void 0,function*(){try{return{data:yield Je(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(r){if(te(r))return{data:null,error:r};throw r}})}getBucket(r){return Re(this,void 0,void 0,function*(){try{return{data:yield Je(this.fetch,`${this.url}/bucket/${r}`,{headers:this.headers}),error:null}}catch(e){if(te(e))return{data:null,error:e};throw e}})}createBucket(r,e={public:!1}){return Re(this,void 0,void 0,function*(){try{return{data:yield be(this.fetch,`${this.url}/bucket`,{id:r,name:r,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(t){if(te(t))return{data:null,error:t};throw t}})}updateBucket(r,e){return Re(this,void 0,void 0,function*(){try{return{data:yield Xt(this.fetch,`${this.url}/bucket/${r}`,{id:r,name:r,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(t){if(te(t))return{data:null,error:t};throw t}})}emptyBucket(r){return Re(this,void 0,void 0,function*(){try{return{data:yield be(this.fetch,`${this.url}/bucket/${r}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(te(e))return{data:null,error:e};throw e}})}deleteBucket(r){return Re(this,void 0,void 0,function*(){try{return{data:yield At(this.fetch,`${this.url}/bucket/${r}`,{},{headers:this.headers}),error:null}}catch(e){if(te(e))return{data:null,error:e};throw e}})}}class nr extends rr{constructor(r,e={},t){super(r,e,t)}from(r){return new er(this.url,this.headers,r,this.fetch)}}let Me="";Me=typeof Deno<"u"?"deno":typeof document<"u"?"web":typeof navigator<"u"&&"ReactNative"===navigator.product?"react-native":"node";const ir={headers:{"X-Client-Info":`supabase-js-${Me}/2.49.8`}},or={schema:"public"},ar={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},lr={};var Et=b(5286);const hr=(s,r,e)=>{const t=(s=>{let r;return r=s||(typeof fetch>"u"?Et.default:fetch),(...e)=>r(...e)})(e),n=typeof Headers>"u"?Et.Headers:Headers;return(i,o)=>function(s,r,e,t){return new(e||(e=Promise))(function(i,o){function a(u){try{d(t.next(u))}catch(f){o(f)}}function l(u){try{d(t.throw(u))}catch(f){o(f)}}function d(u){u.done?i(u.value):function n(i){return i instanceof e?i:new e(function(o){o(i)})}(u.value).then(a,l)}d((t=t.apply(s,r||[])).next())})}(void 0,void 0,void 0,function*(){var a;const l=null!==(a=yield r())&&void 0!==a?a:s;let d=new n(null==o?void 0:o.headers);return d.has("apikey")||d.set("apikey",s),d.has("Authorization")||d.set("Authorization",`Bearer ${l}`),t(i,Object.assign(Object.assign({},o),{headers:d}))})};const $e=3e4,it="X-Supabase-Api-Version",Pt_2024_01_01_timestamp=Date.parse("2024-01-01T00:00:00.0Z"),Pt_2024_01_01_name="2024-01-01",mr=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class ot extends Error{constructor(r,e,t){super(r),this.__isAuthError=!0,this.name="AuthError",this.status=e,this.code=t}}function F(s){return"object"==typeof s&&null!==s&&"__isAuthError"in s}class wr extends ot{constructor(r,e,t){super(r,e,t),this.name="AuthApiError",this.status=e,this.code=t}}class Tt extends ot{constructor(r,e){super(r),this.name="AuthUnknownError",this.originalError=e}}class we extends ot{constructor(r,e,t,n){super(r,t,n),this.name=e,this.status=t}}class Ae extends we{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class at extends we{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ke extends we{constructor(r){super(r,"AuthInvalidCredentialsError",400,void 0)}}class He extends we{constructor(r,e=null){super(r,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ot extends we{constructor(r,e=null){super(r,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class lt extends we{constructor(r,e){super(r,"AuthRetryableFetchError",e,void 0)}}function ut(s){return F(s)&&"AuthRetryableFetchError"===s.name}class xt extends we{constructor(r,e,t){super(r,"AuthWeakPasswordError",e,"weak_password"),this.reasons=t}}class Fe extends we{constructor(r){super(r,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ge="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),jt=" \t\n\r=".split(""),Sr=(()=>{const s=new Array(128);for(let r=0;r<s.length;r+=1)s[r]=-1;for(let r=0;r<jt.length;r+=1)s[jt[r].charCodeAt(0)]=-2;for(let r=0;r<Ge.length;r+=1)s[Ge[r].charCodeAt(0)]=r;return s})();function Rt(s,r,e){const t=Sr[s];if(!(t>-1)){if(-2===t)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(s)}"`)}for(r.queue=r.queue<<6|t,r.queuedBits+=6;r.queuedBits>=8;)e(r.queue>>r.queuedBits-8&255),r.queuedBits-=8}function $t(s){const r=[],e=o=>{r.push(String.fromCodePoint(o))},t={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=o=>{!function Tr(s,r,e){if(0===r.utf8seq){if(s<=127)return void e(s);for(let t=1;t<6;t+=1)if(!(s>>7-t&1)){r.utf8seq=t;break}if(2===r.utf8seq)r.codepoint=31&s;else if(3===r.utf8seq)r.codepoint=15&s;else{if(4!==r.utf8seq)throw new Error("Invalid UTF-8 sequence");r.codepoint=7&s}r.utf8seq-=1}else if(r.utf8seq>0){if(s<=127)throw new Error("Invalid UTF-8 sequence");r.codepoint=r.codepoint<<6|63&s,r.utf8seq-=1,0===r.utf8seq&&e(r.codepoint)}}(o,t,e)};for(let o=0;o<s.length;o+=1)Rt(s.charCodeAt(o),n,i);return r.join("")}function Pr(s,r){if(!(s<=127)){if(s<=2047)return r(192|s>>6),void r(128|63&s);if(s<=65535)return r(224|s>>12),r(128|s>>6&63),void r(128|63&s);if(s<=1114111)return r(240|s>>18),r(128|s>>12&63),r(128|s>>6&63),void r(128|63&s);throw new Error(`Unrecognized Unicode codepoint: ${s.toString(16)}`)}r(s)}function Or(s){const r=[],e={queue:0,queuedBits:0},t=n=>{r.push(n)};for(let n=0;n<s.length;n+=1)Rt(s.charCodeAt(n),e,t);return new Uint8Array(r)}const de=()=>typeof window<"u"&&typeof document<"u",Te={tested:!1,writable:!1},Ne=()=>{if(!de())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch{return!1}if(Te.tested)return Te.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),Te.tested=!0,Te.writable=!0}catch{Te.tested=!0,Te.writable=!1}return Te.writable},It=s=>{let r;return r=s||(typeof fetch>"u"?(...e)=>Promise.resolve().then(b.bind(b,5286)).then(({default:t})=>t(...e)):fetch),(...e)=>r(...e)},Lt=function(){var s=(0,c.A)(function*(r,e,t){yield r.setItem(e,JSON.stringify(t))});return function(e,t,n){return s.apply(this,arguments)}}(),We=function(){var s=(0,c.A)(function*(r,e){const t=yield r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}});return function(e,t){return s.apply(this,arguments)}}(),ze=function(){var s=(0,c.A)(function*(r,e){yield r.removeItem(e)});return function(e,t){return s.apply(this,arguments)}}();class Ve{constructor(){this.promise=new Ve.promiseConstructor((r,e)=>{this.resolve=r,this.reject=e})}}function ct(s){const r=s.split(".");if(3!==r.length)throw new Fe("Invalid JWT structure");for(let t=0;t<r.length;t++)if(!mr.test(r[t]))throw new Fe("JWT not in base64url format");return{header:JSON.parse($t(r[0])),payload:JSON.parse($t(r[1])),signature:Or(r[2]),raw:{header:r[0],payload:r[1]}}}function dt(){return(dt=(0,c.A)(function*(s){return yield new Promise(r=>{setTimeout(()=>r(null),s)})})).apply(this,arguments)}function Lr(s){return("0"+s.toString(16)).substr(-2)}function ht(){return(ht=(0,c.A)(function*(s){const e=(new TextEncoder).encode(s),t=yield crypto.subtle.digest("SHA-256",e),n=new Uint8Array(t);return Array.from(n).map(i=>String.fromCharCode(i)).join("")})).apply(this,arguments)}function ft(){return ft=(0,c.A)(function*(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const e=yield function Br(s){return ht.apply(this,arguments)}(s);return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}),ft.apply(this,arguments)}function Ue(s,r){return pt.apply(this,arguments)}function pt(){return pt=(0,c.A)(function*(s,r,e=!1){const t=function Dr(){const r=new Uint32Array(56);if(typeof crypto>"u"){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let n="";for(let i=0;i<56;i++)n+=e.charAt(Math.floor(Math.random()*t));return n}return crypto.getRandomValues(r),Array.from(r,Lr).join("")}();let n=t;e&&(n+="/PASSWORD_RECOVERY"),yield Lt(s,`${r}-code-verifier`,n);const i=yield function Mr(s){return ft.apply(this,arguments)}(t);return[i,t===i?"plain":"s256"]}),pt.apply(this,arguments)}Ve.promiseConstructor=Promise;const Fr=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i,Oe=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),Hr=[502,503,504];function Dt(s){return gt.apply(this,arguments)}function gt(){return(gt=(0,c.A)(function*(s){var r;if(!(s=>"object"==typeof s&&null!==s&&"status"in s&&"ok"in s&&"json"in s&&"function"==typeof s.json)(s))throw new lt(Oe(s),0);if(Hr.includes(s.status))throw new lt(Oe(s),s.status);let e,t;try{e=yield s.json()}catch(i){throw new Tt(Oe(i),i)}const n=function Nr(s){const r=s.headers.get(it);if(!r||!r.match(Fr))return null;try{return new Date(`${r}T00:00:00.0Z`)}catch{return null}}(s);if(n&&n.getTime()>=Pt_2024_01_01_timestamp&&"object"==typeof e&&e&&"string"==typeof e.code?t=e.code:"object"==typeof e&&e&&"string"==typeof e.error_code&&(t=e.error_code),t){if("weak_password"===t)throw new xt(Oe(e),s.status,(null===(r=e.weak_password)||void 0===r?void 0:r.reasons)||[]);if("session_not_found"===t)throw new Ae}else if("object"==typeof e&&e&&"object"==typeof e.weak_password&&e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.reasons.reduce((i,o)=>i&&"string"==typeof o,!0))throw new xt(Oe(e),s.status,e.weak_password.reasons);throw new wr(Oe(e),s.status||500,t)})).apply(this,arguments)}function J(s,r,e,t){return _t.apply(this,arguments)}function _t(){return _t=(0,c.A)(function*(s,r,e,t){var n;const i=Object.assign({},null==t?void 0:t.headers);i[it]||(i[it]=Pt_2024_01_01_name),null!=t&&t.jwt&&(i.Authorization=`Bearer ${t.jwt}`);const o=null!==(n=null==t?void 0:t.query)&&void 0!==n?n:{};null!=t&&t.redirectTo&&(o.redirect_to=t.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=yield function Wr(s,r,e,t,n,i){return vt.apply(this,arguments)}(s,r,e+a,{headers:i,noResolveJson:null==t?void 0:t.noResolveJson},{},null==t?void 0:t.body);return null!=t&&t.xform?null==t?void 0:t.xform(l):{data:Object.assign({},l),error:null}}),_t.apply(this,arguments)}function vt(){return(vt=(0,c.A)(function*(s,r,e,t,n,i){const o=((s,r,e,t)=>{const n={method:s,headers:(null==r?void 0:r.headers)||{}};return"GET"===s?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==r?void 0:r.headers),n.body=JSON.stringify(t),Object.assign(Object.assign({},n),e))})(r,t,n,i);let a;try{a=yield s(e,Object.assign({},o))}catch(l){throw console.error(l),new lt(Oe(l),0)}if(a.ok||(yield Dt(a)),null!=t&&t.noResolveJson)return a;try{return yield a.json()}catch(l){yield Dt(l)}})).apply(this,arguments)}function ke(s){var r;let e=null;return function Xr(s){return s.access_token&&s.refresh_token&&s.expires_in}(s)&&(e=Object.assign({},s),s.expires_at||(e.expires_at=function jr(s){return Math.round(Date.now()/1e3)+s}(s.expires_in))),{data:{session:e,user:null!==(r=s.user)&&void 0!==r?r:s},error:null}}function Bt(s){const r=ke(s);return!r.error&&s.weak_password&&"object"==typeof s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&"string"==typeof s.weak_password.message&&s.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(r.data.weak_password=s.weak_password),r}function Ee(s){var r;return{data:{user:null!==(r=s.user)&&void 0!==r?r:s},error:null}}function zr(s){return{data:s,error:null}}function Vr(s){const{action_link:r,email_otp:e,hashed_token:t,redirect_to:n,verification_type:i}=s,o=function(s,r){var e={};for(var t in s)Object.prototype.hasOwnProperty.call(s,t)&&r.indexOf(t)<0&&(e[t]=s[t]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(t=Object.getOwnPropertySymbols(s);n<t.length;n++)r.indexOf(t[n])<0&&Object.prototype.propertyIsEnumerable.call(s,t[n])&&(e[t[n]]=s[t[n]])}return e}(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:r,email_otp:e,hashed_token:t,redirect_to:n,verification_type:i},user:Object.assign({},o)},error:null}}function Qr(s){return s}class Zr{constructor({url:r="",headers:e={},fetch:t}){this.url=r,this.headers=e,this.fetch=It(t),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}signOut(r,e="global"){var t=this;return(0,c.A)(function*(){try{return yield J(t.fetch,"POST",`${t.url}/logout?scope=${e}`,{headers:t.headers,jwt:r,noResolveJson:!0}),{data:null,error:null}}catch(n){if(F(n))return{data:null,error:n};throw n}})()}inviteUserByEmail(r,e={}){var t=this;return(0,c.A)(function*(){try{return yield J(t.fetch,"POST",`${t.url}/invite`,{body:{email:r,data:e.data},headers:t.headers,redirectTo:e.redirectTo,xform:Ee})}catch(n){if(F(n))return{data:{user:null},error:n};throw n}})()}generateLink(r){var e=this;return(0,c.A)(function*(){try{const{options:t}=r,n=function(s,r){var e={};for(var t in s)Object.prototype.hasOwnProperty.call(s,t)&&r.indexOf(t)<0&&(e[t]=s[t]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(t=Object.getOwnPropertySymbols(s);n<t.length;n++)r.indexOf(t[n])<0&&Object.prototype.propertyIsEnumerable.call(s,t[n])&&(e[t[n]]=s[t[n]])}return e}(r,["options"]),i=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(i.new_email=null==n?void 0:n.newEmail,delete i.newEmail),yield J(e.fetch,"POST",`${e.url}/admin/generate_link`,{body:i,headers:e.headers,xform:Vr,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(F(t))return{data:{properties:null,user:null},error:t};throw t}})()}createUser(r){var e=this;return(0,c.A)(function*(){try{return yield J(e.fetch,"POST",`${e.url}/admin/users`,{body:r,headers:e.headers,xform:Ee})}catch(t){if(F(t))return{data:{user:null},error:t};throw t}})()}listUsers(r){var e=this;return(0,c.A)(function*(){var t,n,i,o,a,l,d;try{const u={nextPage:null,lastPage:0,total:0},f=yield J(e.fetch,"GET",`${e.url}/admin/users`,{headers:e.headers,noResolveJson:!0,query:{page:null!==(n=null===(t=null==r?void 0:r.page)||void 0===t?void 0:t.toString())&&void 0!==n?n:"",per_page:null!==(o=null===(i=null==r?void 0:r.perPage)||void 0===i?void 0:i.toString())&&void 0!==o?o:""},xform:Qr});if(f.error)throw f.error;const P=yield f.json(),j=null!==(a=f.headers.get("x-total-count"))&&void 0!==a?a:0,$=null!==(d=null===(l=f.headers.get("link"))||void 0===l?void 0:l.split(","))&&void 0!==d?d:[];return $.length>0&&($.forEach(H=>{const K=parseInt(H.split(";")[0].split("=")[1].substring(0,1)),se=JSON.parse(H.split(";")[1].split("=")[1]);u[`${se}Page`]=K}),u.total=parseInt(j)),{data:Object.assign(Object.assign({},P),u),error:null}}catch(u){if(F(u))return{data:{users:[]},error:u};throw u}})()}getUserById(r){var e=this;return(0,c.A)(function*(){try{return yield J(e.fetch,"GET",`${e.url}/admin/users/${r}`,{headers:e.headers,xform:Ee})}catch(t){if(F(t))return{data:{user:null},error:t};throw t}})()}updateUserById(r,e){var t=this;return(0,c.A)(function*(){try{return yield J(t.fetch,"PUT",`${t.url}/admin/users/${r}`,{body:e,headers:t.headers,xform:Ee})}catch(n){if(F(n))return{data:{user:null},error:n};throw n}})()}deleteUser(r,e=!1){var t=this;return(0,c.A)(function*(){try{return yield J(t.fetch,"DELETE",`${t.url}/admin/users/${r}`,{headers:t.headers,body:{should_soft_delete:e},xform:Ee})}catch(n){if(F(n))return{data:{user:null},error:n};throw n}})()}_listFactors(r){var e=this;return(0,c.A)(function*(){try{const{data:t,error:n}=yield J(e.fetch,"GET",`${e.url}/admin/users/${r.userId}/factors`,{headers:e.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:n}}catch(t){if(F(t))return{data:null,error:t};throw t}})()}_deleteFactor(r){var e=this;return(0,c.A)(function*(){try{return{data:yield J(e.fetch,"DELETE",`${e.url}/admin/users/${r.userId}/factors/${r.id}`,{headers:e.headers}),error:null}}catch(t){if(F(t))return{data:null,error:t};throw t}})()}}const en={getItem:s=>Ne()?globalThis.localStorage.getItem(s):null,setItem:(s,r)=>{Ne()&&globalThis.localStorage.setItem(s,r)},removeItem:s=>{Ne()&&globalThis.localStorage.removeItem(s)}};function Mt(s={}){return{getItem:r=>s[r]||null,setItem:(r,e)=>{s[r]=e},removeItem:r=>{delete s[r]}}}const Ie_debug=!!(globalThis&&Ne()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class Ft extends Error{constructor(r){super(r),this.isAcquireTimeout=!0}}class rn extends Ft{}function sn(s,r,e){return yt.apply(this,arguments)}function yt(){return yt=(0,c.A)(function*(s,r,e){Ie_debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,r);const t=new globalThis.AbortController;return r>0&&setTimeout(()=>{t.abort(),Ie_debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},r),yield Promise.resolve().then(()=>globalThis.navigator.locks.request(s,0===r?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:t.signal},function(){var n=(0,c.A)(function*(i){if(!i){if(0===r)throw Ie_debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new rn(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(Ie_debug)try{const o=yield globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),yield e()}Ie_debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,i.name);try{return yield e()}finally{Ie_debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,i.name)}});return function(i){return n.apply(this,arguments)}}()))}),yt.apply(this,arguments)}!function tn(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}();const on={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:{"X-Client-Info":"gotrue-js/2.69.1"},flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};function qt(s,r,e){return bt.apply(this,arguments)}function bt(){return(bt=(0,c.A)(function*(s,r,e){return yield e()})).apply(this,arguments)}const ln=(()=>{class s{constructor(e){var n,i,t=this;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=s.nextInstanceID,s.nextInstanceID+=1,this.instanceID>0&&de()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const o=Object.assign(Object.assign({},on),e);if(this.logDebugMessages=!!o.debug,"function"==typeof o.debug&&(this.logger=o.debug),this.persistSession=o.persistSession,this.storageKey=o.storageKey,this.autoRefreshToken=o.autoRefreshToken,this.admin=new Zr({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=It(o.fetch),this.lock=o.lock||qt,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,this.lock=o.lock?o.lock:de()&&null!==(n=null==globalThis?void 0:globalThis.navigator)&&void 0!==n&&n.locks?sn:qt,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?o.storage?this.storage=o.storage:Ne()?this.storage=en:(this.memoryStorage={},this.storage=Mt(this.memoryStorage)):(this.memoryStorage={},this.storage=Mt(this.memoryStorage)),de()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(a){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",a)}null===(i=this.broadcastChannel)||void 0===i||i.addEventListener("message",function(){var a=(0,c.A)(function*(l){t._debug("received broadcast notification from other tab or client",l),yield t._notifyAllSubscribers(l.data.event,l.data.session,!1)});return function(l){return a.apply(this,arguments)}}())}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (2.69.1) ${(new Date).toISOString()}`,...e),this}initialize(){var e=this;return(0,c.A)(function*(){return e.initializePromise||(e.initializePromise=(0,c.A)(function*(){return yield e._acquireLock(-1,(0,c.A)(function*(){return yield e._initialize()}))})()),yield e.initializePromise})()}_initialize(){var e=this;return(0,c.A)(function*(){var t;try{const n=function Rr(s){const r={},e=new URL(s);if(e.hash&&"#"===e.hash[0])try{new URLSearchParams(e.hash.substring(1)).forEach((n,i)=>{r[i]=n})}catch{}return e.searchParams.forEach((t,n)=>{r[n]=t}),r}(window.location.href);let i="none";if(e._isImplicitGrantCallback(n)?i="implicit":(yield e._isPKCECallback(n))&&(i="pkce"),de()&&e.detectSessionInUrl&&"none"!==i){const{data:o,error:a}=yield e._getSessionFromURL(n,i);if(a){if(e._debug("#_initialize()","error detecting session from URL",a),function Er(s){return F(s)&&"AuthImplicitGrantRedirectError"===s.name}(a)){const u=null===(t=a.details)||void 0===t?void 0:t.code;if("identity_already_exists"===u||"identity_not_found"===u||"single_identity_not_deletable"===u)return{error:a}}return yield e._removeSession(),{error:a}}const{session:l,redirectType:d}=o;return e._debug("#_initialize()","detected session in URL",l,"redirect type",d),yield e._saveSession(l),setTimeout((0,c.A)(function*(){"recovery"===d?yield e._notifyAllSubscribers("PASSWORD_RECOVERY",l):yield e._notifyAllSubscribers("SIGNED_IN",l)}),0),{error:null}}return yield e._recoverAndRefresh(),{error:null}}catch(n){return F(n)?{error:n}:{error:new Tt("Unexpected error during initialization",n)}}finally{yield e._handleVisibilityChange(),e._debug("#_initialize()","end")}})()}signInAnonymously(e){var t=this;return(0,c.A)(function*(){var n,i,o;try{const a=yield J(t.fetch,"POST",`${t.url}/signup`,{headers:t.headers,body:{data:null!==(i=null===(n=null==e?void 0:e.options)||void 0===n?void 0:n.data)&&void 0!==i?i:{},gotrue_meta_security:{captcha_token:null===(o=null==e?void 0:e.options)||void 0===o?void 0:o.captchaToken}},xform:ke}),{data:l,error:d}=a;if(d||!l)return{data:{user:null,session:null},error:d};const u=l.session,f=l.user;return l.session&&(yield t._saveSession(l.session),yield t._notifyAllSubscribers("SIGNED_IN",u)),{data:{user:f,session:u},error:null}}catch(a){if(F(a))return{data:{user:null,session:null},error:a};throw a}})()}signUp(e){var t=this;return(0,c.A)(function*(){var n,i,o;try{let a;if("email"in e){const{email:P,password:j,options:$}=e;let H=null,K=null;"pkce"===t.flowType&&([H,K]=yield Ue(t.storage,t.storageKey)),a=yield J(t.fetch,"POST",`${t.url}/signup`,{headers:t.headers,redirectTo:null==$?void 0:$.emailRedirectTo,body:{email:P,password:j,data:null!==(n=null==$?void 0:$.data)&&void 0!==n?n:{},gotrue_meta_security:{captcha_token:null==$?void 0:$.captchaToken},code_challenge:H,code_challenge_method:K},xform:ke})}else{if(!("phone"in e))throw new Ke("You must provide either an email or phone number and a password");{const{phone:P,password:j,options:$}=e;a=yield J(t.fetch,"POST",`${t.url}/signup`,{headers:t.headers,body:{phone:P,password:j,data:null!==(i=null==$?void 0:$.data)&&void 0!==i?i:{},channel:null!==(o=null==$?void 0:$.channel)&&void 0!==o?o:"sms",gotrue_meta_security:{captcha_token:null==$?void 0:$.captchaToken}},xform:ke})}}const{data:l,error:d}=a;if(d||!l)return{data:{user:null,session:null},error:d};const u=l.session,f=l.user;return l.session&&(yield t._saveSession(l.session),yield t._notifyAllSubscribers("SIGNED_IN",u)),{data:{user:f,session:u},error:null}}catch(a){if(F(a))return{data:{user:null,session:null},error:a};throw a}})()}signInWithPassword(e){var t=this;return(0,c.A)(function*(){try{let n;if("email"in e){const{email:a,password:l,options:d}=e;n=yield J(t.fetch,"POST",`${t.url}/token?grant_type=password`,{headers:t.headers,body:{email:a,password:l,gotrue_meta_security:{captcha_token:null==d?void 0:d.captchaToken}},xform:Bt})}else{if(!("phone"in e))throw new Ke("You must provide either an email or phone number and a password");{const{phone:a,password:l,options:d}=e;n=yield J(t.fetch,"POST",`${t.url}/token?grant_type=password`,{headers:t.headers,body:{phone:a,password:l,gotrue_meta_security:{captcha_token:null==d?void 0:d.captchaToken}},xform:Bt})}}const{data:i,error:o}=n;return o?{data:{user:null,session:null},error:o}:i&&i.session&&i.user?(i.session&&(yield t._saveSession(i.session),yield t._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign({user:i.user,session:i.session},i.weak_password?{weakPassword:i.weak_password}:null),error:o}):{data:{user:null,session:null},error:new at}}catch(n){if(F(n))return{data:{user:null,session:null},error:n};throw n}})()}signInWithOAuth(e){var t=this;return(0,c.A)(function*(){var n,i,o,a;return yield t._handleProviderSignIn(e.provider,{redirectTo:null===(n=e.options)||void 0===n?void 0:n.redirectTo,scopes:null===(i=e.options)||void 0===i?void 0:i.scopes,queryParams:null===(o=e.options)||void 0===o?void 0:o.queryParams,skipBrowserRedirect:null===(a=e.options)||void 0===a?void 0:a.skipBrowserRedirect})})()}exchangeCodeForSession(e){var t=this;return(0,c.A)(function*(){return yield t.initializePromise,t._acquireLock(-1,(0,c.A)(function*(){return t._exchangeCodeForSession(e)}))})()}_exchangeCodeForSession(e){var t=this;return(0,c.A)(function*(){const n=yield We(t.storage,`${t.storageKey}-code-verifier`),[i,o]=(null!=n?n:"").split("/");try{const{data:a,error:l}=yield J(t.fetch,"POST",`${t.url}/token?grant_type=pkce`,{headers:t.headers,body:{auth_code:e,code_verifier:i},xform:ke});if(yield ze(t.storage,`${t.storageKey}-code-verifier`),l)throw l;return a&&a.session&&a.user?(a.session&&(yield t._saveSession(a.session),yield t._notifyAllSubscribers("SIGNED_IN",a.session)),{data:Object.assign(Object.assign({},a),{redirectType:null!=o?o:null}),error:l}):{data:{user:null,session:null,redirectType:null},error:new at}}catch(a){if(F(a))return{data:{user:null,session:null,redirectType:null},error:a};throw a}})()}signInWithIdToken(e){var t=this;return(0,c.A)(function*(){try{const{options:n,provider:i,token:o,access_token:a,nonce:l}=e,d=yield J(t.fetch,"POST",`${t.url}/token?grant_type=id_token`,{headers:t.headers,body:{provider:i,id_token:o,access_token:a,nonce:l,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:ke}),{data:u,error:f}=d;return f?{data:{user:null,session:null},error:f}:u&&u.session&&u.user?(u.session&&(yield t._saveSession(u.session),yield t._notifyAllSubscribers("SIGNED_IN",u.session)),{data:u,error:f}):{data:{user:null,session:null},error:new at}}catch(n){if(F(n))return{data:{user:null,session:null},error:n};throw n}})()}signInWithOtp(e){var t=this;return(0,c.A)(function*(){var n,i,o,a,l;try{if("email"in e){const{email:d,options:u}=e;let f=null,P=null;"pkce"===t.flowType&&([f,P]=yield Ue(t.storage,t.storageKey));const{error:j}=yield J(t.fetch,"POST",`${t.url}/otp`,{headers:t.headers,body:{email:d,data:null!==(n=null==u?void 0:u.data)&&void 0!==n?n:{},create_user:null===(i=null==u?void 0:u.shouldCreateUser)||void 0===i||i,gotrue_meta_security:{captcha_token:null==u?void 0:u.captchaToken},code_challenge:f,code_challenge_method:P},redirectTo:null==u?void 0:u.emailRedirectTo});return{data:{user:null,session:null},error:j}}if("phone"in e){const{phone:d,options:u}=e,{data:f,error:P}=yield J(t.fetch,"POST",`${t.url}/otp`,{headers:t.headers,body:{phone:d,data:null!==(o=null==u?void 0:u.data)&&void 0!==o?o:{},create_user:null===(a=null==u?void 0:u.shouldCreateUser)||void 0===a||a,gotrue_meta_security:{captcha_token:null==u?void 0:u.captchaToken},channel:null!==(l=null==u?void 0:u.channel)&&void 0!==l?l:"sms"}});return{data:{user:null,session:null,messageId:null==f?void 0:f.message_id},error:P}}throw new Ke("You must provide either an email or phone number.")}catch(d){if(F(d))return{data:{user:null,session:null},error:d};throw d}})()}verifyOtp(e){var t=this;return(0,c.A)(function*(){var n,i;try{let o,a;"options"in e&&(o=null===(n=e.options)||void 0===n?void 0:n.redirectTo,a=null===(i=e.options)||void 0===i?void 0:i.captchaToken);const{data:l,error:d}=yield J(t.fetch,"POST",`${t.url}/verify`,{headers:t.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:a}}),redirectTo:o,xform:ke});if(d)throw d;if(!l)throw new Error("An error occurred on token verification.");const u=l.session,f=l.user;return null!=u&&u.access_token&&(yield t._saveSession(u),yield t._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",u)),{data:{user:f,session:u},error:null}}catch(o){if(F(o))return{data:{user:null,session:null},error:o};throw o}})()}signInWithSSO(e){var t=this;return(0,c.A)(function*(){var n,i,o;try{let a=null,l=null;return"pkce"===t.flowType&&([a,l]=yield Ue(t.storage,t.storageKey)),yield J(t.fetch,"POST",`${t.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(i=null===(n=e.options)||void 0===n?void 0:n.redirectTo)&&void 0!==i?i:void 0}),null!==(o=null==e?void 0:e.options)&&void 0!==o&&o.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:t.headers,xform:zr})}catch(a){if(F(a))return{data:null,error:a};throw a}})()}reauthenticate(){var e=this;return(0,c.A)(function*(){return yield e.initializePromise,yield e._acquireLock(-1,(0,c.A)(function*(){return yield e._reauthenticate()}))})()}_reauthenticate(){var e=this;return(0,c.A)(function*(){try{return yield e._useSession(function(){var t=(0,c.A)(function*(n){const{data:{session:i},error:o}=n;if(o)throw o;if(!i)throw new Ae;const{error:a}=yield J(e.fetch,"GET",`${e.url}/reauthenticate`,{headers:e.headers,jwt:i.access_token});return{data:{user:null,session:null},error:a}});return function(n){return t.apply(this,arguments)}}())}catch(t){if(F(t))return{data:{user:null,session:null},error:t};throw t}})()}resend(e){var t=this;return(0,c.A)(function*(){try{const n=`${t.url}/resend`;if("email"in e){const{email:i,type:o,options:a}=e,{error:l}=yield J(t.fetch,"POST",n,{headers:t.headers,body:{email:i,type:o,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},redirectTo:null==a?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:l}}if("phone"in e){const{phone:i,type:o,options:a}=e,{data:l,error:d}=yield J(t.fetch,"POST",n,{headers:t.headers,body:{phone:i,type:o,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}}});return{data:{user:null,session:null,messageId:null==l?void 0:l.message_id},error:d}}throw new Ke("You must provide either an email or phone number and a type")}catch(n){if(F(n))return{data:{user:null,session:null},error:n};throw n}})()}getSession(){var e=this;return(0,c.A)(function*(){return yield e.initializePromise,yield e._acquireLock(-1,(0,c.A)(function*(){return e._useSession(function(){var n=(0,c.A)(function*(i){return i});return function(i){return n.apply(this,arguments)}}())}))})()}_acquireLock(e,t){var n=this;return(0,c.A)(function*(){n._debug("#_acquireLock","begin",e);try{if(n.lockAcquired){const i=n.pendingInLock.length?n.pendingInLock[n.pendingInLock.length-1]:Promise.resolve(),o=(0,c.A)(function*(){return yield i,yield t()})();return n.pendingInLock.push((0,c.A)(function*(){try{yield o}catch{}})()),o}return yield n.lock(`lock:${n.storageKey}`,e,(0,c.A)(function*(){n._debug("#_acquireLock","lock acquired for storage key",n.storageKey);try{n.lockAcquired=!0;const i=t();for(n.pendingInLock.push((0,c.A)(function*(){try{yield i}catch{}})()),yield i;n.pendingInLock.length;){const o=[...n.pendingInLock];yield Promise.all(o),n.pendingInLock.splice(0,o.length)}return yield i}finally{n._debug("#_acquireLock","lock released for storage key",n.storageKey),n.lockAcquired=!1}}))}finally{n._debug("#_acquireLock","end")}})()}_useSession(e){var t=this;return(0,c.A)(function*(){t._debug("#_useSession","begin");try{const n=yield t.__loadSession();return yield e(n)}finally{t._debug("#_useSession","end")}})()}__loadSession(){var e=this;return(0,c.A)(function*(){e._debug("#__loadSession()","begin"),e.lockAcquired||e._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let t=null;const n=yield We(e.storage,e.storageKey);if(e._debug("#getSession()","session from storage",n),null!==n&&(e._isValidSession(n)?t=n:(e._debug("#getSession()","session from storage is not valid"),yield e._removeSession())),!t)return{data:{session:null},error:null};const i=!!t.expires_at&&1e3*t.expires_at-Date.now()<9e4;if(e._debug("#__loadSession()",`session has${i?"":" not"} expired`,"expires_at",t.expires_at),!i){if(e.storage.isServer){let l=e.suppressGetSessionWarning;t=new Proxy(t,{get:(u,f,P)=>(!l&&"user"===f&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),l=!0,e.suppressGetSessionWarning=!0),Reflect.get(u,f,P))})}return{data:{session:t},error:null}}const{session:o,error:a}=yield e._callRefreshToken(t.refresh_token);return a?{data:{session:null},error:a}:{data:{session:o},error:null}}finally{e._debug("#__loadSession()","end")}})()}getUser(e){var t=this;return(0,c.A)(function*(){return e?yield t._getUser(e):(yield t.initializePromise,yield t._acquireLock(-1,(0,c.A)(function*(){return yield t._getUser()})))})()}_getUser(e){var t=this;return(0,c.A)(function*(){try{return e?yield J(t.fetch,"GET",`${t.url}/user`,{headers:t.headers,jwt:e,xform:Ee}):yield t._useSession(function(){var n=(0,c.A)(function*(i){var o,a,l;const{data:d,error:u}=i;if(u)throw u;return null!==(o=d.session)&&void 0!==o&&o.access_token||t.hasCustomAuthorizationHeader?yield J(t.fetch,"GET",`${t.url}/user`,{headers:t.headers,jwt:null!==(l=null===(a=d.session)||void 0===a?void 0:a.access_token)&&void 0!==l?l:void 0,xform:Ee}):{data:{user:null},error:new Ae}});return function(i){return n.apply(this,arguments)}}())}catch(n){if(F(n))return function kr(s){return F(s)&&"AuthSessionMissingError"===s.name}(n)&&(yield t._removeSession(),yield ze(t.storage,`${t.storageKey}-code-verifier`)),{data:{user:null},error:n};throw n}})()}updateUser(e,t={}){var n=this;return(0,c.A)(function*(){return yield n.initializePromise,yield n._acquireLock(-1,(0,c.A)(function*(){return yield n._updateUser(e,t)}))})()}_updateUser(e,t={}){var n=this;return(0,c.A)(function*(){try{return yield n._useSession(function(){var i=(0,c.A)(function*(o){const{data:a,error:l}=o;if(l)throw l;if(!a.session)throw new Ae;const d=a.session;let u=null,f=null;"pkce"===n.flowType&&null!=e.email&&([u,f]=yield Ue(n.storage,n.storageKey));const{data:P,error:j}=yield J(n.fetch,"PUT",`${n.url}/user`,{headers:n.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:u,code_challenge_method:f}),jwt:d.access_token,xform:Ee});if(j)throw j;return d.user=P.user,yield n._saveSession(d),yield n._notifyAllSubscribers("USER_UPDATED",d),{data:{user:d.user},error:null}});return function(o){return i.apply(this,arguments)}}())}catch(i){if(F(i))return{data:{user:null},error:i};throw i}})()}setSession(e){var t=this;return(0,c.A)(function*(){return yield t.initializePromise,yield t._acquireLock(-1,(0,c.A)(function*(){return yield t._setSession(e)}))})()}_setSession(e){var t=this;return(0,c.A)(function*(){try{if(!e.access_token||!e.refresh_token)throw new Ae;const n=Date.now()/1e3;let i=n,o=!0,a=null;const{payload:l}=ct(e.access_token);if(l.exp&&(i=l.exp,o=i<=n),o){const{session:d,error:u}=yield t._callRefreshToken(e.refresh_token);if(u)return{data:{user:null,session:null},error:u};if(!d)return{data:{user:null,session:null},error:null};a=d}else{const{data:d,error:u}=yield t._getUser(e.access_token);if(u)throw u;a={access_token:e.access_token,refresh_token:e.refresh_token,user:d.user,token_type:"bearer",expires_in:i-n,expires_at:i},yield t._saveSession(a),yield t._notifyAllSubscribers("SIGNED_IN",a)}return{data:{user:a.user,session:a},error:null}}catch(n){if(F(n))return{data:{session:null,user:null},error:n};throw n}})()}refreshSession(e){var t=this;return(0,c.A)(function*(){return yield t.initializePromise,yield t._acquireLock(-1,(0,c.A)(function*(){return yield t._refreshSession(e)}))})()}_refreshSession(e){var t=this;return(0,c.A)(function*(){try{return yield t._useSession(function(){var n=(0,c.A)(function*(i){var o;if(!e){const{data:d,error:u}=i;if(u)throw u;e=null!==(o=d.session)&&void 0!==o?o:void 0}if(null==e||!e.refresh_token)throw new Ae;const{session:a,error:l}=yield t._callRefreshToken(e.refresh_token);return l?{data:{user:null,session:null},error:l}:a?{data:{user:a.user,session:a},error:null}:{data:{user:null,session:null},error:null}});return function(i){return n.apply(this,arguments)}}())}catch(n){if(F(n))return{data:{user:null,session:null},error:n};throw n}})()}_getSessionFromURL(e,t){var n=this;return(0,c.A)(function*(){try{if(!de())throw new He("No browser detected.");if(e.error||e.error_description||e.error_code)throw new He(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===n.flowType)throw new Ot("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===n.flowType)throw new He("Not a valid implicit grant flow url.")}if("pkce"===t){if(n._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Ot("No code detected.");const{data:he,error:_e}=yield n._exchangeCodeForSession(e.code);if(_e)throw _e;const Qe=new URL(window.location.href);return Qe.searchParams.delete("code"),window.history.replaceState(window.history.state,"",Qe.toString()),{data:{session:he.session,redirectType:null},error:null}}const{provider_token:i,provider_refresh_token:o,access_token:a,refresh_token:l,expires_in:d,expires_at:u,token_type:f}=e;if(!(a&&d&&l&&f))throw new He("No session defined in URL");const P=Math.round(Date.now()/1e3),j=parseInt(d);let $=P+j;u&&($=parseInt(u));const H=$-P;1e3*H<=$e&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${H}s, should have been closer to ${j}s`);const K=$-j;P-K>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",K,$,P):P-K<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",K,$,P);const{data:se,error:ue}=yield n._getUser(a);if(ue)throw ue;const ge={provider_token:i,provider_refresh_token:o,access_token:a,expires_in:j,expires_at:$,refresh_token:l,token_type:f,user:se.user};return window.location.hash="",n._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:ge,redirectType:e.type},error:null}}catch(i){if(F(i))return{data:{session:null,redirectType:null},error:i};throw i}})()}_isImplicitGrantCallback(e){return!(!e.access_token&&!e.error_description)}_isPKCECallback(e){var t=this;return(0,c.A)(function*(){const n=yield We(t.storage,`${t.storageKey}-code-verifier`);return!(!e.code||!n)})()}signOut(e={scope:"global"}){var t=this;return(0,c.A)(function*(){return yield t.initializePromise,yield t._acquireLock(-1,(0,c.A)(function*(){return yield t._signOut(e)}))})()}_signOut({scope:e}={scope:"global"}){var t=this;return(0,c.A)(function*(){return yield t._useSession(function(){var n=(0,c.A)(function*(i){var o;const{data:a,error:l}=i;if(l)return{error:l};const d=null===(o=a.session)||void 0===o?void 0:o.access_token;if(d){const{error:u}=yield t.admin.signOut(d,e);if(u&&(!function Ar(s){return F(s)&&"AuthApiError"===s.name}(u)||404!==u.status&&401!==u.status&&403!==u.status))return{error:u}}return"others"!==e&&(yield t._removeSession(),yield ze(t.storage,`${t.storageKey}-code-verifier`)),{error:null}});return function(i){return n.apply(this,arguments)}}())})()}onAuthStateChange(e){var t=this;const n=function Cr(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const r=16*Math.random()|0;return("x"==s?r:3&r|8).toString(16)})}(),i={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,i),(0,c.A)(function*(){yield t.initializePromise,yield t._acquireLock(-1,(0,c.A)(function*(){t._emitInitialSession(n)}))})(),{data:{subscription:i}}}_emitInitialSession(e){var t=this;return(0,c.A)(function*(){return yield t._useSession(function(){var n=(0,c.A)(function*(i){var o,a;try{const{data:{session:l},error:d}=i;if(d)throw d;yield null===(o=t.stateChangeEmitters.get(e))||void 0===o?void 0:o.callback("INITIAL_SESSION",l),t._debug("INITIAL_SESSION","callback id",e,"session",l)}catch(l){yield null===(a=t.stateChangeEmitters.get(e))||void 0===a?void 0:a.callback("INITIAL_SESSION",null),t._debug("INITIAL_SESSION","callback id",e,"error",l),console.error(l)}});return function(i){return n.apply(this,arguments)}}())})()}resetPasswordForEmail(e,t={}){var n=this;return(0,c.A)(function*(){let i=null,o=null;"pkce"===n.flowType&&([i,o]=yield Ue(n.storage,n.storageKey,!0));try{return yield J(n.fetch,"POST",`${n.url}/recover`,{body:{email:e,code_challenge:i,code_challenge_method:o,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:n.headers,redirectTo:t.redirectTo})}catch(a){if(F(a))return{data:null,error:a};throw a}})()}getUserIdentities(){var e=this;return(0,c.A)(function*(){var t;try{const{data:n,error:i}=yield e.getUser();if(i)throw i;return{data:{identities:null!==(t=n.user.identities)&&void 0!==t?t:[]},error:null}}catch(n){if(F(n))return{data:null,error:n};throw n}})()}linkIdentity(e){var t=this;return(0,c.A)(function*(){var n;try{const{data:i,error:o}=yield t._useSession(function(){var a=(0,c.A)(function*(l){var d,u,f,P,j;const{data:$,error:H}=l;if(H)throw H;const K=yield t._getUrlForProvider(`${t.url}/user/identities/authorize`,e.provider,{redirectTo:null===(d=e.options)||void 0===d?void 0:d.redirectTo,scopes:null===(u=e.options)||void 0===u?void 0:u.scopes,queryParams:null===(f=e.options)||void 0===f?void 0:f.queryParams,skipBrowserRedirect:!0});return yield J(t.fetch,"GET",K,{headers:t.headers,jwt:null!==(j=null===(P=$.session)||void 0===P?void 0:P.access_token)&&void 0!==j?j:void 0})});return function(l){return a.apply(this,arguments)}}());if(o)throw o;return de()&&!(null!==(n=e.options)&&void 0!==n&&n.skipBrowserRedirect)&&window.location.assign(null==i?void 0:i.url),{data:{provider:e.provider,url:null==i?void 0:i.url},error:null}}catch(i){if(F(i))return{data:{provider:e.provider,url:null},error:i};throw i}})()}unlinkIdentity(e){var t=this;return(0,c.A)(function*(){try{return yield t._useSession(function(){var n=(0,c.A)(function*(i){var o,a;const{data:l,error:d}=i;if(d)throw d;return yield J(t.fetch,"DELETE",`${t.url}/user/identities/${e.identity_id}`,{headers:t.headers,jwt:null!==(a=null===(o=l.session)||void 0===o?void 0:o.access_token)&&void 0!==a?a:void 0})});return function(i){return n.apply(this,arguments)}}())}catch(n){if(F(n))return{data:null,error:n};throw n}})()}_refreshAccessToken(e){var t=this;return(0,c.A)(function*(){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;t._debug(n,"begin");try{const i=Date.now();return yield function Ir(s,r){return new Promise((t,n)=>{(0,c.A)(function*(){for(let i=0;i<1/0;i++)try{const o=yield s(i);if(!r(i,null,o))return void t(o)}catch(o){if(!r(i,o))return void n(o)}})()})}(function(){var o=(0,c.A)(function*(a){return a>0&&(yield function Ur(s){return dt.apply(this,arguments)}(200*Math.pow(2,a-1))),t._debug(n,"refreshing attempt",a),yield J(t.fetch,"POST",`${t.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:t.headers,xform:ke})});return function(a){return o.apply(this,arguments)}}(),(o,a)=>{const l=200*Math.pow(2,o);return a&&ut(a)&&Date.now()+l-i<$e})}catch(i){if(t._debug(n,"error",i),F(i))return{data:{session:null,user:null},error:i};throw i}finally{t._debug(n,"end")}})()}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(e,t){var n=this;return(0,c.A)(function*(){const i=yield n._getUrlForProvider(`${n.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return n._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",i),de()&&!t.skipBrowserRedirect&&window.location.assign(i),{data:{provider:e,url:i},error:null}})()}_recoverAndRefresh(){var e=this;return(0,c.A)(function*(){var t;const n="#_recoverAndRefresh()";e._debug(n,"begin");try{const i=yield We(e.storage,e.storageKey);if(e._debug(n,"session from storage",i),!e._isValidSession(i))return e._debug(n,"session is not valid"),void(null!==i&&(yield e._removeSession()));const o=1e3*(null!==(t=i.expires_at)&&void 0!==t?t:1/0)-Date.now()<9e4;if(e._debug(n,`session has${o?"":" not"} expired with margin of 90000s`),o){if(e.autoRefreshToken&&i.refresh_token){const{error:a}=yield e._callRefreshToken(i.refresh_token);a&&(console.error(a),ut(a)||(e._debug(n,"refresh failed with a non-retryable error, removing the session",a),yield e._removeSession()))}}else yield e._notifyAllSubscribers("SIGNED_IN",i)}catch(i){return e._debug(n,"error",i),void console.error(i)}finally{e._debug(n,"end")}})()}_callRefreshToken(e){var t=this;return(0,c.A)(function*(){var n,i;if(!e)throw new Ae;if(t.refreshingDeferred)return t.refreshingDeferred.promise;const o=`#_callRefreshToken(${e.substring(0,5)}...)`;t._debug(o,"begin");try{t.refreshingDeferred=new Ve;const{data:a,error:l}=yield t._refreshAccessToken(e);if(l)throw l;if(!a.session)throw new Ae;yield t._saveSession(a.session),yield t._notifyAllSubscribers("TOKEN_REFRESHED",a.session);const d={session:a.session,error:null};return t.refreshingDeferred.resolve(d),d}catch(a){if(t._debug(o,"error",a),F(a)){const l={session:null,error:a};return ut(a)||(yield t._removeSession()),null===(n=t.refreshingDeferred)||void 0===n||n.resolve(l),l}throw null===(i=t.refreshingDeferred)||void 0===i||i.reject(a),a}finally{t.refreshingDeferred=null,t._debug(o,"end")}})()}_notifyAllSubscribers(e,t,n=!0){var i=this;return(0,c.A)(function*(){const o=`#_notifyAllSubscribers(${e})`;i._debug(o,"begin",t,`broadcast = ${n}`);try{i.broadcastChannel&&n&&i.broadcastChannel.postMessage({event:e,session:t});const a=[],l=Array.from(i.stateChangeEmitters.values()).map(function(){var d=(0,c.A)(function*(u){try{yield u.callback(e,t)}catch(f){a.push(f)}});return function(u){return d.apply(this,arguments)}}());if(yield Promise.all(l),a.length>0){for(let d=0;d<a.length;d+=1)console.error(a[d]);throw a[0]}}finally{i._debug(o,"end")}})()}_saveSession(e){var t=this;return(0,c.A)(function*(){t._debug("#_saveSession()",e),t.suppressGetSessionWarning=!0,yield Lt(t.storage,t.storageKey,e)})()}_removeSession(){var e=this;return(0,c.A)(function*(){e._debug("#_removeSession()"),yield ze(e.storage,e.storageKey),yield e._notifyAllSubscribers("SIGNED_OUT",null)})()}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&de()&&null!=window&&window.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}_startAutoRefresh(){var e=this;return(0,c.A)(function*(){yield e._stopAutoRefresh(),e._debug("#_startAutoRefresh()");const t=setInterval(()=>e._autoRefreshTokenTick(),$e);e.autoRefreshTicker=t,t&&"object"==typeof t&&"function"==typeof t.unref?t.unref():typeof Deno<"u"&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(t),setTimeout((0,c.A)(function*(){yield e.initializePromise,yield e._autoRefreshTokenTick()}),0)})()}_stopAutoRefresh(){var e=this;return(0,c.A)(function*(){e._debug("#_stopAutoRefresh()");const t=e.autoRefreshTicker;e.autoRefreshTicker=null,t&&clearInterval(t)})()}startAutoRefresh(){var e=this;return(0,c.A)(function*(){e._removeVisibilityChangedCallback(),yield e._startAutoRefresh()})()}stopAutoRefresh(){var e=this;return(0,c.A)(function*(){e._removeVisibilityChangedCallback(),yield e._stopAutoRefresh()})()}_autoRefreshTokenTick(){var e=this;return(0,c.A)(function*(){e._debug("#_autoRefreshTokenTick()","begin");try{yield e._acquireLock(0,(0,c.A)(function*(){try{const t=Date.now();try{return yield e._useSession(function(){var n=(0,c.A)(function*(i){const{data:{session:o}}=i;if(!o||!o.refresh_token||!o.expires_at)return void e._debug("#_autoRefreshTokenTick()","no session");const a=Math.floor((1e3*o.expires_at-t)/$e);e._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),a<=3&&(yield e._callRefreshToken(o.refresh_token))});return function(i){return n.apply(this,arguments)}}())}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{e._debug("#_autoRefreshTokenTick()","end")}}))}catch(t){if(!(t.isAcquireTimeout||t instanceof Ft))throw t;e._debug("auto refresh token tick lock not available")}})()}_handleVisibilityChange(){var e=this;return(0,c.A)(function*(){if(e._debug("#_handleVisibilityChange()"),!de()||null==window||!window.addEventListener)return e.autoRefreshToken&&e.startAutoRefresh(),!1;try{e.visibilityChangedCallback=(0,c.A)(function*(){return yield e._onVisibilityChanged(!1)}),null==window||window.addEventListener("visibilitychange",e.visibilityChangedCallback),yield e._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}})()}_onVisibilityChanged(e){var t=this;return(0,c.A)(function*(){const n=`#_onVisibilityChanged(${e})`;t._debug(n,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(t.autoRefreshToken&&t._startAutoRefresh(),e||(yield t.initializePromise,yield t._acquireLock(-1,(0,c.A)(function*(){"visible"===document.visibilityState?yield t._recoverAndRefresh():t._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")})))):"hidden"===document.visibilityState&&t.autoRefreshToken&&t._stopAutoRefresh()})()}_getUrlForProvider(e,t,n){var i=this;return(0,c.A)(function*(){const o=[`provider=${encodeURIComponent(t)}`];if(null!=n&&n.redirectTo&&o.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),null!=n&&n.scopes&&o.push(`scopes=${encodeURIComponent(n.scopes)}`),"pkce"===i.flowType){const[a,l]=yield Ue(i.storage,i.storageKey),d=new URLSearchParams({code_challenge:`${encodeURIComponent(a)}`,code_challenge_method:`${encodeURIComponent(l)}`});o.push(d.toString())}if(null!=n&&n.queryParams){const a=new URLSearchParams(n.queryParams);o.push(a.toString())}return null!=n&&n.skipBrowserRedirect&&o.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${o.join("&")}`})()}_unenroll(e){var t=this;return(0,c.A)(function*(){try{return yield t._useSession(function(){var n=(0,c.A)(function*(i){var o;const{data:a,error:l}=i;return l?{data:null,error:l}:yield J(t.fetch,"DELETE",`${t.url}/factors/${e.factorId}`,{headers:t.headers,jwt:null===(o=null==a?void 0:a.session)||void 0===o?void 0:o.access_token})});return function(i){return n.apply(this,arguments)}}())}catch(n){if(F(n))return{data:null,error:n};throw n}})()}_enroll(e){var t=this;return(0,c.A)(function*(){try{return yield t._useSession(function(){var n=(0,c.A)(function*(i){var o,a;const{data:l,error:d}=i;if(d)return{data:null,error:d};const u=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:{issuer:e.issuer}),{data:f,error:P}=yield J(t.fetch,"POST",`${t.url}/factors`,{body:u,headers:t.headers,jwt:null===(o=null==l?void 0:l.session)||void 0===o?void 0:o.access_token});return P?{data:null,error:P}:("totp"===e.factorType&&!(null===(a=null==f?void 0:f.totp)||void 0===a)&&a.qr_code&&(f.totp.qr_code=`data:image/svg+xml;utf-8,${f.totp.qr_code}`),{data:f,error:null})});return function(i){return n.apply(this,arguments)}}())}catch(n){if(F(n))return{data:null,error:n};throw n}})()}_verify(e){var t=this;return(0,c.A)(function*(){return t._acquireLock(-1,(0,c.A)(function*(){try{return yield t._useSession(function(){var n=(0,c.A)(function*(i){var o;const{data:a,error:l}=i;if(l)return{data:null,error:l};const{data:d,error:u}=yield J(t.fetch,"POST",`${t.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:t.headers,jwt:null===(o=null==a?void 0:a.session)||void 0===o?void 0:o.access_token});return u?{data:null,error:u}:(yield t._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+d.expires_in},d)),yield t._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",d),{data:d,error:u})});return function(i){return n.apply(this,arguments)}}())}catch(n){if(F(n))return{data:null,error:n};throw n}}))})()}_challenge(e){var t=this;return(0,c.A)(function*(){return t._acquireLock(-1,(0,c.A)(function*(){try{return yield t._useSession(function(){var n=(0,c.A)(function*(i){var o;const{data:a,error:l}=i;return l?{data:null,error:l}:yield J(t.fetch,"POST",`${t.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:t.headers,jwt:null===(o=null==a?void 0:a.session)||void 0===o?void 0:o.access_token})});return function(i){return n.apply(this,arguments)}}())}catch(n){if(F(n))return{data:null,error:n};throw n}}))})()}_challengeAndVerify(e){var t=this;return(0,c.A)(function*(){const{data:n,error:i}=yield t._challenge({factorId:e.factorId});return i?{data:null,error:i}:yield t._verify({factorId:e.factorId,challengeId:n.id,code:e.code})})()}_listFactors(){var e=this;return(0,c.A)(function*(){const{data:{user:t},error:n}=yield e.getUser();if(n)return{data:null,error:n};const i=(null==t?void 0:t.factors)||[],o=i.filter(l=>"totp"===l.factor_type&&"verified"===l.status),a=i.filter(l=>"phone"===l.factor_type&&"verified"===l.status);return{data:{all:i,totp:o,phone:a},error:null}})()}_getAuthenticatorAssuranceLevel(){var e=this;return(0,c.A)(function*(){return e._acquireLock(-1,(0,c.A)(function*(){return yield e._useSession(function(){var t=(0,c.A)(function*(n){var i,o;const{data:{session:a},error:l}=n;if(l)return{data:null,error:l};if(!a)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:d}=ct(a.access_token);let u=null;d.aal&&(u=d.aal);let f=u;return(null!==(o=null===(i=a.user.factors)||void 0===i?void 0:i.filter($=>"verified"===$.status))&&void 0!==o?o:[]).length>0&&(f="aal2"),{data:{currentLevel:u,nextLevel:f,currentAuthenticationMethods:d.amr||[]},error:null}});return function(n){return t.apply(this,arguments)}}())}))})()}fetchJwk(e,t={keys:[]}){var n=this;return(0,c.A)(function*(){let i=t.keys.find(l=>l.kid===e);if(i||(i=n.jwks.keys.find(l=>l.kid===e),i&&n.jwks_cached_at+6e5>Date.now()))return i;const{data:o,error:a}=yield J(n.fetch,"GET",`${n.url}/.well-known/jwks.json`,{headers:n.headers});if(a)throw a;if(!o.keys||0===o.keys.length)throw new Fe("JWKS is empty");if(n.jwks=o,n.jwks_cached_at=Date.now(),i=o.keys.find(l=>l.kid===e),!i)throw new Fe("No matching signing key found in JWKS");return i})()}getClaims(e,t={keys:[]}){var n=this;return(0,c.A)(function*(){try{let i=e;if(!i){const{data:H,error:K}=yield n.getSession();if(K||!H.session)return{data:null,error:K};i=H.session.access_token}const{header:o,payload:a,signature:l,raw:{header:d,payload:u}}=ct(i);if(function qr(s){if(!s)throw new Error("Missing exp claim");if(s<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(a.exp),!o.kid||"HS256"===o.alg||!("crypto"in globalThis)||!("subtle"in globalThis.crypto)){const{error:H}=yield n.getUser(i);if(H)throw H;return{data:{claims:a,header:o,signature:l},error:null}}const f=function Jr(s){switch(s){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(o.alg),P=yield n.fetchJwk(o.kid,t),j=yield crypto.subtle.importKey("jwk",P,f,!0,["verify"]);if(!(yield crypto.subtle.verify(f,j,l,function xr(s){const r=[];return function Ut(s,r){for(let e=0;e<s.length;e+=1){let t=s.charCodeAt(e);if(t>55295&&t<=56319){const n=1024*(t-55296)&65535;t=65536+(s.charCodeAt(e+1)-56320&65535|n),e+=1}Pr(t,r)}}(s,e=>r.push(e)),new Uint8Array(r)}(`${d}.${u}`))))throw new Fe("Invalid JWT signature");return{data:{claims:a,header:o,signature:l},error:null}}catch(i){if(F(i))return{data:null,error:i};throw i}})()}}return s.nextInstanceID=0,s})();class un extends ln{constructor(r){super(r)}}class dn{constructor(r,e,t){var n,i,o;if(this.supabaseUrl=r,this.supabaseKey=e,!r)throw new Error("supabaseUrl is required.");if(!e)throw new Error("supabaseKey is required.");const a=function pr(s){return s.endsWith("/")?s:s+"/"}(r),l=new URL(a);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const d=`sb-${l.hostname.split(".")[0]}-auth-token`,f=function gr(s,r){var e,t;const{db:n,auth:i,realtime:o,global:a}=s,{db:l,auth:d,realtime:u,global:f}=r,P={db:Object.assign(Object.assign({},l),n),auth:Object.assign(Object.assign({},d),i),realtime:Object.assign(Object.assign({},u),o),global:Object.assign(Object.assign(Object.assign({},f),a),{headers:Object.assign(Object.assign({},null!==(e=null==f?void 0:f.headers)&&void 0!==e?e:{}),null!==(t=null==a?void 0:a.headers)&&void 0!==t?t:{})}),accessToken:()=>function(s,r,e,t){return new(e||(e=Promise))(function(i,o){function a(u){try{d(t.next(u))}catch(f){o(f)}}function l(u){try{d(t.throw(u))}catch(f){o(f)}}function d(u){u.done?i(u.value):function n(i){return i instanceof e?i:new e(function(o){o(i)})}(u.value).then(a,l)}d((t=t.apply(s,r||[])).next())})}(this,void 0,void 0,function*(){return""})};return s.accessToken?P.accessToken=s.accessToken:delete P.accessToken,P}(null!=t?t:{},{db:or,realtime:lr,auth:Object.assign(Object.assign({},ar),{storageKey:d}),global:ir});this.storageKey=null!==(n=f.auth.storageKey)&&void 0!==n?n:"",this.headers=null!==(i=f.global.headers)&&void 0!==i?i:{},f.accessToken?(this.accessToken=f.accessToken,this.auth=new Proxy({},{get:(P,j)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(j)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(o=f.auth)&&void 0!==o?o:{},this.headers,f.global.fetch),this.fetch=hr(e,this._getAccessToken.bind(this),f.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},f.realtime)),this.rest=new T(new URL("rest/v1",l).href,{headers:this.headers,schema:f.db.schema,fetch:this.fetch}),f.accessToken||this._listenForAuthEvents()}get functions(){return new S(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new nr(this.storageUrl.href,this.headers,this.fetch)}from(r){return this.rest.from(r)}schema(r){return this.rest.schema(r)}rpc(r,e={},t={}){return this.rest.rpc(r,e,t)}channel(r,e={config:{}}){return this.realtime.channel(r,e)}getChannels(){return this.realtime.getChannels()}removeChannel(r){return this.realtime.removeChannel(r)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var r,e;return function(s,r,e,t){return new(e||(e=Promise))(function(i,o){function a(u){try{d(t.next(u))}catch(f){o(f)}}function l(u){try{d(t.throw(u))}catch(f){o(f)}}function d(u){u.done?i(u.value):function n(i){return i instanceof e?i:new e(function(o){o(i)})}(u.value).then(a,l)}d((t=t.apply(s,r||[])).next())})}(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:t}=yield this.auth.getSession();return null!==(e=null===(r=t.session)||void 0===r?void 0:r.access_token)&&void 0!==e?e:null})}_initSupabaseAuthClient({autoRefreshToken:r,persistSession:e,detectSessionInUrl:t,storage:n,storageKey:i,flowType:o,lock:a,debug:l},d,u){return new un({url:this.authUrl.href,headers:Object.assign(Object.assign({},{Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`}),d),storageKey:i,autoRefreshToken:r,persistSession:e,detectSessionInUrl:t,storage:n,flowType:o,lock:a,debug:l,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(r){return new Ce(this.realtimeUrl.href,Object.assign(Object.assign({},r),{params:Object.assign({apikey:this.supabaseKey},null==r?void 0:r.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(r,e,t){"TOKEN_REFRESHED"!==r&&"SIGNED_IN"!==r||this.changedAccessToken===t?"SIGNED_OUT"===r&&(this.realtime.setAuth(),"STORAGE"==e&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=t}}var Kt=b(1360),fn=b(9967);let pn=(()=>{var s;class r{constructor(t){this.firestore=t,this.supabase=((s,r)=>new dn(s,r,void 0))("https://jnrntrsroptekkmygmnt.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impucm50cnNyb3B0ZWtrbXlnbW50Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg0NTIyMjQsImV4cCI6MjA2NDAyODIyNH0.J3yTvQ8nOLPMfsEl2PioeTuabjfXY0CsyeEfHFgAnvg")}base64ToBlob(t,n="image/jpeg"){const i=atob(t.split(",")[1]),o=[];for(let a=0;a<i.length;a+=512){const l=i.slice(a,a+512),d=new Array(l.length);for(let f=0;f<l.length;f++)d[f]=l.charCodeAt(f);const u=new Uint8Array(d);o.push(u)}return new Blob(o,{type:n})}base64ToBlobAudio(t,n="audio/webm"){const i=atob(t),o=[];for(let a=0;a<i.length;a+=512){const l=i.slice(a,a+512),d=new Array(l.length);for(let f=0;f<l.length;f++)d[f]=l.charCodeAt(f);const u=new Uint8Array(d);o.push(u)}return new Blob(o,{type:n})}uploadToSupabase(t){var n=this;return(0,c.A)(function*(){const i=`voice_${Date.now()}.webm`,{error:a}=yield n.supabase.storage.from("audios").upload(i,t,{contentType:"audio/webm"});if(a)return console.error("Error al subir a Supabase:",a),"";const{publicUrl:l}=n.supabase.storage.from("audios").getPublicUrl(i).data;return l})()}normalizeFileName(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_.-]/g,"")}uploadFile(t,n){var i=this;return(0,c.A)(function*(){const o=i.normalizeFileName(t.name),a=`${n}/${Date.now()}_${o}`,{error:l}=yield i.supabase.storage.from("files").upload(a,t,{contentType:t.type});if(l)return console.error("\u274c Error al subir archivo:",l.message),null;const{data:d}=i.supabase.storage.from("files").getPublicUrl(a);return(null==d?void 0:d.publicUrl)||null})()}uploadMediaFile(t,n){var i=this;return(0,c.A)(function*(){const{error:a}=yield i.supabase.storage.from("media").upload(t,n,{contentType:n.type});if(a)throw a;return i.supabase.storage.from("media").getPublicUrl(t).data.publicUrl})()}uploadImage(t,n="chat"){var i=this;return(0,c.A)(function*(){const o=`${n}/${Date.now()}.jpeg`,{error:a}=yield i.supabase.storage.from("images").upload(o,t,{contentType:"image/jpeg"});if(a)throw a;const{data:l}=i.supabase.storage.from("images").getPublicUrl(o);return console.log(l),l.publicUrl})()}uploadProfilePhoto(t,n){var i=this;return(0,c.A)(function*(){const o=`profile_photos/${n}_${Date.now()}.jpg`,{error:l}=yield i.supabase.storage.from("profile").upload(o,t,{contentType:"image/jpeg",upsert:!0});if(l)throw l;const{data:d}=i.supabase.storage.from("profile").getPublicUrl(o);return d.publicUrl})()}}return(s=r).\u0275fac=function(t){return new(t||s)(Kt.KVO(fn._7))},s.\u0275prov=Kt.jDH({token:s,factory:s.\u0275fac,providedIn:"root"}),r})()},9293:V=>{function O(c,w,B,M,p,h,m){try{var E=c[h](m),S=E.value}catch(k){return void B(k)}E.done?w(S):Promise.resolve(S).then(M,p)}V.exports=function b(c){return function(){var w=this,B=arguments;return new Promise(function(M,p){var h=c.apply(w,B);function m(S){O(h,M,p,m,E,"next",S)}function E(S){O(h,M,p,m,E,"throw",S)}m(void 0)})}},V.exports.__esModule=!0,V.exports.default=V.exports}}]);